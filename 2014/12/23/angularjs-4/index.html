
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>angularjs-Working with Filters &amp; ngRoute | Poe&#39;s World</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
    
    <meta name="author" content="zhpooer">
    
    <meta name="description" content="What Are AngularJS Filters
AngularJS filters are used to process data and format
values to present to the user. 
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
1">
    
    
    
    
    <link rel="alternative" href="/atom.xml" title="Poe&#39;s World" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/pacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/pacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

  <body>
    <header>
      <div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.svg" alt="Poe&#39;s World" title="Poe&#39;s World"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Poe&#39;s World">Poe&#39;s World</a></h1>
				<h2 class="blog-motto">竹杖芒鞋轻胜马，一蓑烟雨任平生</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">主页</a></li>
					
						<li><a href="/english-monthly">英语角</a></li>
					
						<li><a href="/about">关于</a></li>
					
						<li><a href="/archives">归档</a></li>
					
					<li>
					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="text" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:zhpooer.github.io">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>

    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2014/12/23/angularjs-4/" title="angularjs-Working with Filters &amp; ngRoute" itemprop="url">angularjs-Working with Filters &amp; ngRoute</a>
  </h1>
  <p class="article-author">By
    
      <a href="http://zhpooer.github.io" title="zhpooer">zhpooer</a>
    </p>
  <p class="article-time">
    <time datetime="2014-12-23T07:12:14.000Z" itemprop="datePublished">12月 23 2014</time>
    更新日期:<time datetime="2014-12-24T07:34:17.870Z" itemprop="dateModified">12月 24 2014</time>
    
  </p>
</header>
	<div class="article-content">
		
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#what-are-angularjs-filters"><span class="toc-number">1.</span> <span class="toc-text">What Are AngularJS Filters</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#using-filters-in-controllers-and-services"><span class="toc-number">2.</span> <span class="toc-text">Using Filters in Controllers and Services</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#creating-angularjs-filters"><span class="toc-number">2.1.</span> <span class="toc-text">Creating AngularJS Filters</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#unit-testing-filters"><span class="toc-number">3.</span> <span class="toc-text">Unit Testing Filters</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#routing-using-ngroute"><span class="toc-number">4.</span> <span class="toc-text">Routing Using ngRoute</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#routing-options"><span class="toc-number">4.1.</span> <span class="toc-text">Routing Options</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#using-resolves-for-pre-route-checks"><span class="toc-number">4.2.</span> <span class="toc-text">Using Resolves for Pre-Route Checks</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#using-the-routeparams-service"><span class="toc-number">4.3.</span> <span class="toc-text">Using the $routeParams Service</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#a-full-angularjs-routing-example"><span class="toc-number">4.4.</span> <span class="toc-text">A Full AngularJS Routing Example</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#html5-mode"><span class="toc-number">4.5.</span> <span class="toc-text">HTML5 Mode</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ui-router"><span class="toc-number">4.6.</span> <span class="toc-text">ui-router</span></a></li></ol>
		</div>
		
		<h1 id="what-are-angularjs-filters">What Are AngularJS Filters</h1>
<p>AngularJS filters are used to process data and format
values to present to the user. </p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre></td><td class="code"><pre><span class="tag">&lt;<span class="title">div</span> <span class="attribute">ng-controller</span>=<span class="value">"FilterCtrl as ctrl"</span>&gt;</span>
  <span class="tag">&lt;<span class="title">div</span>&gt;</span>
    Amount as a number: {\{ctrl.amount | number}}
  <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
  <span class="tag">&lt;<span class="title">div</span>&gt;</span>
    Total Cost as a currency: {\{ctrl.totalCost | currency}}
  <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
  <span class="tag">&lt;<span class="title">div</span>&gt;</span>
    Total Cost in INR: {\{ctrl.totalCost | currency:'INR '}}
  <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
  <span class="tag">&lt;<span class="title">div</span>&gt;</span>
    Shouting the name: {\{ctrl.name | uppercase}}
  <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
  <span class="tag">&lt;<span class="title">div</span>&gt;</span>
  Whispering the name: {\{ctrl.name | lowercase}}
  <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
  <span class="tag">&lt;<span class="title">div</span>&gt;</span>
    Start Time: {\{ctrl.startTime | date:'medium'}}
  <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
<span class="tag">&lt;/<span class="title">div</span>&gt;</span>
<span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span>&gt;</span><span class="javascript">
  angular.module(<span class="string">'filtersApp'</span>, [])
  .controller(<span class="string">'FilterCtrl'</span>, [<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
    <span class="keyword">this</span>.amount = <span class="number">1024</span>;
    <span class="keyword">this</span>.totalCost = <span class="number">4906</span>;
    <span class="keyword">this</span>.name = <span class="string">'Shyam Seshadri'</span>;
    <span class="keyword">this</span>.startTime = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime();
  }]);
</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
</pre></td></tr></table></figure>

<p>The filter will take the value of the expression (a string, number, or array) and convert
it into some other form.</p>
<p><code>{\{ctrl.name | lowercase | limitTo: 5}}</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
</pre></td><td class="code"><pre><span class="tag">&lt;<span class="title">ul</span> <span class="attribute">ng-controller</span>=<span class="value">"FilterCtrl as ctrl"</span>&gt;</span>
<span class="tag">&lt;<span class="title">li</span>&gt;</span>
Amount - {\{ctrl.amount}}
<span class="tag">&lt;/<span class="title">li</span>&gt;</span>
<span class="tag">&lt;<span class="title">li</span>&gt;</span>
Amount - Default Currency: {\{ctrl.amount | currency}}
<span class="tag">&lt;/<span class="title">li</span>&gt;</span>
<span class="tag">&lt;<span class="title">li</span>&gt;</span>
<span class="comment">&lt;!-- Using the English pound sign --&gt;</span>
Amount - INR Currency: {\{ctrl.amount | currency:'&#163 '}}
<span class="tag">&lt;/<span class="title">li</span>&gt;</span>
<span class="tag">&lt;<span class="title">li</span>&gt;</span>
Amount - Number: {\{ctrl.amount | number}}
<span class="tag">&lt;/<span class="title">li</span>&gt;</span>
<span class="tag">&lt;<span class="title">li</span>&gt;</span>
Amount - No. with 4 decimals: {\{ctrl.amount | number:4}}
<span class="tag">&lt;/<span class="title">li</span>&gt;</span>
<span class="tag">&lt;<span class="title">li</span>&gt;</span>
Name with no filters: {\{ctrl.name}}
<span class="tag">&lt;/<span class="title">li</span>&gt;</span>
<span class="tag">&lt;<span class="title">li</span>&gt;</span>
Name - lowercase filter: {\{ctrl.name | lowercase}}
<span class="tag">&lt;/<span class="title">li</span>&gt;</span>
<span class="tag">&lt;<span class="title">li</span>&gt;</span>
Name - uppercase filter: {\{ctrl.name | uppercase}}
<span class="tag">&lt;/<span class="title">li</span>&gt;</span>
<span class="tag">&lt;<span class="title">li</span>&gt;</span>
<span class="comment">&lt;!--  printed as a string {"test": "value", "num": 123}  --&gt;</span>
The JSON Filter: {\{ctrl.obj | json}}
<span class="tag">&lt;/<span class="title">li</span>&gt;</span>
<span class="tag">&lt;<span class="title">li</span>&gt;</span>
Timestamp: {\{ctrl.startTime}}
<span class="tag">&lt;/<span class="title">li</span>&gt;</span>
<span class="tag">&lt;<span class="title">li</span>&gt;</span>
Default Date filter: {\{ctrl.startTime | date}}
<span class="tag">&lt;/<span class="title">li</span>&gt;</span>
<span class="tag">&lt;<span class="title">li</span>&gt;</span>
Medium Date filter: {\{ctrl.startTime | date:'medium'}}
<span class="tag">&lt;/<span class="title">li</span>&gt;</span>
<span class="tag">&lt;<span class="title">li</span>&gt;</span>
Custom Date filter: {\{ctrl.startTime | date:'M/dd, yyyy'}}
<span class="tag">&lt;/<span class="title">li</span>&gt;</span>
<span class="tag">&lt;/<span class="title">ul</span>&gt;</span>
<span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span>&gt;</span><span class="javascript">
angular.module(<span class="string">'filtersApp'</span>, [])
.controller(<span class="string">'FilterCtrl'</span>, [<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
  <span class="keyword">this</span>.amount = <span class="number">1024</span>;
  <span class="keyword">this</span>.name = <span class="string">'Shyam Seshadri'</span>;
  <span class="keyword">this</span>.obj = {test: <span class="string">'value'</span>, num: <span class="number">123</span>};
  <span class="keyword">this</span>.startTime = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime();
}]);
</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
</pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
</pre></td><td class="code"><pre><span class="tag">&lt;<span class="title">div</span> <span class="attribute">ng-controller</span>=<span class="value">"FilterCtrl as ctrl"</span>&gt;</span>
  <span class="tag">&lt;<span class="title">button</span> <span class="attribute">ng-click</span>=<span class="value">"ctrl.currentFilter = 'string'"</span>&gt;</span>
    Filter with String
  <span class="tag">&lt;/<span class="title">button</span>&gt;</span>
  <span class="tag">&lt;<span class="title">button</span> <span class="attribute">ng-click</span>=<span class="value">"ctrl.currentFilter = 'object'"</span>&gt;</span>
    Filter with Object
  <span class="tag">&lt;/<span class="title">button</span>&gt;</span>
  <span class="tag">&lt;<span class="title">button</span> <span class="attribute">ng-click</span>=<span class="value">"ctrl.currentFilter = 'function'"</span>&gt;</span>
    Filter Text
  <span class="tag">&lt;/<span class="title">button</span>&gt;</span>
  <span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"text"</span>
         <span class="attribute">ng-model</span>=<span class="value">"ctrl.filterOptions['string']"</span>&gt;</span>
  Show Done Only
  <span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"checkbox"</span>
         <span class="attribute">ng-model</span>=<span class="value">"ctrl.filterOptions['object'].done"</span>&gt;</span>
  <span class="tag">&lt;<span class="title">ul</span>&gt;</span>
    <span class="tag">&lt;<span class="title">li</span> <span class="attribute">ng-repeat</span>=<span class="value">"note in ctrl.notes |
                   filter:ctrl.filterOptions[ctrl.currentFilter] |
                   orderBy:ctrl.sortOrder |
                   limitTo:5"</span>&gt;</span>
      {\{note.label}} -  - 
    <span class="tag">&lt;/<span class="title">li</span>&gt;</span>
  <span class="tag">&lt;/<span class="title">ul</span>&gt;</span>
<span class="tag">&lt;/<span class="title">div</span>&gt;</span>
<span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span>&gt;</span><span class="javascript">
angular.module(<span class="string">'filtersApp'</span>, [])
.controller(<span class="string">'FilterCtrl'</span>, [<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
  <span class="keyword">this</span>.notes = [
    {label: <span class="string">'FC Todo'</span>, type: <span class="string">'chore'</span>, done: <span class="literal">false</span>},
    {label: <span class="string">'FT Todo'</span>, type: <span class="string">'task'</span>, done: <span class="literal">false</span>},
    {label: <span class="string">'FF Todo'</span>, type: <span class="string">'fun'</span>, done: <span class="literal">true</span>},
    {label: <span class="string">'SC Todo'</span>, type: <span class="string">'chore'</span>, done: <span class="literal">false</span>},
    {label: <span class="string">'ST Todo'</span>, type: <span class="string">'task'</span>, done: <span class="literal">true</span>},
    {label: <span class="string">'SF Todo'</span>, type: <span class="string">'fun'</span>, done: <span class="literal">true</span>},
    {label: <span class="string">'TC Todo'</span>, type: <span class="string">'chore'</span>, done: <span class="literal">false</span>},
    {label: <span class="string">'TT Todo'</span>, type: <span class="string">'task'</span>, done: <span class="literal">false</span>},
    {label: <span class="string">'TF Todo'</span>, type: <span class="string">'fun'</span>, done: <span class="literal">false</span>}
  ];
  <span class="keyword">this</span>.sortOrder = [<span class="string">'+type'</span>, <span class="string">'-label'</span>];
  <span class="keyword">this</span>.filterOptions = {
    <span class="string">"string"</span>: <span class="string">''</span>,
    <span class="string">"object"</span>: {done: <span class="literal">false</span>, label: <span class="string">'C'</span>},
    <span class="string">"function"</span>: <span class="function"><span class="keyword">function</span><span class="params">(note)</span> {</span>
      <span class="keyword">return</span> note.type === <span class="string">'task'</span> && note.done === <span class="literal">false</span>;
    }
  };
  <span class="keyword">this</span>.currentFilter = <span class="string">'string'</span>;
}]);
</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
</pre></td></tr></table></figure>

<ul>
<li><code>string</code>, AngularJS will look for the string in the keys
of each object of the array, and if it is found, the element is included.</li>
<li><code>object</code>, AngularJS takes each key of the object and makes sure that its value
is present in the corresponding key of each object of the array. For example,
an object expression like <code>{size: &quot;M&quot;}</code>would check each item of
the array and ensure that the objects have a key called size
and that they contain the letter “M”</li>
<li><code>function</code>, return true or false</li>
</ul>
<h1 id="using-filters-in-controllers-and-services">Using Filters in Controllers and Services</h1>
<p>AngularJS allows us to use the
filters wherever we want or need
through the power of Dependency Injection. </p>
<p>Any filter, whether built-in or our own,
can be injected into any service or controller by
affixing the word “Filter” at the end of the name of the
filter, and asking it to be injected.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
</pre></td><td class="code"><pre>// <span class="keyword">if</span> we need the currency filter <span class="keyword">in</span> our controller
angular.<span class="built_in">module</span>(<span class="string">'myModule'</span>, [])
.controller(<span class="string">'MyCtrl'</span>, [<span class="string">'currencyFilter'</span>,
  <span class="function"><span class="keyword">function</span><span class="params">(currencyFilter)</span></span> {
    self.filteredArray = filterFilter(self.notes, <span class="string">'ch'</span>);
}]);
</pre></td></tr></table></figure>

<h2 id="creating-angularjs-filters">Creating AngularJS Filters</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
</pre></td><td class="code"><pre><span class="tag">&lt;<span class="title">div</span> <span class="attribute">ng-controller</span>=<span class="value">"FilterCtrl as ctrl"</span>&gt;</span>
  <span class="tag">&lt;<span class="title">div</span>&gt;</span> Start Time (Timestamp): {\{ctrl.startTime}} <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
  <span class="tag">&lt;<span class="title">div</span>&gt;</span> Start Time (DateTime): {\{ctrl.startTime | date:'medium'}} <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
  <span class="tag">&lt;<span class="title">div</span>&gt;</span> Start Time (Our filter): {\{ctrl.startTime | timeAgo}} <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
  <span class="tag">&lt;<span class="title">div</span>&gt;</span> someTimeAgo : {\{ctrl.someTimeAgo | date:'short'}} <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
  <span class="tag">&lt;<span class="title">div</span>&gt;</span> someTimeAgo (Our filter): {\{ctrl.someTimeAgo | timeAgo}} <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
<span class="tag">&lt;/<span class="title">div</span>&gt;</span>
<span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span>&gt;</span><span class="javascript">
angular.module(<span class="string">'filtersApp'</span>, [])
.controller(<span class="string">'FilterCtrl'</span>, [<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
  <span class="keyword">this</span>.startTime = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime();
  <span class="keyword">this</span>.someTimeAgo = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime() - (<span class="number">1000</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">4</span>);
}])
.filter(<span class="string">'timeAgo'</span>, [<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
  <span class="keyword">var</span> ONE_MINUTE = <span class="number">1000</span> * <span class="number">60</span>;
  <span class="keyword">var</span> ONE_HOUR = ONE_MINUTE * <span class="number">60</span>;
  <span class="keyword">var</span> ONE_DAY = ONE_HOUR * <span class="number">24</span>;
  <span class="keyword">var</span> ONE_MONTH = ONE_DAY * <span class="number">30</span>;
  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span><span class="params">(ts)</span> {</span>
    <span class="keyword">var</span> currentTime = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime();
    <span class="keyword">var</span> diff = currentTime - ts;
    <span class="keyword">if</span> (diff &lt; ONE_MINUTE) {
      <span class="keyword">return</span> <span class="string">'seconds ago'</span>;
    } <span class="keyword">else</span> <span class="keyword">if</span> (diff &lt; ONE_HOUR) {
      <span class="keyword">return</span> <span class="string">'minutes ago'</span>;
    } <span class="keyword">else</span> <span class="keyword">if</span> (diff &lt; ONE_DAY) {
      <span class="keyword">return</span> <span class="string">'hours ago'</span>;
    } <span class="keyword">else</span> <span class="keyword">if</span> (diff &lt; ONE_MONTH) {
      <span class="keyword">return</span> <span class="string">'days ago'</span>;
    } <span class="keyword">else</span> {
      <span class="keyword">return</span> <span class="string">'months ago'</span>;
    }
  };
}]);
<span class="comment">//return function(ts, arg1, arg2, arg3) {</span>
<span class="comment">//{\{ctrl.startTime | timeAgo:arg1:arg2:arg3}}</span>
</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
</pre></td></tr></table></figure>

<ul>
<li>View filters are executed every digest cycle</li>
<li>Filters should be blazingly fast</li>
<li>Prefer filters in services and controllers for optimization</li>
</ul>
<h1 id="unit-testing-filters">Unit Testing Filters</h1>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td><td class="code"><pre><span class="comment">// File: chapter9/timeAgoFilter.js</span>
angular.module(<span class="string">'filtersApp'</span>, [])
.filter(<span class="string">'timeAgo'</span>, [<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
  <span class="keyword">var</span> ONE_MINUTE = <span class="number">1000</span> * <span class="number">60</span>;
  <span class="keyword">var</span> ONE_HOUR = ONE_MINUTE * <span class="number">60</span>;
  <span class="keyword">var</span> ONE_DAY = ONE_HOUR * <span class="number">24</span>;
  <span class="keyword">var</span> ONE_MONTH = ONE_DAY * <span class="number">30</span>;
  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span><span class="params">(ts, optShowSecondsMessage)</span> {</span>
    <span class="keyword">if</span> (optShowSecondsMessage !== <span class="literal">false</span>) {
      optShowSecondsMessage = <span class="literal">true</span>;
    }
    <span class="keyword">var</span> currentTime = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime();
    <span class="keyword">var</span> diff = currentTime - ts;
    <span class="keyword">if</span> (diff &lt; ONE_MINUTE && optShowSecondsMessage) {
      <span class="keyword">return</span> <span class="string">'seconds ago'</span>;
    } <span class="keyword">else</span> <span class="keyword">if</span> (diff &lt; ONE_HOUR) {
      <span class="keyword">return</span> <span class="string">'minutes ago'</span>;
    } <span class="keyword">else</span> <span class="keyword">if</span> (diff &lt; ONE_DAY) {
      <span class="keyword">return</span> <span class="string">'hours ago'</span>;
    } <span class="keyword">else</span> <span class="keyword">if</span> (diff &lt; ONE_MONTH) {
      <span class="keyword">return</span> <span class="string">'days ago'</span>;
    } <span class="keyword">else</span> {
      <span class="keyword">return</span> <span class="string">'months ago'</span>;
    }
  };
}]);
</pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre></td><td class="code"><pre><span class="comment">// File: chapter9/timeAgoFilterSpec.js</span>
<span class="function">describe(<span class="string">'timeAgo Filter'</span>, <span class="function">function()</span> {
  <span class="function">beforeEach(<span class="function">module(<span class="string">'filtersApp'</span>)</span>)</span>;
  var filter;
  <span class="function">beforeEach(<span class="function">inject(<span class="function">function(timeAgoFilter)</span> {
    filter = timeAgoFilter;
  })</span>)</span>;
  <span class="function">it(<span class="string">'should respond based on timestamp'</span>, <span class="function">function()</span> {
    // The presence of new <span class="function">Date()</span>.<span class="function">getTime()</span> makes it slightly
    // hard to unit test deterministicly.
    // Ideally, we would inject a dateProvider into the timeAgo
    // filter, but we are trying to keep it simple here.
    // So we will assume that our tests are fast enough to
    // execute in mere milliseconds.
    var currentTime = new <span class="function">Date()</span>.<span class="function">getTime()</span>;
    currentTime -= <span class="number">10000</span>;
    
    <span class="function">expect(<span class="function">filter(currentTime)</span>)</span>.<span class="function">toEqual(<span class="string">'seconds ago'</span>)</span>;
    var fewMinutesAgo = currentTime - <span class="number">1000</span> * <span class="number">60</span>;
    <span class="function">expect(<span class="function">filter(fewMinutesAgo)</span>)</span>.<span class="function">toEqual(<span class="string">'minutes ago'</span>)</span>;
    var fewHoursAgo = currentTime - <span class="number">1000</span> * <span class="number">60</span> * <span class="number">68</span>;
    <span class="function">expect(<span class="function">filter(fewHoursAgo)</span>)</span>.<span class="function">toEqual(<span class="string">'hours ago'</span>)</span>;
    var fewDaysAgo = currentTime - <span class="number">1000</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">26</span>;
    <span class="function">expect(<span class="function">filter(fewDaysAgo)</span>)</span>.<span class="function">toEqual(<span class="string">'days ago'</span>)</span>;
    var fewMonthsAgo = currentTime - <span class="number">1000</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span> * <span class="number">32</span>;
    <span class="function">expect(<span class="function">filter(fewMonthsAgo)</span>)</span>.<span class="function">toEqual(<span class="string">'months ago'</span>)</span>;
  })</span>;
})</span>;
</pre></td></tr></table></figure>

<h1 id="routing-using-ngroute">Routing Using ngRoute</h1>
<p>AngularJS provides us with an optional module called
ngRoute, which can be used to do routing in an AngularJS
application.</p>
<p>We mark in our HTML where we want the routing to take
effect with the <code>ng-view</code> directive.</p>
<p>It takes care of the browser history, so you can actually
use back and forward buttons in your browser to navigate
within the application.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="code"><pre><span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span> <span class="attribute">src</span>=<span class="value">"/path/to/angular-route.min.js"</span>&gt;</span><span class="javascript"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
<span class="tag">&lt;<span class="title">ul</span>&gt;</span>
  <span class="tag">&lt;<span class="title">li</span>&gt;</span><span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"#/"</span>&gt;</span>Default Route<span class="tag">&lt;/<span class="title">a</span>&gt;</span><span class="tag">&lt;/<span class="title">li</span>&gt;</span>
  <span class="tag">&lt;<span class="title">li</span>&gt;</span><span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"#/second"</span>&gt;</span>Second Route<span class="tag">&lt;/<span class="title">a</span>&gt;</span><span class="tag">&lt;/<span class="title">li</span>&gt;</span>
  <span class="tag">&lt;<span class="title">li</span>&gt;</span><span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"#/asdasdasd"</span>&gt;</span>Nonexistent Route<span class="tag">&lt;/<span class="title">a</span>&gt;</span><span class="tag">&lt;/<span class="title">li</span>&gt;</span>
<span class="tag">&lt;/<span class="title">ul</span>&gt;</span>
<span class="tag">&lt;<span class="title">div</span> <span class="attribute">ng-view</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span>
<span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span>&gt;</span><span class="javascript">
angular.module(<span class="string">'routingApp'</span>, [<span class="string">'ngRoute'</span>])
.config([<span class="string">'$routeProvider'</span>, <span class="function"><span class="keyword">function</span><span class="params">($routeProvider)</span> {</span>
  $routeProvider.when(<span class="string">'/'</span>, {
    template: <span class="string">'&lt;h5&gt;This is the default route&lt;/h5&gt;'</span>
  })
  .when(<span class="string">'/second'</span>, {
    template: <span class="string">'&lt;h5&gt;This is the second route&lt;/h5&gt;'</span>
  })
  .otherwise({redirectTo: <span class="string">'/'</span>});
}]);
</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
</pre></td></tr></table></figure>

<h2 id="routing-options">Routing Options</h2>
<p>The AngularJS route definition allows us to
define more complex templates.
The <code>$routeProvider.when</code> function takes a URL or
URL regular expression as the first argument, and the
route configuration object as the second. </p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
</pre></td><td class="code"><pre>$routeProvider.<span class="keyword">when</span>(url, {
  template: <span class="built_in">string</span>,
  templateUrl: <span class="built_in">string</span>,
  controller: <span class="built_in">string</span>, <span class="keyword">function</span> <span class="keyword">or</span> <span class="built_in">array</span>,
  controllerAs: <span class="built_in">string</span>,
  resolve: <span class="keyword">object</span>&lt;key, <span class="keyword">function</span>&gt;
});
</pre></td></tr></table></figure>

<ul>
<li>url, <code>/list</code>, <code>/recipe/:recipeId</code></li>
<li>template, AngularJS directly inserts this template
HTML into the ng-view directive</li>
<li><p>tempateUrl</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre><span class="variable">$routeProvider</span>.<span class="keyword">when</span>(<span class="string">'/test'</span>, {
  <span class="symbol">templateUrl:</span> <span class="string">'views/test.html'</span>,
});
</pre></td></tr></table></figure>
</li>
<li><p>controller, if we have not directly defined the controller in
the HTML using the ng-controller directive, e we pass the con‐
troller function directly to the controller key.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
</pre></td><td class="code"><pre><span class="variable">$routeProvider</span>.when(<span class="string">'/test'</span>, {
  template: <span class="string">'&lt;h1&gt;Test Route&lt;/h1&gt;'</span>,
  controller: [<span class="string">'$window'</span>, <span class="function"><span class="keyword">function</span><span class="params">(<span class="variable">$window</span>)</span> {</span>
    <span class="variable">$window</span>.alert(<span class="string">'Test route has been loaded!'</span>);
  }]
});
</pre></td></tr></table></figure>
</li>
<li><p>controllerAs</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre><span class="variable">$routeProvider</span>.<span class="keyword">when</span>(<span class="string">'/test'</span>, {
  <span class="symbol">template:</span> <span class="string">'&lt;h1&gt;Test Route&lt;/h1&gt;'</span>,
  <span class="symbol">controller:</span> <span class="string">'MyCtrl as ctrl'</span>
});
<span class="variable">$routeProvider</span>.<span class="keyword">when</span>(<span class="string">'/test'</span>, {
  <span class="symbol">template:</span> <span class="string">'&lt;h1&gt;Test Route&lt;/h1&gt;'</span>,
  <span class="symbol">controller:</span> <span class="string">'MyCtrl'</span>,
  <span class="symbol">controllerAs:</span> <span class="string">'ctrl'</span>
});
</pre></td></tr></table></figure>
</li>
<li><p>redirectTo</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
</pre></td><td class="code"><pre><span class="variable">$routeProvider</span>.<span class="keyword">when</span>(<span class="string">'/new'</span>, {
  <span class="symbol">template:</span> <span class="string">'&lt;h1&gt;New Route&lt;/h1&gt;'</span>
});
<span class="variable">$routeProvider</span>.<span class="keyword">when</span>(<span class="string">'/old'</span>, {
  <span class="symbol">redirectTo:</span> <span class="string">'/new'</span>
});
</pre></td></tr></table></figure>
</li>
<li><p>resolve, At a conceptual level, resolves are a way of executing
and finishing asynchronous tasks before a particular route is loaded.
This is a great way to check if the user is logged in and has
authorization and permissions, and even preload some
data before a controller and route are loaded into the view.</p>
</li>
</ul>
<h2 id="using-resolves-for-pre-route-checks">Using Resolves for Pre-Route Checks</h2>
<p>When we define a resolve, we can define a set of
asynchronous tasks to execute before the route is loaded.
A resolve is a set of keys and functions.
Each function can return a value or a promise.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="code"><pre>angular.module(<span class="string">'resolveApp'</span>, [<span class="string">'ngRoute'</span>])
.value(<span class="string">'Constant'</span>, {MAGIC_NUMBER: <span class="number">42</span>})
.config([<span class="string">'$routeProvider'</span>, <span class="function"><span class="keyword">function</span><span class="params">(<span class="variable">$routeProvider</span>)</span> {</span>
  <span class="variable">$routeProvider</span>.when(<span class="string">'/'</span>, {
    template: <span class="string">'&lt;h1&gt;Main Page, no resolves&lt;/h1&gt;'</span>
})
.when(<span class="string">'/protected'</span>, {
  template: <span class="string">'&lt;h2&gt;Protected Page&lt;/h2&gt;'</span>,
  resolve: {
    immediate: [<span class="string">'Constant'</span>, <span class="function"><span class="keyword">function</span><span class="params">(Constant)</span> {</span>
      <span class="keyword">return</span> Constant.MAGIC_NUMBER * <span class="number">4</span>;
    }],
    async: [<span class="string">'$http'</span>, <span class="function"><span class="keyword">function</span><span class="params">(<span class="variable">$http</span>)</span> {</span>
      <span class="keyword">return</span> <span class="variable">$http</span>.get(<span class="string">'/api/hasAccess'</span>);
    }]
  },
  controller: [<span class="string">'$log'</span>, <span class="string">'immediate'</span>, <span class="string">'async'</span>,
    <span class="function"><span class="keyword">function</span><span class="params">(<span class="variable">$log</span>, immediate, async)</span> {</span>
      <span class="variable">$log</span>.log(<span class="string">'Immediate is '</span>, immediate);
      <span class="variable">$log</span>.log(<span class="string">'Server returned for async'</span>, async);
    }]
  });
}]);
</pre></td></tr></table></figure>

<ul>
<li>If the resolve function returns a value, AngularJS immediately finishes executing
and treats it as a successful resolve.</li>
<li>If the resolve function returns a promise, AngularJS waits for the promise to return
and treats the resolve as successful if the promise is successful. If the promise is
rejected, the resolve is treated as a failure.</li>
<li>If there are multiple re
solve keys that make asynchronous calls, AngularJS executes all of them in parallel
and waits for all of them to finish executing before loading the page.</li>
<li>If any of the resolves encounter an error or any of the promises returned are rejected
(is a failure), AngularJS doesn’t load the route.</li>
</ul>
<h2 id="using-the-routeparams-service">Using the $routeParams Service</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="code"><pre>angular.module(<span class="string">'resolveApp'</span>, [<span class="string">'ngRoute'</span>])
.config([<span class="string">'$routeProvider'</span>, <span class="function"><span class="keyword">function</span><span class="params">(<span class="variable">$routeProvider</span>)</span> {</span>
  <span class="variable">$routeProvider</span>.when(<span class="string">'/'</span>, {
    template: <span class="string">'&lt;h1&gt;Main Page&lt;/h1&gt;'</span>
  }).when(<span class="string">'/detail/:detId'</span>, {
    template: <span class="string">'&lt;h2&gt;Loaded '</span> +
      <span class="string">' and query String is &lt;/h2&gt;'</span>,
    controller: [<span class="string">'$routeParams'</span>, <span class="function"><span class="keyword">function</span><span class="params">(<span class="variable">$routeParams</span>)</span> {</span>
      this.detailId = <span class="variable">$routeParams</span>.detId;
      this.qStr = <span class="variable">$routeParams</span>.q;
    }],
    controllerAs: <span class="string">'myCtrl'</span>
  });
}]);
<span class="comment">// /detail/123?q=MySearchParam</span>
</pre></td></tr></table></figure>

<p>For every AngularJS application that uses ngRoute, there can be one and only
one <code>ng-view</code> directive for that application. </p>
<h2 id="a-full-angularjs-routing-example">A Full AngularJS Routing Example</h2>
<ul>
<li>A landing page shows a list of teams. Anybody can access this page.</li>
<li>A login page allows users to log in to the application. Anybody can access this page.</li>
<li>Details pages for teams are access-controlled. Only logged-in users can access the
details page. This is true whether the user logged in right before accessing, or logged
in and then closed the window and came back at any later point. </li>
</ul>
<p>TODO</p>
<h2 id="html5-mode">HTML5 Mode</h2>
<p>A URL like <code>http://www.myawesomeapp.com/#/first/</code> page would look
like <code>http://www.myawesomeapp.com/first/page</code> with HTML5 mode enabled.</p>
<p>To support search engine crawling, it is expected
that the SPA will use hashbang URLs instead of
pure hash URLs (<code>#!</code> instead of <code>#</code>).</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
</pre></td><td class="code"><pre>angular.module(<span class="string">'myHtml5App'</span>, [<span class="string">'ngRoute'</span>])
.config([<span class="string">'$locationProvider'</span>, <span class="string">'$routeProvider'</span>,
  <span class="function"><span class="keyword">function</span><span class="params">(<span class="variable">$locationProvider</span>, <span class="variable">$routeProvider</span>)</span> {</span>
    <span class="variable">$locationProvider</span>.html5Mode(<span class="keyword">true</span>);
    <span class="comment">//Optional</span>
    <span class="variable">$locationProvider</span>.hashPrefix(<span class="string">'!'</span>);
    <span class="comment">// Route configuration here as normal</span>
    <span class="comment">// Route for /first/page</span>
    <span class="comment">// Route for /second/page</span>
}]);
</pre></td></tr></table></figure>

<p>This is to tell the browser where,
in relation to the URL, the static resources
are served from, so that if the application
requests an image or CSS file with a relative
path, it doesn’t take it from the current URL necessarily.</p>
<p>All relative paths would be resolved
relative to /app and not to some other URL. </p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre><span class="tag">&lt;<span class="title">html</span>&gt;</span>
  <span class="tag">&lt;<span class="title">head</span>&gt;</span>
    <span class="tag">&lt;<span class="title">base</span> <span class="attribute">href</span>=<span class="value">"/app"</span> /&gt;</span>
  <span class="tag">&lt;/<span class="title">head</span>&gt;</span>
<span class="tag">&lt;/<span class="title">html</span>&gt;</span>
</pre></td></tr></table></figure>

<h2 id="ui-router">ui-router</h2>
<p>But what if we had more complex requirements and wanted to change different parts
of our UI differently depending on the URL? use <code>ng-show</code> or <code>ng-hide</code> or <code>ng-switch</code></p>
<p><code>ui-router</code> is state-oriented, and by default does
not modify URLs. We need to specify the URL for
each state individually.</p>
<p>We should consider using ui-router
if our project needs or has the following requirements:</p>
<ul>
<li>We need different parts of the page to react differently to URL changes or user
interactions.</li>
<li>We have multiple different (nested) sections of the page that are conditionally
shown for various actions and events.</li>
<li>We don’t need the URL to change while the user navigates throughout our
application.</li>
<li>The entire UI layout needs to change completely across different pages.</li>
</ul>
  
	</div>
		<footer class="article-footer clearfix">




<div class="article-share" id="share">

  <div data-url="http://zhpooer.github.io/2014/12/23/angularjs-4/" data-title="angularjs-Working with Filters &amp; ngRoute | Poe&#39;s World" data-tsina="null" class="share clearfix">
  </div>

</div>
</footer>   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2014/12/24/angularjs-5/" title="angularjs-Directives">
  <strong>PREVIOUS:</strong><br/>
  <span>
  angularjs-Directives</span>
</a>
</div>


<div class="next">
<a href="/2014/12/22/响应式网站/"  title="响应式网站">
 <strong>NEXT:</strong><br/> 
 <span>响应式网站
</span>
</a>
</div>

</nav>

	
<section class="comment">
	<div class="ds-thread"></div>
</section>

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
  <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#what-are-angularjs-filters"><span class="toc-number">1.</span> <span class="toc-text">What Are AngularJS Filters</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#using-filters-in-controllers-and-services"><span class="toc-number">2.</span> <span class="toc-text">Using Filters in Controllers and Services</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#creating-angularjs-filters"><span class="toc-number">2.1.</span> <span class="toc-text">Creating AngularJS Filters</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#unit-testing-filters"><span class="toc-number">3.</span> <span class="toc-text">Unit Testing Filters</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#routing-using-ngroute"><span class="toc-number">4.</span> <span class="toc-text">Routing Using ngRoute</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#routing-options"><span class="toc-number">4.1.</span> <span class="toc-text">Routing Options</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#using-resolves-for-pre-route-checks"><span class="toc-number">4.2.</span> <span class="toc-text">Using Resolves for Pre-Route Checks</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#using-the-routeparams-service"><span class="toc-number">4.3.</span> <span class="toc-text">Using the $routeParams Service</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#a-full-angularjs-routing-example"><span class="toc-number">4.4.</span> <span class="toc-text">A Full AngularJS Routing Example</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#html5-mode"><span class="toc-number">4.5.</span> <span class="toc-text">HTML5 Mode</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ui-router"><span class="toc-number">4.6.</span> <span class="toc-text">ui-router</span></a></li></ol>
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  

  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			<li><a href="/tags/AJAX/" title="AJAX">AJAX<sup>1</sup></a></li>
		
			<li><a href="/tags/Akka/" title="Akka">Akka<sup>1</sup></a></li>
		
			<li><a href="/tags/Android/" title="Android">Android<sup>1</sup></a></li>
		
			<li><a href="/tags/DOM/" title="DOM">DOM<sup>2</sup></a></li>
		
			<li><a href="/tags/EL表达式/" title="EL表达式">EL表达式<sup>1</sup></a></li>
		
			<li><a href="/tags/HBase/" title="HBase">HBase<sup>1</sup></a></li>
		
			<li><a href="/tags/Hadoop/" title="Hadoop">Hadoop<sup>1</sup></a></li>
		
			<li><a href="/tags/Hibernate/" title="Hibernate">Hibernate<sup>2</sup></a></li>
		
			<li><a href="/tags/HttpSession/" title="HttpSession">HttpSession<sup>1</sup></a></li>
		
			<li><a href="/tags/IO/" title="IO">IO<sup>1</sup></a></li>
		
			<li><a href="/tags/Illustrator/" title="Illustrator">Illustrator<sup>3</sup></a></li>
		
			<li><a href="/tags/JSP/" title="JSP">JSP<sup>1</sup></a></li>
		
			<li><a href="/tags/JavaBean/" title="JavaBean">JavaBean<sup>1</sup></a></li>
		
			<li><a href="/tags/JavaScript/" title="JavaScript">JavaScript<sup>1</sup></a></li>
		
			<li><a href="/tags/Mybatis/" title="Mybatis">Mybatis<sup>1</sup></a></li>
		
			<li><a href="/tags/NoSql/" title="NoSql">NoSql<sup>1</sup></a></li>
		
			<li><a href="/tags/SASS/" title="SASS">SASS<sup>1</sup></a></li>
		
			<li><a href="/tags/SAX/" title="SAX">SAX<sup>1</sup></a></li>
		
			<li><a href="/tags/ServletRequest/" title="ServletRequest">ServletRequest<sup>1</sup></a></li>
		
			<li><a href="/tags/ServletResponse/" title="ServletResponse">ServletResponse<sup>1</sup></a></li>
		
		</ul>
</div>


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<div class="social-font" class="clearfix">
		
		
		
		
	</div>
		<p class="copyright">Powered by <a href="http://zespia.tw/hexo/" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/A-limon/pacman" target="_blank" title="Pacman">Pacman</a> © 2015 
		
		<a href="http://zhpooer.github.io" target="_blank" title="zhpooer">zhpooer</a>
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top",Math.max(140,320-$(this).scrollTop()));
    });
  };
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});     
</script>


<script type="text/javascript">
  var duoshuoQuery = {short_name:"zhpoooer"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 





  </body>
</html>
