
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>angularjs-Directives | Poe&#39;s World</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
    
    <meta name="author" content="zhpooer">
    
    <meta name="description" content="What Are Directives
Directives are of two major types in AngularJS

Behavior modifiers: These types of directives work on existing UI and HTML snippet">
    
    
    
    
    <link rel="alternative" href="/atom.xml" title="Poe&#39;s World" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/pacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/pacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

  <body>
    <header>
      <div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.svg" alt="Poe&#39;s World" title="Poe&#39;s World"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Poe&#39;s World">Poe&#39;s World</a></h1>
				<h2 class="blog-motto">竹杖芒鞋轻胜马，一蓑烟雨任平生</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">主页</a></li>
					
						<li><a href="/english-monthly">英语角</a></li>
					
						<li><a href="/about">关于</a></li>
					
						<li><a href="/archives">归档</a></li>
					
					<li>
					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="text" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:zhpooer.github.io">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>

    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2014/12/24/angularjs-5/" title="angularjs-Directives" itemprop="url">angularjs-Directives</a>
  </h1>
  <p class="article-author">By
    
      <a href="http://zhpooer.github.io" title="zhpooer">zhpooer</a>
    </p>
  <p class="article-time">
    <time datetime="2014-12-24T07:34:42.000Z" itemprop="datePublished">12月 24 2014</time>
    更新日期:<time datetime="2014-12-27T10:13:43.000Z" itemprop="dateModified">12月 27 2014</time>
    
  </p>
</header>
	<div class="article-content">
		
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#what-are-directives"><span class="toc-number">1.</span> <span class="toc-text">What Are Directives</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ng-include"><span class="toc-number">2.</span> <span class="toc-text">ng-include</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#limitations-of-ng-include"><span class="toc-number">2.1.</span> <span class="toc-text">Limitations of ng-include</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#ng-switch"><span class="toc-number">3.</span> <span class="toc-text">ng-switch</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#creating-a-directive"><span class="toc-number">4.</span> <span class="toc-text">Creating a Directive</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#restrict"><span class="toc-number">4.1.</span> <span class="toc-text">Restrict</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#the-link-function"><span class="toc-number">4.2.</span> <span class="toc-text">The link Function</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#scope"><span class="toc-number">4.3.</span> <span class="toc-text">Scope</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#replace"><span class="toc-number">4.4.</span> <span class="toc-text">Replace</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#unit-testing-dirctives"><span class="toc-number">5.</span> <span class="toc-text">Unit Testing Dirctives</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#angularjs-life-cycle"><span class="toc-number">6.</span> <span class="toc-text">AngularJS Life Cycle</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#the-digest-cycle"><span class="toc-number">6.1.</span> <span class="toc-text">The Digest Cycle</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#directive-life-cycle"><span class="toc-number">6.2.</span> <span class="toc-text">Directive Life Cycle</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#transclusions"><span class="toc-number">7.</span> <span class="toc-text">Transclusions</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#advanced-transclusion"><span class="toc-number">7.1.</span> <span class="toc-text">Advanced Transclusion</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#directive-controllers-and-require"><span class="toc-number">8.</span> <span class="toc-text">Directive Controllers and require</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#require-options"><span class="toc-number">9.</span> <span class="toc-text">require Options</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#input-directives-with-ng-model"><span class="toc-number">10.</span> <span class="toc-text">Input Directives with ng-model</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#custom-validators"><span class="toc-number">11.</span> <span class="toc-text">Custom Validators</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#compile"><span class="toc-number">12.</span> <span class="toc-text">Compile</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#pre-and-post-linking"><span class="toc-number">12.1.</span> <span class="toc-text">Pre- and Post- Linking</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#priority-and-terminal"><span class="toc-number">13.</span> <span class="toc-text">Priority and Terminal</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#clean-up-and-destroy"><span class="toc-number">14.</span> <span class="toc-text">Clean Up and Destroy</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#watchers"><span class="toc-number">15.</span> <span class="toc-text">Watchers</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-apply-and-digest"><span class="toc-number">16.</span> <span class="toc-text">$apply and $digest</span></a></li></ol>
		</div>
		
		<h1 id="what-are-directives">What Are Directives</h1>
<p>Directives are of two major types in AngularJS</p>
<ul>
<li>Behavior modifiers: These types of directives work on existing UI and HTML snippets, and just add or
modify the existing behavior of what the UI does.</li>
<li>Reusable components: These types of directives are the more common variety, in which the directive cre‐
ates a whole new HTML structure. </li>
</ul>
<h1 id="ng-include">ng-include</h1>
<p>The <code>ng-include</code> directive takes an AngularJS expression
and treats its value as the path to an HTML file.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
</pre></td><td class="code"><pre><span class="comment">&lt;!-- File: chapter11/ng-include/stock.html --&gt;</span>
<span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"stock-dash"</span>&gt;</span>
  Name:
  <span class="tag">&lt;<span class="title">span</span> <span class="attribute">class</span>=<span class="value">"stock-name"</span>
        <span class="attribute">ng-bind</span>=<span class="value">"stock.name"</span>&gt;</span>
  <span class="tag">&lt;/<span class="title">span</span>&gt;</span>
  Price:
  <span class="tag">&lt;<span class="title">span</span> <span class="attribute">class</span>=<span class="value">"stock-price"</span>
        <span class="attribute">ng-bind</span>=<span class="value">"stock.price | currency"</span>&gt;</span>
  <span class="tag">&lt;/<span class="title">span</span>&gt;</span>
  Percentage Change:
  <span class="tag">&lt;<span class="title">span</span> <span class="attribute">class</span>=<span class="value">"stock-change"</span>
        <span class="attribute">ng-bind</span>=<span class="value">"mainCtrl.getChange(stock) + '%'"</span>&gt;</span>
  <span class="tag">&lt;/<span class="title">span</span>&gt;</span>
<span class="tag">&lt;/<span class="title">div</span>&gt;</span>

<span class="tag">&lt;<span class="title">body</span> <span class="attribute">ng-app</span>=<span class="value">"stockMarketApp"</span>&gt;</span>
  <span class="tag">&lt;<span class="title">div</span> <span class="attribute">ng-controller</span>=<span class="value">"MainCtrl as mainCtrl"</span>&gt;</span>
  <span class="tag">&lt;<span class="title">h3</span>&gt;</span>List of Stocks<span class="tag">&lt;/<span class="title">h3</span>&gt;</span>
  <span class="tag">&lt;<span class="title">div</span> <span class="attribute">ng-repeat</span>=<span class="value">"stock in mainCtrl.stocks"</span>&gt;</span>
    <span class="tag">&lt;<span class="title">div</span> <span class="attribute">ng-include</span>=<span class="value">"mainCtrl.stockTemplate"</span>&gt;</span>
    <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
  <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
<span class="tag">&lt;/<span class="title">div</span>&gt;</span>
<span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript">
<span class="comment">// File: chapter11/ng-include/app.js</span>
angular.module(<span class="string">'stockMarketApp'</span>, [])
.controller(<span class="string">'MainCtrl'</span>, [<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
  <span class="keyword">var</span> self = <span class="keyword">this</span>;
  self.stocks = [
    {name: <span class="string">'First Stock'</span>, price: <span class="number">100</span>, previous: <span class="number">220</span>},
    {name: <span class="string">'Second Stock'</span>, price: <span class="number">140</span>, previous: <span class="number">120</span>},
    {name: <span class="string">'Third Stock'</span>, price: <span class="number">110</span>, previous: <span class="number">110</span>},
    {name: <span class="string">'Fourth Stock'</span>, price: <span class="number">400</span>, previous: <span class="number">420</span>}
  ];
  self.stockTemplate = <span class="string">'stock.html'</span>;
  self.getChange = <span class="function"><span class="keyword">function</span><span class="params">(stock)</span> {</span>
    <span class="keyword">return</span> <span class="built_in">Math</span>.ceil((
      (stock.price - stock.previous) / stock.previous) * <span class="number">100</span>);
  };
}]);

</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
</pre></td></tr></table></figure>

<p>We can also do it like this <code>&lt;div ng-include=&quot;&#39;views/stock.html&#39;&quot;&gt;&lt;/div&gt;</code></p>
<h2 id="limitations-of-ng-include">Limitations of ng-include</h2>
<p>Although we changed the name of the variable in the
main <code>index.html</code> file, the <code>stock.html</code> file still
expects a variable calledb stock for it to display.</p>
<h1 id="ng-switch">ng-switch</h1>
<p>The ng-switch is another directive that allows us to add some functionality to the UI
for selectively displaying certain snippets of HTML. It gives us a way of conditionally
including HTML snippets by behaving like a switch case directly in the HTML. </p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre></td><td class="code"><pre><span class="tag">&lt;<span class="title">div</span> <span class="attribute">ng-controller</span>=<span class="value">"MainCtrl as mainCtrl"</span>&gt;</span>
  <span class="tag">&lt;<span class="title">h3</span>&gt;</span>Conditional Elements in HTML<span class="tag">&lt;/<span class="title">h3</span>&gt;</span>
  <span class="tag">&lt;<span class="title">button</span> <span class="attribute">ng-click</span>=<span class="value">"mainCtrl.currentTab = 'tab1'"</span>&gt;</span>
    Tab 1
  <span class="tag">&lt;/<span class="title">button</span>&gt;</span>
  <span class="tag">&lt;<span class="title">button</span> <span class="attribute">ng-click</span>=<span class="value">"mainCtrl.currentTab = 'tab2'"</span>&gt;</span>
    Tab 2
  <span class="tag">&lt;/<span class="title">button</span>&gt;</span>
  <span class="tag">&lt;<span class="title">button</span> <span class="attribute">ng-click</span>=<span class="value">"mainCtrl.currentTab = 'tab3'"</span>&gt;</span>
    Tab 3
  <span class="tag">&lt;/<span class="title">button</span>&gt;</span>
  <span class="tag">&lt;<span class="title">button</span> <span class="attribute">ng-click</span>=<span class="value">"mainCtrl.currentTab = 'something'"</span>&gt;</span>
    Trigger Default
  <span class="tag">&lt;/<span class="title">button</span>&gt;</span>
  <span class="tag">&lt;<span class="title">div</span> <span class="attribute">ng-switch</span>=<span class="value">"mainCtrl.currentTab"</span>&gt;</span>
    <span class="tag">&lt;<span class="title">div</span> <span class="attribute">ng-switch-when</span>=<span class="value">"tab1"</span>&gt;</span>
      Tab 1 is selected
    <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
    <span class="tag">&lt;<span class="title">div</span> <span class="attribute">ng-switch-when</span>=<span class="value">"tab2"</span>&gt;</span>
      Tab 2 is selected
    <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
    <span class="tag">&lt;<span class="title">div</span> <span class="attribute">ng-switch-when</span>=<span class="value">"tab3"</span>&gt;</span>
      Tab 3 is selected
    <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
    <span class="tag">&lt;<span class="title">div</span> <span class="attribute">ng-switch-default</span>&gt;</span>
      No known tab selected
    <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
  <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
<span class="tag">&lt;/<span class="title">div</span>&gt;</span>
</pre></td></tr></table></figure>

<p><code>ng-switch-when</code> does not understand AngularJS
expressions.</p>
<h1 id="creating-a-directive">Creating a Directive</h1>
<p>AngularJS converts dashes to camelCase.
Thus, stock-widget (or STOCK-WIDGET or
even Stock-Widget) in HTML becomes stockWidget in JavaScript.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="code"><pre><span class="tag">&lt;<span class="title">div</span> <span class="attribute">ng-controller</span>=<span class="value">"MainCtrl as mainCtrl"</span>&gt;</span>
  <span class="tag">&lt;<span class="title">h3</span>&gt;</span>List of Stocks<span class="tag">&lt;/<span class="title">h3</span>&gt;</span>
  <span class="tag">&lt;<span class="title">div</span> <span class="attribute">ng-repeat</span>=<span class="value">"stock in mainCtrl.stocks"</span>&gt;</span>
    <span class="tag">&lt;<span class="title">div</span> <span class="attribute">stock-widget</span>&gt;</span> <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
  <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
<span class="tag">&lt;/<span class="title">div</span>&gt;</span>
<span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript">
angular.module(<span class="string">'stockMarketApp'</span>)
.directive(<span class="string">'stockWidget'</span>, [<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
  <span class="keyword">return</span> {
    templateUrl: <span class="string">'stock.html'</span> <span class="comment">// template: &lt;...&gt;</span>
  };
}]);

</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
</pre></td></tr></table></figure>

<h2 id="restrict">Restrict</h2>
<p>The restrict keyword defines how someone using the directive in their code might
use it. The default way of using directives is via attributes of
existing element</p>
<ul>
<li><code>A</code>, The letter A in the value for restrict specifies that the directive can be used as an
attribute on existing HTML elements (such as <code>&lt;div stock-widget&gt;&lt;/div&gt;</code>).</li>
<li><code>E</code>, The letter E in the value for restrict specifies that the directive can be used as a
new HTML element (such as <code>&lt;stock-widget&gt;&lt;/stock-widget&gt;</code>).</li>
<li><code>C</code>, The letter C in the value for restrict specifies that the directive can be used as a
class name in existing HTML elements (such as <code>&lt;div class=&quot;stock-widget&quot;&gt;&lt;/div&gt;</code>).</li>
<li><code>M</code>, The letter M in the value for restrict specifies that the directive can be used as
HTML comments </li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
</pre></td><td class="code"><pre>angular.<span class="built_in">module</span>(<span class="string">'stockMarketApp'</span>)
.directive(<span class="string">'stockWidget'</span>, [<span class="function"><span class="keyword">function</span><span class="params">()</span></span> {
  <span class="keyword">return</span> {
    templateUrl: <span class="string">'stock.html'</span>,
    restrict: <span class="string">'AE'</span>
  };
}]);
</pre></td></tr></table></figure>

<p>Best Practice</p>
<ul>
<li>Internet Explorer 8 and below do not like custom HTML elements.
AngularJS, with version 1.3 onwards, has dropped support for
(or rather, testing on) Internet Explorer 8.</li>
<li>Class-based directives are ideal for rendering-related work, like the ng-cloak</li>
<li>Element directives are recommended if we are creating entirely new HTML content.</li>
<li>Attribute directives are usually preferred for behavior modifiers.
(like <code>ng-show</code>, <code>ng-class</code>, and so on)</li>
</ul>
<h2 id="the-link-function">The link Function</h2>
<p>The link function does for a directive what a controller does
for a view—it defines APIs and functions that are necessary for the directive, in addition
to manipulating and working with the DOM.</p>
<p>AngularJS executes the link function for each instance of the directive, so each instance
can get its own, fully contained business logic while not affecting any other instance of
the directive. <code>link: function($scope, $element, $attr){}</code></p>
<p>If we need to add functionality to our instance of the directive, we can add it
to the scope of the element we’re working with.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="code"><pre><span class="comment">// File: chapter11/directive-with-link/directive.js</span>
angular.module(<span class="string">'stockMarketApp'</span>)
.directive(<span class="string">'stockWidget'</span>, [<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
  <span class="keyword">return</span> {
    templateUrl: <span class="string">'stock.html'</span>,
    restrict: <span class="string">'AE'</span>,
    link: <span class="function"><span class="keyword">function</span><span class="params">(<span class="variable">$scope</span>, <span class="variable">$element</span>, <span class="variable">$attrs</span>)</span> {</span>
      <span class="variable">$scope</span>.getChange = <span class="function"><span class="keyword">function</span><span class="params">(stock)</span> {</span>
      <span class="keyword">return</span> Math.ceil(((stock.price - stock.previous) /
        stock.previous) * <span class="number">100</span>);
      };
    }
  };
}]);
</pre></td></tr></table></figure>

<h2 id="scope">Scope</h2>
<p>By default, each directive inherits its parent’s scope, which is passed to it in the link
function. This can lead to the following problems:</p>
<ul>
<li>Adding variables/functions to the scope modifies the parent as well, which suddenly
gets access to more variables and functions.</li>
<li>The directive might unintentionally override an existing function or variable with
the same name.</li>
<li>The directive can implicitly start using variables and functions from the parent.
This might cause issues if we start renaming properties in the parent and forget to
do it in the directive.</li>
</ul>
<p>AngularJS gives us the scope key in the directive definition object to have complete
control over the scope of the directive element.</p>
<ul>
<li><code>false</code> This is the default value, which basically tells AngularJS that the directive scope is
the same as the parent scope, whichever one it is. So the directive gets access to all
the variables and functions that are defined on the parent scope, and any
modifications it makes are immediately reflected in the parent as well.</li>
<li><code>true</code> This tells AngularJS that the directive scope inherits the parent
scope, but creates a child scope of its own. The directive thus gets
access to all the variables and functions from the parent scope.</li>
<li><code>object</code> We can also pass an object with keys and values to the scope. This tells AngularJS
to create what we call an isolated scope.</li>
</ul>
<p>In particular, we can specify three types of values that can be passed in,
which AngularJS will directly put on the scope of the directive:</p>
<ul>
<li><code>=</code>,   the value of the attribute in HTML to be treated as a
JSON object, which will be bound to the scope of the directive so that any changes
done in the parent scope will be automatically available in the directive.</li>
<li><code>@</code>, the value of the attribute in HTML is to be treated as a
string, which may or may not have AngularJS binding expressions (<code>{\{ }}</code>).</li>
<li><code>&amp;</code>,  the value of the attribute in HTML is a function in some
controller whose reference needs to be available to the directive.</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
</pre></td><td class="code"><pre><span class="tag">&lt;<span class="title">div</span> <span class="attribute">ng-controller</span>=<span class="value">"MainCtrl as mainCtrl"</span>&gt;</span>
  <span class="tag">&lt;<span class="title">h3</span>&gt;</span>List of Stocks<span class="tag">&lt;/<span class="title">h3</span>&gt;</span>
    <span class="tag">&lt;<span class="title">div</span> <span class="attribute">ng-repeat</span>=<span class="value">"s in mainCtrl.stocks"</span>&gt;</span>
      <span class="tag">&lt;<span class="title">div</span> <span class="attribute">stock-widget</span> <span class="attribute">stock-data</span>=<span class="value">"s"</span>&gt;</span>
    <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
  <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
<span class="tag">&lt;/<span class="title">div</span>&gt;</span>
<span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript">
<span class="comment">// File: chapter11/directive-with-scope/directive.js</span>
angular.module(<span class="string">'stockMarketApp'</span>)
.directive(<span class="string">'stockWidget'</span>, [<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
  <span class="keyword">return</span> {
    templateUrl: <span class="string">'stock.html'</span>,
    restrict: <span class="string">'A'</span>,
    scope: {
      stockData: <span class="string">'='</span>
    },
    link: <span class="function"><span class="keyword">function</span><span class="params">($scope, $element, $attrs)</span> {</span>
      $scope.getChange = <span class="function"><span class="keyword">function</span><span class="params">(stock)</span> {</span>
        <span class="keyword">return</span> <span class="built_in">Math</span>.ceil(((stock.price - stock.previous) /
        stock.previous) * <span class="number">100</span>);
      };
    }
  };
}]);
</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
<span class="comment">&lt;!-- File: chapter11/directive-with-scope/stock.html --&gt;</span>
<span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"stock-dash"</span>&gt;</span>
  Name:
  <span class="tag">&lt;<span class="title">span</span> <span class="attribute">class</span>=<span class="value">"stock-name"</span>
        <span class="attribute">ng-bind</span>=<span class="value">"stockData.name"</span>&gt;</span>
  <span class="tag">&lt;/<span class="title">span</span>&gt;</span>
  Price:
  <span class="tag">&lt;<span class="title">span</span> <span class="attribute">class</span>=<span class="value">"stock-price"</span>
        <span class="attribute">ng-bind</span>=<span class="value">"stockData.price | currency"</span>&gt;</span>
  <span class="tag">&lt;/<span class="title">span</span>&gt;</span>
  Percentage Change:
  <span class="tag">&lt;<span class="title">span</span> <span class="attribute">class</span>=<span class="value">"stock-change"</span>
        <span class="attribute">ng-bind</span>=<span class="value">"getChange(stockData) + '%'"</span>&gt;</span>
  <span class="tag">&lt;/<span class="title">span</span>&gt;</span>
<span class="tag">&lt;/<span class="title">div</span>&gt;</span>
</pre></td></tr></table></figure>

<h2 id="replace">Replace</h2>
<p>For such cases, AngularJS offers the replace key as part of the directive definition object.
The replace key takes a Boolean, and it defaults to false. If we specify it to true,
AngularJS removes the element that the directive is declared on, and replaces it with
the HTML template from the directive definition object.</p>
<p>With AngularJS version 1.3 forward, the replace keyword in the
directive definition object has been deprecated.</p>
<h1 id="unit-testing-dirctives">Unit Testing Dirctives</h1>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td><td class="code"><pre><span class="comment">// File: chapter12/stockDirective.js</span>
angular.module(<span class="string">'stockMarketApp'</span>, [])
.directive(<span class="string">'stockWidget'</span>, [<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
  <span class="keyword">return</span> {
    templateUrl: <span class="string">'stock.html'</span>,
    restrict: <span class="string">'A'</span>,
    scope: {
      stockData: <span class="string">'='</span>,
      stockTitle: <span class="string">'@'</span>,
      whenSelect: <span class="string">'&'</span>
    },
    link: <span class="function"><span class="keyword">function</span><span class="params">(<span class="variable">$scope</span>, <span class="variable">$element</span>, <span class="variable">$attrs</span>)</span> {</span>
      <span class="variable">$scope</span>.getChange = <span class="function"><span class="keyword">function</span><span class="params">(stock)</span> {</span>
      <span class="keyword">return</span> Math.ceil(((stock.price - stock.previous) /
        stock.previous) * <span class="number">100</span>);
      };
      <span class="variable">$scope</span>.onSelect = <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
      <span class="variable">$scope</span>.whenSelect({
        stockName: <span class="variable">$scope</span>.stockData.name,
        stockPrice: <span class="variable">$scope</span>.stockData.price,
        stockPrevious: <span class="variable">$scope</span>.stockData.previous
      });
    };
  }
};
}]);
</pre></td></tr></table></figure>

<ol>
<li>Get the <code>$compile</code> service injected into our test.</li>
<li>Set up our directive instance HTML.</li>
<li>Create and set up our scope with the necessary variables.</li>
<li>Determine the template to load because our server is mocked out.</li>
<li>Instantiate an instance of our directive using the <code>$compile</code> service.</li>
<li>Write our expectations for rendering and behavior.</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
</pre></td><td class="code"><pre><span class="comment">// File: chapter12/stockDirectiveRenderSpec.js</span>
describe(<span class="string">'Stock Widget Directive Rendering'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
  beforeEach(module(<span class="string">'stockMarketApp'</span>));
  <span class="keyword">var</span> compile, mockBackend, rootScope;
  <span class="comment">// Step 1</span>
  beforeEach(inject(<span class="function"><span class="keyword">function</span><span class="params">(<span class="variable">$compile</span>, <span class="variable">$httpBackend</span>, <span class="variable">$rootScope</span>)</span> {</span>
    compile = <span class="variable">$compile</span>;
    mockBackend = <span class="variable">$httpBackend</span>;
    rootScope = <span class="variable">$rootScope</span>;
  }));
  it(<span class="string">'should render HTML based on scope correctly'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
    <span class="comment">// Step 2</span>
    <span class="keyword">var</span> scope = rootScope.<span class="variable">$new</span>();
    scope.myStock = {
      name: <span class="string">'Best Stock'</span>,
      price: <span class="number">100</span>,
      previous: <span class="number">200</span>
    };
    scope.title = <span class="string">'the best'</span>;
    <span class="comment">// Step 3</span>
    mockBackend.expectGET(<span class="string">'stock.html'</span>).respond(
      <span class="string">'&lt;div ng-bind="stockTitle"&gt;&lt;/div&gt;'</span> +
      <span class="string">'&lt;div ng-bind="stockData.price"&gt;&lt;/div&gt;'</span>);
    <span class="comment">// Step 4</span>
    <span class="keyword">var</span> element = compile(<span class="string">'&lt;div stock-widget'</span> +
      <span class="string">' stock-data="myStock"'</span> +
      <span class="string">' stock-title="This is {\{title}}"&gt;&lt;/div&gt;'</span>)(scope);
    <span class="comment">// Step 5</span>
    scope.<span class="variable">$digest</span>();
    mockBackend.flush();
    <span class="comment">// Step 6</span>
    expect(element.html()).toEqual(
      <span class="string">'&lt;div ng-bind="stockTitle" class="ng-binding"&gt;'</span> +
      <span class="string">'This is the best'</span> +
      <span class="string">'&lt;/div&gt;'</span> +
      <span class="string">'&lt;div ng-bind="stockData.price" class="ng-binding"&gt;'</span> +
      <span class="string">'100'</span> +
      <span class="string">'&lt;/div&gt;'</span>);


    <span class="comment">// Step 6</span>
    <span class="keyword">var</span> compiledElementScope = element.isolateScope();
    expect(compiledElementScope.stockData)
      .toEqual(scope.myStock);
    expect(compiledElementScope.getChange(
      compiledElementScope.stockData)).toEqual(-<span class="number">50</span>);
    <span class="comment">// Step 7</span>
    expect(scopeClickCalled).toEqual(<span class="string">''</span>);
    compiledElementScope.onSelect();
    expect(scopeClickCalled).toEqual(<span class="string">'100;200;Best Stock'</span>);
  });
});
</pre></td></tr></table></figure>

<h1 id="angularjs-life-cycle">AngularJS Life Cycle</h1>
<p>When an AngularJS application is loaded in our browser window, the following events
are executed in order:</p>
<ol>
<li>The HTML page is loaded:<ul>
<li>The HTML page loads the AngularJS source code (with jQuery optionally loaded before).</li>
<li>The HTML page loads the application’s JavaScript code.</li>
</ul>
</li>
<li>The HTML page finishes loading.</li>
<li>When the document ready event is fired, AngularJS bootstraps and searches for
any and all instances of the ng-app attribute in the HTML:</li>
<li>Within the context of each (there could be more than one) ng-app, AngularJS starts
its magic by running the HTML content inside ng-app through what is known as
the compile step:<ul>
<li>The compile step goes through each line of HTML and looks for AngularJS
directives.</li>
<li>For each directive, it executes the necessary code as defined by that directive’s
definition object.</li>
<li>At the end of the compile step, a link function is generated for each directive
that has a handle on all the elements and attributes that need to be controlled by
AngularJS.</li>
</ul>
</li>
<li>AngularJS takes the link function and combines it with scope.</li>
<li>At the end of this, we have a live, interactive view with the content filled in for the
user.</li>
</ol>
<p>AngularJS adds watchers for all its bindings and ng-model. And whenever one
of the aforementioned events happens, AngularJS checks its watchers
and bindings to see if anything has changed.</p>
<h2 id="the-digest-cycle">The Digest Cycle</h2>
<p>The digest cycle in AngularJS is responsible for keeping the UI up to date in an AngularJS
application. The AngularJS UI update cycle happens as follows:</p>
<ol>
<li>When the application loads, or when any HTML is loaded within AngularJS,
AngularJS runs its compilations step, and keeps track of all the watchers and listeners
that are needed for the HTML</li>
<li>AngularJS also keeps track of all the elements that are bound to the HTML for each
scope.</li>
<li>When one of the events mentioned in the previous section
happens, AngularJS triggers the digest cycle.</li>
<li>In the digest cycle, AngularJS starts from $rootScope and checks each watcher in
the scope to see if the current value differs from the value it’s displaying in the UI.</li>
<li>If nothing has changed, it recurses to all the parent scopes and so on until all the
scopes are verified.</li>
<li>If AngularJS finds a watcher at any scope that reports a change in state, AngularJS
stops right there, and reruns the digest cycle.</li>
<li>The digest cycle is rerun because a change in a watcher might have an implication
on a watcher that was already evaluated beforehand. To ensure that no data change
is missed, the digest cycle is rerun.</li>
<li>AngularJS reruns the digest cycle every time it encounters a change until the digest
cycle stabilizes.</li>
<li>When the digest stabilizes, AngularJS accumulates all the UI updates and triggers
them at once.</li>
</ol>
<h2 id="directive-life-cycle">Directive Life Cycle</h2>
<ol>
<li>When the application loads, the directive definition object is triggered. This hap‐
pens only once.</li>
<li>Next, when the directive is encountered in the HTML the very first time, the tem‐
plate for the directive is loaded.</li>
<li>This template is then compiled and AngularJS handles the other directives present
in the HTML. This generates a link function that can be used to link the directive
to a scope.</li>
<li>The scope for the directive instance is created or acquired. This could be the parent
scope, a child of the parent scope, or an isolated scope as the case might be </li>
<li>The link function (and the controller) execute for the directive.</li>
</ol>
<h1 id="transclusions">Transclusions</h1>
<p>AngularJS directives have a concept of transclusions to allow us to create
reusable directives where each implementation might need to render a
certain section of the UI differently. </p>
<ol>
<li>First, we tell the directive that we are going to use transclusion as part of this di‐
rective.</li>
<li>Second, we need to tell AngularJS where to put the content that was stored in the
template.</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre></td><td class="code"><pre><span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript">
<span class="comment">// File: chapter13/directive-transclusion/directive.js</span>
angular.module(<span class="string">'stockMarketApp'</span>)
.directive(<span class="string">'stockWidget'</span>, [<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
  <span class="keyword">return</span> {
    templateUrl: <span class="string">'stock.html'</span>,
    restrict: <span class="string">'A'</span>,
    transclude: <span class="literal">true</span>,
    scope: {
      stockData: <span class="string">'='</span>
    },
    link: <span class="function"><span class="keyword">function</span><span class="params">($scope, $element, $attrs)</span> {</span>
      $scope.getChange = <span class="function"><span class="keyword">function</span><span class="params">(stock)</span> {</span>
        <span class="keyword">return</span> <span class="built_in">Math</span>.ceil(((stock.price - stock.previous) /
          stock.previous) * <span class="number">100</span>);
      };
    }
  };
}]);
</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>

<span class="comment">&lt;!-- File: chapter13/directive-transclusion/stock.html --&gt;</span>
<span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"stock-dash"</span>&gt;</span>
  <span class="tag">&lt;<span class="title">span</span> <span class="attribute">ng-transclude</span>&gt;</span><span class="tag">&lt;/<span class="title">span</span>&gt;</span>
  Price:
  <span class="tag">&lt;<span class="title">span</span> <span class="attribute">class</span>=<span class="value">"stock-price"</span>
        <span class="attribute">ng-bind</span>=<span class="value">"stockData.price | currency"</span>&gt;</span>
  <span class="tag">&lt;/<span class="title">span</span>&gt;</span>
  Percentage Change:
  <span class="tag">&lt;<span class="title">span</span> <span class="attribute">class</span>=<span class="value">"stock-change"</span>
        <span class="attribute">ng-bind</span>=<span class="value">"getChange(stockData) + '%'"</span>&gt;</span>
  <span class="tag">&lt;/<span class="title">span</span>&gt;</span>
<span class="tag">&lt;/<span class="title">div</span>&gt;</span>
</pre></td></tr></table></figure>

<p>The <code>ng-transclude</code> content explicitly refers to something that
is available in the scope of ng-repeat,
but not inside the directive’s scope.</p>
<p>Thus, the transcluded content and the directive content form a
sibling relationship but do not share the same scope.</p>
<h2 id="advanced-transclusion">Advanced Transclusion</h2>
<p>We try to create a trivial replacement for the <code>ng-repeat</code> that will pick up
some variables from our outer scope, and add some variables for each instance.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
</pre></td><td class="code"><pre>&lt;script&gt;
<span class="comment">// File: chapter13/directive-advanced-transclusion/app.js</span>
angular.module(<span class="string">'stockMarketApp'</span>, [])
.controller(<span class="string">'MainCtrl'</span>, [<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
  <span class="keyword">var</span> <span class="keyword">self</span> = this;
  <span class="keyword">self</span>.stocks = [
    {name: <span class="string">'First Stock'</span>, price: <span class="number">100</span>, previous: <span class="number">220</span>},
    {name: <span class="string">'Second Stock'</span>, price: <span class="number">140</span>, previous: <span class="number">120</span>},
    {name: <span class="string">'Third Stock'</span>, price: <span class="number">110</span>, previous: <span class="number">110</span>},
    {name: <span class="string">'Fourth Stock'</span>, price: <span class="number">400</span>, previous: <span class="number">420</span>}
  ];
}]);


<span class="comment">// File: chapter13/directive-advanced-transclusion/directive.js</span>
angular.module(<span class="string">'stockMarketApp'</span>).directive(<span class="string">'simpleStockRepeat'</span>,
  [<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
    <span class="keyword">return</span> {
      restrict: <span class="string">'A'</span>,
      <span class="comment">// Capture and replace the entire element</span>
      <span class="comment">// instead of just its content</span>
      transclude: <span class="string">'element'</span>,
      <span class="comment">// A $transclude is passed in as the fifth</span>
      <span class="comment">// argument to the link function</span>
      link: <span class="function"><span class="keyword">function</span><span class="params">(<span class="variable">$scope</span>, <span class="variable">$element</span>, <span class="variable">$attrs</span>, ctrl, <span class="variable">$transclude</span>)</span> {</span>
        <span class="keyword">var</span> myArray = <span class="variable">$scope</span>.<span class="variable">$eval</span>(<span class="variable">$attrs</span>.simpleStockRepeat);
        <span class="keyword">var</span> container = angular.element(
          <span class="string">'&lt;div class="container"&gt;&lt;/div&gt;'</span>);
        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; myArray.length; i++) {
          <span class="comment">// Create an element instance with a new child</span>
          <span class="comment">// scope using the clone linking function</span>
          <span class="keyword">var</span> instance = <span class="variable">$transclude</span>(<span class="variable">$scope</span>.<span class="variable">$new</span>(),
            <span class="function"><span class="keyword">function</span><span class="params">(clonedElement, newScope)</span> {</span>
              <span class="comment">// Expose custom variables for the instance</span>
              newScope.currentIndex = i;
              newScope.stock = myArray[i];
            });
          <span class="comment">// Add it to our container</span>
          container.append(instance);
        }
        <span class="comment">// With transclude: 'element', the element gets replaced</span>
        <span class="comment">// with a comment. Add our generated content</span>
        <span class="comment">// after the comment</span>
        <span class="variable">$element</span>.after(container);
      }
    };
}]);
&lt;/script&gt;

&lt;div ng-controller=<span class="string">"MainCtrl as mainCtrl"</span>&gt;
  &lt;h3&gt;<span class="keyword">List</span> of Stocks&lt;/h3&gt;
  &lt;div simple-stock-repeat=<span class="string">"mainCtrl.stocks"</span>&gt;
    We found {\{stock.name}} at {\{currentIndex}}
  &lt;/div&gt;
&lt;/div&gt;
</pre></td></tr></table></figure>

<p> Because transclude <code>element</code> copies the entire element, it also removes the element
from the HTML</p>
<h1 id="directive-controllers-and-require">Directive Controllers and require</h1>
<p>Directive controllers are used in AngularJS for inter-directive communication, while
link functions are fully contained and specific to the directive instance. </p>
<p>By inter-directive communication, we mean when one directive on
an element wants to communicate with another directive on its
parent or on the same element.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
</pre></td><td class="code"><pre><span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript">
angular.module(<span class="string">'stockMarketApp'</span>, [])
.controller(<span class="string">'MainCtrl'</span>, [<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
  <span class="keyword">var</span> self = <span class="keyword">this</span>;
  self.startedTime = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime();
  self.stocks = [
    {name: <span class="string">'First Stock'</span>, price: <span class="number">100</span>, previous: <span class="number">220</span>},
    {name: <span class="string">'Second Stock'</span>, price: <span class="number">140</span>, previous: <span class="number">120</span>},
    {name: <span class="string">'Third Stock'</span>, price: <span class="number">110</span>, previous: <span class="number">110</span>},
    {name: <span class="string">'Fourth Stock'</span>, price: <span class="number">400</span>, previous: <span class="number">420</span>}
  ];
}]);

<span class="comment">// File: chapter13/directive-controllers/tabs.js</span>
angular.module(<span class="string">'stockMarketApp'</span>)
.directive(<span class="string">'tabs'</span>, [<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
  <span class="keyword">return</span> {
    restrict: <span class="string">'E'</span>,
    transclude: <span class="literal">true</span>,
    scope: <span class="literal">true</span>,
    template: <span class="string">'&lt;div class="tab-headers"&gt;'</span> +
      <span class="string">' &lt;div ng-repeat="tab in tabs"'</span> +
      <span class="string">'ng-click="selectTab($index)"'</span> +
      <span class="string">'ng-class="{selected: isSelectedTab($index)}"&gt;'</span> +
      <span class="string">'&lt;span ng-bind="tab.title"&gt;&lt;/span&gt;'</span> +
      <span class="string">' &lt;/div&gt;'</span> +
      <span class="string">'&lt;/div&gt;'</span> +
      <span class="string">'&lt;div ng-transclude&gt;&lt;/div&gt; '</span>,
    controller: <span class="function"><span class="keyword">function</span><span class="params">($scope)</span> {</span>
      <span class="keyword">var</span> currentIndex = <span class="number">0</span>;
      $scope.tabs = [];
      <span class="keyword">this</span>.registerTab = <span class="function"><span class="keyword">function</span><span class="params">(title, scope)</span> {</span>
        <span class="keyword">if</span> ($scope.tabs.length === <span class="number">0</span>) {
          scope.selected = <span class="literal">true</span>;
        } <span class="keyword">else</span> {
          scope.selected = <span class="literal">false</span>;
        }
        $scope.tabs.push({title: title, scope: scope});
      };
      $scope.selectTab = <span class="function"><span class="keyword">function</span><span class="params">(index)</span> {</span>
        currentIndex = index;
        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; $scope.tabs.length; i++) {
          $scope.tabs[i].scope.selected = currentIndex === i;
        }
      };
      $scope.isSelectedTab = <span class="function"><span class="keyword">function</span><span class="params">(index)</span> {</span>
        <span class="keyword">return</span> currentIndex === index;
      };
    }
  };
}]);

<span class="comment">// File: chapter13/directive-controllers/tab.js</span>
angular.module(<span class="string">'stockMarketApp'</span>)
.directive(<span class="string">'tab'</span>, [<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
  <span class="keyword">return</span> {
    restrict: <span class="string">'E'</span>,
    transclude: <span class="literal">true</span>,
    template: <span class="string">'&lt;div ng-show="selected" ng-transclude&gt;&lt;/div&gt;'</span>,
    <span class="built_in">require</span>: <span class="string">'^tabs'</span>,
    scope: <span class="literal">true</span>,
    link: <span class="function"><span class="keyword">function</span><span class="params">($scope, $element, $attr, tabCtrl)</span> {</span>
      tabCtrl.registerTab($attr.title, $scope);
    }
  };
}]);
</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>

<span class="tag">&lt;<span class="title">div</span> <span class="attribute">ng-controller</span>=<span class="value">"MainCtrl as mainCtrl"</span>&gt;</span>
  <span class="tag">&lt;<span class="title">tabs</span>&gt;</span>
    <span class="tag">&lt;<span class="title">tab</span> <span class="attribute">title</span>=<span class="value">"First Tab"</span>&gt;</span>
      This is the first tab.
      The app started at {\{mainCtrl.startedTime | date}}
    <span class="tag">&lt;/<span class="title">tab</span>&gt;</span>
    <span class="tag">&lt;<span class="title">tab</span> <span class="attribute">title</span>=<span class="value">"Second Tab"</span>&gt;</span>
      This is the second tab
      <span class="tag">&lt;<span class="title">div</span> <span class="attribute">ng-repeat</span>=<span class="value">"stock in mainCtrl.stocks"</span>&gt;</span>
           Stock Name: {\{stock.name}}
      <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
    <span class="tag">&lt;/<span class="title">tab</span>&gt;</span>
  <span class="tag">&lt;/<span class="title">tabs</span>&gt;</span>
<span class="tag">&lt;/<span class="title">div</span>&gt;</span>
</pre></td></tr></table></figure>

<p>A directive controller is a function that gets
the scope and element injected in.</p>
<p>The controller can define functions that are specific to the directive instance
by defining them on <code>$scope</code> as we have been doing so far, and define the API
or accessible functions and variables by defining them on this or the
controller’s instance.</p>
<h1 id="require-options">require Options</h1>
<p>The require keyword in the directive definition object either takes a string or an array
of strings, each of which is the name of the directive that must be used in conjunction
with the current directive.</p>
<ul>
<li><code>require: &#39;tabs&#39;</code>,tells AngularJS to look for a directive called tabs, which exposes a controller on the
same element the directive is on. Implies that AngularJS should locate the directive tabs on the same element, and throw
an error if it’s not found:</li>
<li><code>require: [&#39;tabs&#39;, &#39;ngModel&#39;]</code>, tells AngularJS that both the tabs and ng-model directives must be present on the ele‐
ment our directive is used on. When used as an array, the link function gets an array
of controllers as the fourth argument, instead of just one controller.</li>
<li><code>require: &#39;?tabs&#39;</code> tells AngularJS to treat the directive as an optional dependency.</li>
<li><code>require: &#39;^tabs&#39;</code> tells AngularJS that the tabs directive must be present on one of the parent elements.</li>
<li><code>require: &#39;?^tabs&#39;</code></li>
</ul>
<h1 id="input-directives-with-ng-model">Input Directives with ng-model</h1>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
</pre></td><td class="code"><pre><span class="subst">&lt;</span>div ng<span class="attribute">-controller</span><span class="subst">=</span><span class="string">"MainCtrl as mainCtrl"</span><span class="subst">&gt;</span>
  <span class="subst">&lt;</span>div<span class="subst">&gt;</span>
  The current value of the slider is 
  <span class="subst">&lt;</span>/div<span class="subst">&gt;</span>
  <span class="subst">&lt;</span>no<span class="attribute">-ui</span><span class="attribute">-slider</span> class<span class="subst">=</span><span class="string">"slider"</span>
                ng<span class="attribute">-model</span><span class="subst">=</span><span class="string">"mainCtrl.selectedValue"</span>
                range<span class="attribute">-min</span><span class="subst">=</span><span class="string">"500"</span>
                range<span class="attribute">-max</span><span class="subst">=</span><span class="string">"5000"</span><span class="subst">&gt;</span>
  <span class="subst">&lt;</span>/no<span class="attribute">-ui</span><span class="attribute">-slider</span><span class="subst">&gt;</span>
  <span class="subst">&lt;</span>div<span class="subst">&gt;</span>
    <span class="subst">&lt;</span>input <span class="keyword">type</span><span class="subst">=</span><span class="string">"number"</span>
           ng<span class="attribute">-model</span><span class="subst">=</span><span class="string">"mainCtrl.textValue"</span>
           <span class="keyword">min</span><span class="subst">=</span><span class="string">"500"</span>
           <span class="keyword">max</span><span class="subst">=</span><span class="string">"5000"</span>
           placeholder<span class="subst">=</span><span class="string">"Set a value"</span><span class="subst">&gt;</span>
    <span class="subst">&lt;</span>button ng<span class="attribute">-click</span><span class="subst">=</span><span class="string">"mainCtrl.setSelectedValue()"</span><span class="subst">&gt;</span>
      <span class="built_in">Set</span> slider value
    <span class="subst">&lt;</span>/button<span class="subst">&gt;</span>
  <span class="subst">&lt;</span>/div<span class="subst">&gt;</span>
<span class="subst">&lt;</span>/div<span class="subst">&gt;</span>


<span class="subst">&lt;</span>scirpt<span class="subst">&gt;</span>
<span class="comment">// File: chapter13/directive-slider/app.js</span>
angular<span class="built_in">.</span>module(<span class="string">'sliderApp'</span>, <span class="preprocessor">[</span><span class="preprocessor">]</span><span class="markup">)
  .controller('MainCtrl', </span><span class="preprocessor">[</span>function() {
    <span class="built_in">var</span> <span class="built_in">self</span> <span class="subst">=</span> this;
    <span class="built_in">self</span><span class="built_in">.</span>selectedValue <span class="subst">=</span> <span class="number">2000</span>;
    <span class="built_in">self</span><span class="built_in">.</span>textValue <span class="subst">=</span> <span class="number">4000</span>;
    <span class="built_in">self</span><span class="built_in">.</span>setSelectedValue <span class="subst">=</span> function() {
    <span class="built_in">self</span><span class="built_in">.</span>selectedValue <span class="subst">=</span> <span class="built_in">self</span><span class="built_in">.</span>textValue;
  };
}<span class="preprocessor">]</span><span class="markup">);



// File: chapter13/directive-slider/noui-slider.js
angular.module('sliderApp')
.directive('noUiSlider', </span><span class="preprocessor">[</span>function() {
  <span class="keyword">return</span> {
    restrict: <span class="string">'E'</span>,
    <span class="keyword">require</span>: <span class="string">'ngModel'</span>,
    <span class="keyword">link</span>: function(<span class="variable">$scope</span>, <span class="variable">$element</span>, <span class="variable">$attr</span>, ngModelCtrl) {
      <span class="variable">$element.noUiSlider</span>({
        <span class="comment">// We might not have the initial value in ngModelCtrl yet</span>
        start: <span class="number">0</span>,
        range: {
          <span class="comment">// $attrs by default gives us string values</span>
          <span class="comment">// nouiSlider expects numbers, so convert</span>
          <span class="keyword">min</span>: Number(<span class="variable">$attr.rangeMin</span>),
          <span class="keyword">max</span>: Number(<span class="variable">$attr.rangeMax</span>)
        }
      });
      <span class="comment">// When data changes inside AngularJS</span>
      <span class="comment">// Notify the third party directive of the change</span>
      ngModelCtrl<span class="built_in">.</span><span class="variable">$render</span> <span class="subst">=</span> function() {
        <span class="variable">$element.val</span>(ngModelCtrl<span class="built_in">.</span><span class="variable">$viewValue</span>);
      };
      <span class="comment">// When data changes outside of AngularJS</span>
      <span class="variable">$element.on</span>(<span class="string">'set'</span>, function(args) {
        <span class="comment">// Also tell AngularJS that it needs to update the UI</span>
        <span class="variable">$scope.</span><span class="variable">$apply</span>(function() {
          <span class="comment">// Set the data within AngularJS</span>
          ngModelCtrl<span class="built_in">.</span><span class="variable">$setViewValue</span>(<span class="variable">$element.val</span>());
        });
      });
    }
  };
}<span class="preprocessor">]</span><span class="markup">);

&lt;/scirpt&gt;</span>
</pre></td></tr></table></figure>

<p>AngularJS calls the <code>$render</code> method whenever the model value
changes inside AngularJS (for example, when it is initialized to a value in our controller).</p>
<p>A third-party UI component is outside the AngularJS life cycle,
so we need to manually call <code>$scope.$apply()</code>
to ensure that AngularJS updates the UI.
The <code>$scope.$apply()</code> call takes an optional function as
an argument and ensures that the AngularJS digest cycle that’s
responsible for updating the UI with the latest values is triggered.</p>
<h1 id="custom-validators">Custom Validators</h1>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
</pre></td><td class="code"><pre><span class="tag">&lt;<span class="title">div</span> <span class="attribute">ng-controller</span>=<span class="value">"MainCtrl as mainCtrl"</span>&gt;</span>
  <span class="tag">&lt;<span class="title">h3</span>&gt;</span>Zip Code Input<span class="tag">&lt;/<span class="title">h3</span>&gt;</span>
  <span class="tag">&lt;<span class="title">h5</span>&gt;</span>Zips are allowed in one of the following formats<span class="tag">&lt;/<span class="title">h5</span>&gt;</span>
  <span class="tag">&lt;<span class="title">ul</span>&gt;</span>
    <span class="tag">&lt;<span class="title">li</span>&gt;</span>12345<span class="tag">&lt;/<span class="title">li</span>&gt;</span>
    <span class="tag">&lt;<span class="title">li</span>&gt;</span>12345 1234<span class="tag">&lt;/<span class="title">li</span>&gt;</span>
    <span class="tag">&lt;<span class="title">li</span>&gt;</span>12345-1234<span class="tag">&lt;/<span class="title">li</span>&gt;</span>
  <span class="tag">&lt;/<span class="title">ul</span>&gt;</span>
  <span class="tag">&lt;<span class="title">form</span> <span class="attribute">novalidate</span>=<span class="value">""</span>&gt;</span>
    Enter valid zip code:
    <span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"text"</span>
           <span class="attribute">ng-model</span>=<span class="value">"mainCtrl.zip"</span>
           <span class="attribute">valid-zip</span>&gt;</span>
  <span class="tag">&lt;/<span class="title">form</span>&gt;</span>
  <span class="tag">&lt;/<span class="title">div</span>&gt;</span>


<span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript">
<span class="comment">// File: chapter13/directive-custom-validator/app.js</span>
angular.module(<span class="string">'stockMarketApp'</span>, [])
  .controller(<span class="string">'MainCtrl'</span>, [<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
  <span class="keyword">this</span>.zip = <span class="string">'1234'</span>;
}]);
<span class="comment">// File: chapter13/directive-custom-validator/directive.js</span>
angular.module(<span class="string">'stockMarketApp'</span>)
  .directive(<span class="string">'validZip'</span>, [<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
  <span class="keyword">var</span> zipCodeRegex = <span class="regexp">/^\d{5}(?:[-\s]\d{4})?$/g</span>;
  <span class="keyword">return</span> {
    restrict: <span class="string">'A'</span>,
    <span class="built_in">require</span>: <span class="string">'ngModel'</span>,
    link: <span class="function"><span class="keyword">function</span><span class="params">($scope, $element, $attrs, ngModelCtrl)</span> {</span>
      <span class="comment">// Handle DOM update --&gt; Model update</span>
      <span class="comment">// The parser function has to return the correct value (if the data is valid) or undefined (in case the data isn’t).</span>
      ngModelCtrl.$parsers.unshift(<span class="function"><span class="keyword">function</span><span class="params">(value)</span> {</span>
        <span class="keyword">var</span> valid = zipCodeRegex.test(value);
        ngModelCtrl.$setValidity(<span class="string">'validZip'</span>, valid);
        <span class="keyword">return</span> valid ? value : <span class="literal">undefined</span>;
      });
      <span class="comment">// Handle Model Update --&gt; DOM</span>
      <span class="comment">// We again check for validity here and return the value.</span>
      ngModelCtrl.$formatters.unshift(<span class="function"><span class="keyword">function</span><span class="params">(value)</span> {</span>
        ngModelCtrl.$setValidity(<span class="string">'validZip'</span>,
          zipCodeRegex.test(value));
        <span class="keyword">return</span> value;
      });
    }
  };
}]);
</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
</pre></td></tr></table></figure>

<h1 id="compile">Compile</h1>
<p>In the directive life cycle, we mentioned that a directive goes through two distinct phases:
a compile step and a link step. </p>
<p>The compile step in a directive is the correct place to do any sort of HTML template
manipulation and DOM transformation. We never use the link and compile functions
together, because when we use the compile key, we have to return a
linking function from within it instead.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
</pre></td><td class="code"><pre><span class="tag">&lt;<span class="title">form</span> <span class="attribute">novalidate</span>=<span class="value">""</span> <span class="attribute">name</span>=<span class="value">"mainForm"</span>&gt;</span>
  <span class="tag">&lt;<span class="title">form-element</span> <span class="attribute">type</span>=<span class="value">"text"</span>
                <span class="attribute">name</span>=<span class="value">"uname"</span>
                <span class="attribute">bind-to</span>=<span class="value">"mainCtrl.username"</span>
                <span class="attribute">label</span>=<span class="value">"Username"</span>
                <span class="attribute">required</span>
                <span class="attribute">ng-minlength</span>=<span class="value">"5"</span>&gt;</span>
    <span class="tag">&lt;<span class="title">validation</span> <span class="attribute">key</span>=<span class="value">"required"</span>&gt;</span>
    Please enter a username
    <span class="tag">&lt;/<span class="title">validation</span>&gt;</span>
    <span class="tag">&lt;<span class="title">validation</span> <span class="attribute">key</span>=<span class="value">"minlength"</span>&gt;</span>
    Username must be at least 5 characters
    <span class="tag">&lt;/<span class="title">validation</span>&gt;</span>
  <span class="tag">&lt;/<span class="title">form-element</span>&gt;</span>
    
  Username is 
  <span class="tag">&lt;<span class="title">form-element</span> <span class="attribute">type</span>=<span class="value">"password"</span>
                <span class="attribute">name</span>=<span class="value">"pwd"</span>
                <span class="attribute">bind-to</span>=<span class="value">"mainCtrl.password"</span>
                <span class="attribute">label</span>=<span class="value">"Password"</span>
                <span class="attribute">required</span>
                <span class="attribute">ng-pattern</span>=<span class="value">"/^[a-zA-Z0-9]+$/"</span>&gt;</span>
    <span class="tag">&lt;<span class="title">validation</span> <span class="attribute">key</span>=<span class="value">"required"</span>&gt;</span>
      Please enter a password
    <span class="tag">&lt;/<span class="title">validation</span>&gt;</span>
    <span class="tag">&lt;<span class="title">validation</span> <span class="attribute">key</span>=<span class="value">"pattern"</span>&gt;</span>
      Password must only be alphanumeric characters
    <span class="tag">&lt;/<span class="title">validation</span>&gt;</span>
  <span class="tag">&lt;/<span class="title">form-element</span>&gt;</span>
  Password is 
  <span class="tag">&lt;<span class="title">button</span>&gt;</span>Suubmit<span class="tag">&lt;/<span class="title">button</span>&gt;</span>
<span class="tag">&lt;/<span class="title">form</span>&gt;</span>

<span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript">
<span class="comment">// File: chapter13/directive-compile/app.js</span>
angular.module(<span class="string">'dynamicFormApp'</span>, [])
.controller(<span class="string">'MainCtrl'</span>, [<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
  <span class="keyword">var</span> self = <span class="keyword">this</span>;
  self.username = <span class="string">''</span>;
  self.password = <span class="string">''</span>;
}]);

<span class="comment">// File: chapter13/directive-compile/directive.js</span>
angular.module(<span class="string">'dynamicFormApp'</span>)
.directive(<span class="string">'formElement'</span>, [<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
  <span class="keyword">return</span> {
    restrict: <span class="string">'E'</span>,
    <span class="built_in">require</span>: <span class="string">'^form'</span>,
    scope: <span class="literal">true</span>,
    compile: <span class="function"><span class="keyword">function</span><span class="params">($element, $attrs)</span> {</span>
      <span class="keyword">var</span> expectedInputAttrs = {
        <span class="string">'required'</span>: <span class="string">'required'</span>,
        <span class="string">'ng-minlength'</span>: <span class="string">'ngMinlength'</span>,
        <span class="string">'ng-pattern'</span>: <span class="string">'ngPattern'</span>
        <span class="comment">// More here to be implemented</span>
      };
      <span class="comment">// Start extracting content from the HTML</span>
      <span class="keyword">var</span> validationKeys = $element.find(<span class="string">'validation'</span>);
      <span class="keyword">var</span> presentValidationKeys = {};
      <span class="keyword">var</span> inputName = $attrs.name;
      angular.forEach(validationKeys, <span class="function"><span class="keyword">function</span><span class="params">(validationKey)</span> {</span>
        validationKey = angular.element(validationKey);
        presentValidationKeys[validationKey.attr(<span class="string">'key'</span>)] =
          validationKey.text();
      });
      <span class="comment">// Start generating final element HTML</span>
      <span class="keyword">var</span> elementHtml = <span class="string">'&lt;div&gt;'</span> +
        <span class="string">'&lt;label&gt;'</span> + $attrs.label + <span class="string">'&lt;/label&gt;'</span>;
      elementHtml += <span class="string">'&lt;input type="'</span> + $attrs.type +
        <span class="string">'" name="'</span> + inputName + <span class="string">'" ng-model="'</span> + $attrs.bindTo + <span class="string">'"'</span>;
      $element.removeAttr(<span class="string">'type'</span>);
      $element.removeAttr(<span class="string">'name'</span>);
      <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> expectedInputAttrs) {
        <span class="keyword">if</span> ($attrs[expectedInputAttrs[i]] !== <span class="literal">undefined</span>) {
          elementHtml += <span class="string">' '</span> + i + <span class="string">'="'</span> + $attrs[expectedInputAttrs[i]] + <span class="string">'"'</span>;
        }
        $element.removeAttr(i);
      }
      elementHtml += <span class="string">'&gt;'</span>;
      elementHtml +=
        <span class="string">'&lt;span ng-repeat="(key, text) in validators" '</span> +
        <span class="string">' ng-show="hasError(key)"'</span> +
        <span class="string">' ng-bind="text"&gt;&lt;/span&gt;'</span>;
      elementHtml += <span class="string">'&lt;/div&gt;'</span>;
      $element.html(elementHtml);
      <span class="keyword">return</span> <span class="function"><span class="keyword">function</span><span class="params">($scope, $element, $attrs, formCtrl)</span> {</span>
        $scope.validators = angular.copy(presentValidationKeys);
        $scope.hasError = <span class="function"><span class="keyword">function</span><span class="params">(key)</span> {</span>
          <span class="keyword">return</span> !!formCtrl[inputName][<span class="string">'$error'</span>][key];
        };
      };
    }
  };
}]);
</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
</pre></td></tr></table></figure>

<p>Finally, we return a postLink function (we cannot have a link keyword along with
compile; we need to return the link function from within compile instead), which
adds the validators array and a hasError function to show each of the validation
messages under the correct conditions.</p>
<p>As mentioned before, compile is only used in the rarest of cases, where you need to do
major DOM transformations at runtime.</p>
<h2 id="pre-and-post-linking">Pre- and Post- Linking</h2>
<p>When a <code>post-link</code> function executes, all children directives
have been compiled and linked at this point.</p>
<p>But in case we needed a hook to execute something before the children are linked, we
can add what is called <code>pre-link</code> function. At this point, the children directives aren’t
linked, and DOM transformations are not safe and can have weird effects.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre>{
  link: <span class="function"><span class="keyword">function</span><span class="params">(<span class="variable">$scope</span>, <span class="variable">$element</span>, <span class="variable">$attrs</span>)</span> {</span>}
}
{
  link: {
    pre: <span class="function"><span class="keyword">function</span><span class="params">(<span class="variable">$scope</span>, <span class="variable">$element</span>, <span class="variable">$attrs</span>)</span> {</span>},
    post: <span class="function"><span class="keyword">function</span><span class="params">(<span class="variable">$scope</span>, <span class="variable">$element</span>, <span class="variable">$attrs</span>)</span> {</span>}
  }
}
</pre></td></tr></table></figure>

<h1 id="priority-and-terminal">Priority and Terminal</h1>
<p>The last two options we look at when creating directives are priority and terminal.</p>
<p><code>priority</code> is used to decide the order in which directives are evaluated when there are
multiple directives used on the same element. For example, when we use the <code>ngModel</code>
directive along with <code>ngPattern</code> or <code>ngMinlength</code>, we need to ensure that <code>ngPattern</code> or
<code>ngMinlength</code> executes only after <code>ngModel</code> has had a chance to execute.</p>
<p>By default, any directive we create has a priority of 0. </p>
<p>The <code>terminal</code> keyword in a directive is used to ensure that no other directives are
compiled or linked on an element after the current priority directives are finished. </p>
<h1 id="clean-up-and-destroy">Clean Up and Destroy</h1>
<p>AngularJS cannot clean up event listeners we add on elements outside of the
scope and HTML of the directive. When we add these listeners or watchers, it becomes
our responsibility to clean up when the directive gets destroyed. </p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
</pre></td><td class="code"><pre><span class="variable">$scope</span>.<span class="variable">$on</span>(<span class="string">'$destroy'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
  <span class="comment">// Do clean up here</span>
});
  
<span class="variable">$element</span>.<span class="variable">$on</span>(<span class="string">'$destroy'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
  <span class="comment">// Do clean-up here</span>
});
</pre></td></tr></table></figure>

<h1 id="watchers">Watchers</h1>
<p>These basically get triggered by AngularJS whenever the variable
under watch changes, and we get access to both the new and the old value in such a case.</p>
<ul>
<li><code>$watch</code>, whenever the value changes, then the function passed to it as the
second argument is triggered with the old and new value. Which takes:<ul>
<li>A string, which is the name of a variable on the scope</li>
<li>A function, whose return value is evaluated</li>
</ul>
</li>
<li>Deep <code>$watch</code>, The same as the standard watch, but takes a Boolean true as the third argument.
This forces AngularJS to recursively check each object and key inside the object or
variable and use angular.equals to check for equality for all objects.</li>
<li><code>$watchCollection</code>,  The function is triggered any time an
item is added, removed, or moved in the array. It does not watch for changes to
individual properties in an item in the array.</li>
</ul>
<h1 id="-apply-and-digest">$apply and $digest</h1>
<p>Whenever you’re working with third-party components, remember that there are two
distinct life cycles at play. The first is the AngularJS life cycle that is responsible for the
keeping the UI updated and the second is a third-party component’s life cycle. </p>
<p>And this is done by triggering <code>$scope.$apply()</code>,
which starts a digest cycle on the <code>$rootScope</code>.</p>
<p>Sometimes, another event in AngularJS will automatically trigger and take care of this,
but in any case if you are updating any scope variables in response to an external event,
make sure you manually trigger the <code>$scope.$apply()</code> or <code>$scope.$digest()</code>.</p>
  
	</div>
		<footer class="article-footer clearfix">




<div class="article-share" id="share">

  <div data-url="http://zhpooer.github.io/2014/12/24/angularjs-5/" data-title="angularjs-Directives | Poe&#39;s World" data-tsina="null" class="share clearfix">
  </div>

</div>
</footer>   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2014/12/27/angularjs-6/" title="angularjs End-to-End Testing &amp; Guidelines">
  <strong>PREVIOUS:</strong><br/>
  <span>
  angularjs End-to-End Testing &amp; Guidelines</span>
</a>
</div>


<div class="next">
<a href="/2014/12/23/angularjs-4/"  title="angularjs-Working with Filters &amp; ngRoute">
 <strong>NEXT:</strong><br/> 
 <span>angularjs-Working with Filters &amp; ngRoute
</span>
</a>
</div>

</nav>

	
<section class="comment">
	<div class="ds-thread"></div>
</section>

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
  <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#what-are-directives"><span class="toc-number">1.</span> <span class="toc-text">What Are Directives</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ng-include"><span class="toc-number">2.</span> <span class="toc-text">ng-include</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#limitations-of-ng-include"><span class="toc-number">2.1.</span> <span class="toc-text">Limitations of ng-include</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#ng-switch"><span class="toc-number">3.</span> <span class="toc-text">ng-switch</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#creating-a-directive"><span class="toc-number">4.</span> <span class="toc-text">Creating a Directive</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#restrict"><span class="toc-number">4.1.</span> <span class="toc-text">Restrict</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#the-link-function"><span class="toc-number">4.2.</span> <span class="toc-text">The link Function</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#scope"><span class="toc-number">4.3.</span> <span class="toc-text">Scope</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#replace"><span class="toc-number">4.4.</span> <span class="toc-text">Replace</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#unit-testing-dirctives"><span class="toc-number">5.</span> <span class="toc-text">Unit Testing Dirctives</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#angularjs-life-cycle"><span class="toc-number">6.</span> <span class="toc-text">AngularJS Life Cycle</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#the-digest-cycle"><span class="toc-number">6.1.</span> <span class="toc-text">The Digest Cycle</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#directive-life-cycle"><span class="toc-number">6.2.</span> <span class="toc-text">Directive Life Cycle</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#transclusions"><span class="toc-number">7.</span> <span class="toc-text">Transclusions</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#advanced-transclusion"><span class="toc-number">7.1.</span> <span class="toc-text">Advanced Transclusion</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#directive-controllers-and-require"><span class="toc-number">8.</span> <span class="toc-text">Directive Controllers and require</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#require-options"><span class="toc-number">9.</span> <span class="toc-text">require Options</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#input-directives-with-ng-model"><span class="toc-number">10.</span> <span class="toc-text">Input Directives with ng-model</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#custom-validators"><span class="toc-number">11.</span> <span class="toc-text">Custom Validators</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#compile"><span class="toc-number">12.</span> <span class="toc-text">Compile</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#pre-and-post-linking"><span class="toc-number">12.1.</span> <span class="toc-text">Pre- and Post- Linking</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#priority-and-terminal"><span class="toc-number">13.</span> <span class="toc-text">Priority and Terminal</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#clean-up-and-destroy"><span class="toc-number">14.</span> <span class="toc-text">Clean Up and Destroy</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#watchers"><span class="toc-number">15.</span> <span class="toc-text">Watchers</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-apply-and-digest"><span class="toc-number">16.</span> <span class="toc-text">$apply and $digest</span></a></li></ol>
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  

  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			<li><a href="/tags/AJAX/" title="AJAX">AJAX<sup>1</sup></a></li>
		
			<li><a href="/tags/Akka/" title="Akka">Akka<sup>1</sup></a></li>
		
			<li><a href="/tags/Android/" title="Android">Android<sup>1</sup></a></li>
		
			<li><a href="/tags/DOM/" title="DOM">DOM<sup>2</sup></a></li>
		
			<li><a href="/tags/EL表达式/" title="EL表达式">EL表达式<sup>1</sup></a></li>
		
			<li><a href="/tags/HBase/" title="HBase">HBase<sup>1</sup></a></li>
		
			<li><a href="/tags/Hadoop/" title="Hadoop">Hadoop<sup>1</sup></a></li>
		
			<li><a href="/tags/Hibernate/" title="Hibernate">Hibernate<sup>2</sup></a></li>
		
			<li><a href="/tags/HttpSession/" title="HttpSession">HttpSession<sup>1</sup></a></li>
		
			<li><a href="/tags/IO/" title="IO">IO<sup>1</sup></a></li>
		
			<li><a href="/tags/Illustrator/" title="Illustrator">Illustrator<sup>3</sup></a></li>
		
			<li><a href="/tags/JSP/" title="JSP">JSP<sup>1</sup></a></li>
		
			<li><a href="/tags/JavaBean/" title="JavaBean">JavaBean<sup>1</sup></a></li>
		
			<li><a href="/tags/JavaScript/" title="JavaScript">JavaScript<sup>1</sup></a></li>
		
			<li><a href="/tags/Mybatis/" title="Mybatis">Mybatis<sup>1</sup></a></li>
		
			<li><a href="/tags/NoSql/" title="NoSql">NoSql<sup>1</sup></a></li>
		
			<li><a href="/tags/SASS/" title="SASS">SASS<sup>1</sup></a></li>
		
			<li><a href="/tags/SAX/" title="SAX">SAX<sup>1</sup></a></li>
		
			<li><a href="/tags/ServletRequest/" title="ServletRequest">ServletRequest<sup>1</sup></a></li>
		
			<li><a href="/tags/ServletResponse/" title="ServletResponse">ServletResponse<sup>1</sup></a></li>
		
		</ul>
</div>


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<div class="social-font" class="clearfix">
		
		
		
		
	</div>
		<p class="copyright">Powered by <a href="http://zespia.tw/hexo/" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/A-limon/pacman" target="_blank" title="Pacman">Pacman</a> © 2015 
		
		<a href="http://zhpooer.github.io" target="_blank" title="zhpooer">zhpooer</a>
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top",Math.max(140,320-$(this).scrollTop()));
    });
  };
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});     
</script>


<script type="text/javascript">
  var duoshuoQuery = {short_name:"zhpoooer"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 





  </body>
</html>
