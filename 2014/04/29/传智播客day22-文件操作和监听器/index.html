
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>传智播客day22-文件操作和监听器 | Poe&#39;s World</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
    
    <meta name="author" content="zhpooer">
    
    <meta name="description" content="文件上传

必须提供&lt;input type=&quot;file&quot; name=&quot;&quot;/&gt;的文件上传输入域
表单的提交方式必须是POST方式
设置 &lt;form enctype=&quot;multipart/form-data&quot;&gt;

原理
">
    
    
    
    
    <link rel="alternative" href="/atom.xml" title="Poe&#39;s World" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/pacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/pacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

  <body>
    <header>
      <div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.svg" alt="Poe&#39;s World" title="Poe&#39;s World"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Poe&#39;s World">Poe&#39;s World</a></h1>
				<h2 class="blog-motto">竹杖芒鞋轻胜马，一蓑烟雨任平生</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">主页</a></li>
					
						<li><a href="/english-monthly">英语角</a></li>
					
						<li><a href="/about">关于</a></li>
					
						<li><a href="/archives">归档</a></li>
					
					<li>
					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="text" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:zhpooer.github.io">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>

    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2014/04/29/传智播客day22-文件操作和监听器/" title="传智播客day22-文件操作和监听器" itemprop="url">传智播客day22-文件操作和监听器</a>
  </h1>
  <p class="article-author">By
    
      <a href="http://zhpooer.github.io" title="zhpooer">zhpooer</a>
    </p>
  <p class="article-time">
    <time datetime="2014-04-29T01:02:31.000Z" itemprop="datePublished">4月 29 2014</time>
    更新日期:<time datetime="2014-04-29T09:12:42.000Z" itemprop="dateModified">4月 29 2014</time>
    
  </p>
</header>
	<div class="article-content">
		
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#-"><span class="toc-number">1.</span> <span class="toc-text">文件上传</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-"><span class="toc-number">1.1.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-"><span class="toc-number">1.2.</span> <span class="toc-text">编码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-"><span class="toc-number">1.3.</span> <span class="toc-text">考虑的问题</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#-"><span class="toc-number">2.</span> <span class="toc-text">文件的下载</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-"><span class="toc-number">3.</span> <span class="toc-text">观察者模式</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#servlet-"><span class="toc-number">4.</span> <span class="toc-text">Servlet 中的监听器</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-"><span class="toc-number">4.1.</span> <span class="toc-text">具体用法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-"><span class="toc-number">4.2.</span> <span class="toc-text">监听器案例</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#-"><span class="toc-number">5.</span> <span class="toc-text">国际化</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-"><span class="toc-number">5.1.</span> <span class="toc-text">固定文本的国际化</span></a></li><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-"><span class="toc-number">5.1.1.</span> <span class="toc-text">资源的写法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-"><span class="toc-number">5.1.2.</span> <span class="toc-text">编码案例</span></a></li></ol><li class="toc-item toc-level-2"><a class="toc-link" href="#-"><span class="toc-number">5.2.</span> <span class="toc-text">时间和日期的格式化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-"><span class="toc-number">5.3.</span> <span class="toc-text">数字的格式化, 货币符号</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-"><span class="toc-number">5.4.</span> <span class="toc-text">批量国际化</span></a></li></ol>
		</div>
		
		<h1 id="-">文件上传</h1>
<ol>
<li>必须提供<code>&lt;input type=&quot;file&quot; name=&quot;&quot;/&gt;</code>的文件上传输入域</li>
<li>表单的提交方式必须是POST方式</li>
<li>设置 <code>&lt;form enctype=&quot;multipart/form-data&quot;&gt;</code></li>
</ol>
<h2 id="-">原理</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
</pre></td><td class="code"><pre><span class="comment">&lt;!-- enctype: 指定请求体正文 --&gt;</span>
<span class="comment">&lt;!-- application/x-www-form-urlencoded(默认) --&gt;</span>
<span class="comment">&lt;!-- 可选值是multipart/form-data --&gt;</span>
<span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">""</span> <span class="attribute">method</span>=<span class="value">"post"</span> <span class="attribute">enctype</span>=<span class="value">"multipart/form-data"</span>&gt;</span>
    <span class="tag">&lt;<span class="title">input</span> <span class="attribute">name</span>=<span class="value">"text"</span> <span class="attribute">type</span>=<span class="value">"text"</span> /&gt;</span>
     <span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"file"</span> <span class="attribute">name</span>=<span class="value">"photo"</span>/&gt;</span>
<span class="tag">&lt;/<span class="title">form</span>&gt;</span>
</pre></td></tr></table></figure>

<p>表单的 enctype 不是  <code>application/x-www-form-urlencoded</code>, 传统的获取方式将失效</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
</pre></td><td class="code"><pre><span class="comment">// enctype = multipart/form-data</span>
<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doGet</span>(){
    ServletInputStream <span class="keyword">in</span> = req.getInputStream();
    <span class="keyword">byte</span> b[] = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];
    <span class="keyword">int</span> len = -<span class="number">1</span>;
    <span class="keyword">while</span>(){
        System.ot.println(<span class="keyword">new</span> String(b, <span class="number">0</span>, len));
    }
    <span class="keyword">in</span>.close()
}
</pre></td></tr></table></figure>

<p>运行结果:
<img src="/img/upload.png" alt="运行结果"></p>
<h2 id="-">编码</h2>
<ul>
<li>搭建环境, 导入 <code>commons-fileupload.jar</code></li>
<li>组件的功能是 实现解析</li>
<li>上传类的功能解析<ul>
<li><code>DiskFileItemFactory</code>: 产生FileItem对象</li>
<li><code>ServletFileUpload</code>: 解析上传的核心类</li>
</ul>
</li>
</ul>
<p><img src="/img/upload_util.png" alt="对象描述"></p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
</pre></td><td class="code"><pre><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doGet</span>(){
    <span class="comment">// 验证用户提交的数据是不是mutlipart/form-data类型</span>
    boolean isMultiPart = ServletFileUpload.isMultiPartContent(req)
    <span class="comment">// 0. 获取文件上传的真实路径</span>
    String storeDir = getServletContext().getRealPath(<span class="string">""</span>);
    <span class="comment">// 1. 创建产生FileItem的工厂实例</span>
    DiskFileItemFactory fac = <span class="keyword">new</span> DiskFileItemFactory();
    <span class="comment">// 上传过程中要使用缓存, 设置缓存大小, 默认10kb</span>
    <span class="comment">// 如果上传的文件超过10kb, 组建hi采用磁盘临时文件的缓存形式</span>
    fac.setSizeThreadhold(<span class="keyword">int</span> size);
    <span class="comment">// 设置磁盘临时文件的存放目录, 默认是操作系统用户的临时目录</span>
    fac.setRepository(File);
    <span class="comment">// 2. 得到解析请求内容的解析器 ServletFileUpload</span>
    ServletFileUpload sfu = <span class="keyword">new</span> Servlet(fac);
    <span class="comment">// 3. 解析请求内容, 得到很多的FileItem实例</span>
    List&lt;FileItem&gt; items = sfu.parseReqeust(req);
    <span class="comment">// 4. 遍历FileItem的实例</span>
    <span class="keyword">for</span>(FileItem item:items){
        <span class="keyword">if</span>(item.isFormField()){
            <span class="comment">//4.1 如果是普通字段</span>
            String fieldName = item.getFieldName(); <span class="comment">// 字段名</span>
            <span class="comment">// 中文乱码</span>
            String fieldValue = item.getString(<span class="string">"utf-8"</span>);   <span class="comment">// 字段值</span>
        } <span class="keyword">else</span>{
            <span class="comment">//4.2 如果是上传字段</span>
            InputStream <span class="keyword">in</span> = item.getInputStream();
            <span class="comment">// 获取上传的文件名</span>
            String filename = item.getName(); <span class="comment">// 根据浏览器不同传的不同, 有的是全路径名, 有的是名字</span>
            filename = filename.subString(filename.lastIndexOf(<span class="string">"\\"</span>) + <span class="number">1</span>);
            OutputStream <span class="keyword">out</span> = <span class="keyword">new</span> FileOutputStream(storeDir + <span class="string">"/"</span> + filename);
            
            <span class="keyword">int</span> len = -<span class="number">1</span>;
            <span class="keyword">byte</span> b[] = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>]
            <span class="keyword">while</span>(){
                <span class="keyword">out</span>.write(b, <span class="number">0</span>, len);
            }
            <span class="keyword">in</span>.close();
            <span class="keyword">out</span>.close();
            item.delete();
        }
    }
}
</pre></td></tr></table></figure>

<h2 id="-">考虑的问题</h2>
<ul>
<li>保证服务器的安全<ul>
<li>把存放文件的目录放在<code>/WEB-INFO</code>下</li>
</ul>
</li>
<li>中文乱码问题<ul>
<li>普通字段的中文乱码<ul>
<li><code>FileItem.getString(&quot;utf-8&quot;)</code></li>
</ul>
</li>
<li>上传的是中文文件名<ul>
<li><code>reqeust.setCharactorEncoding(&quot;utf-8&quot;)</code> 只负责请求体中的</li>
</ul>
</li>
</ul>
</li>
<li>重名文件被覆盖<ul>
<li>把文件名弄成唯一 <code>filename=UUID.randomUUID.toString()</code></li>
</ul>
</li>
<li><p>防止同一个文件夹下的文件太多</p>
<ul>
<li>分不同的目录存储<ol>
<li>按照当前的日期存储文件</li>
<li>按照UUID文件名的hashCode生成目录<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
</pre></td><td class="code"><pre>    String dir = makeDir(storeDir, filename); <span class="comment">// 用hashCode计算出一个目录</span>
    <span class="keyword">private</span> String <span class="title">makeDir</span>(String storeDir, String filename) {
        <span class="keyword">int</span> hashCode = filename.hashCode();
        <span class="keyword">int</span> dir1 = hashCode&<span class="number">0xf</span>;
        <span class="keyword">int</span> dir2 = (hashCode&<span class="number">0xf0</span>) &gt;&gt; <span class="number">4</span>;
        String dir = <span class="string">"/"</span> + dir1 + <span class="string">"/"</span> + dir2;
        File file = <span class="keyword">new</span> File(dir1, dir2);
        <span class="keyword">if</span>(!file.exists()) file.mkdirs();
        <span class="keyword">return</span> dir;
    }
</pre></td></tr></table></figure>
</li>
</ol>
</li>
</ul>
</li>
<li><p>限制文件上传的大小</p>
<ul>
<li>限制单个文件的大小<ul>
<li><code>ServletFileUpload.setFileSizeMax(2*1024*1024)</code> 单位是字节,超出时 <code>parseReqeust</code> 会报错
<code>FileUploadBase.FileSizeSizeLimitException</code></li>
</ul>
</li>
<li>限制总文件的大小<ul>
<li><code>ServletFileUpload.setSizeMax(2*1024*1024)</code>, 报错 <code>FileUploadBase.SizeLimitExceededException</code></li>
</ul>
</li>
</ul>
</li>
<li><p>限制上传的文件类型</p>
<ul>
<li>判断文件的扩展名</li>
<li>判断文件的MIME类型(Tomcat/conf/web.xml)<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre>  <span class="built_in">String</span> mimeType = item.getContentType();
  <span class="keyword">if</span>(mimeType.startsWith(<span class="string">"image"</span>)) todo();
</pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>多文件上传时, 有空的表单项</p>
<ul>
<li>通过检查文件MIME也可以避免</li>
</ul>
</li>
<li>大文件上传时的临时文件问题<ul>
<li>组件对于超出缓存的文件会使用临时文件的形式上传, 上传完毕后. 临时文件不会删除,
造成硬盘空间的浪费. 可以通过 <code>FileItem.delete()</code> 来配置</li>
</ul>
</li>
<li>上传进度指示条(目前做不了, 要用到异步交互ajax)<ul>
<li>注册监听器, 拿到百分比<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre>  ServletFileUpload.setProgressListener( <span class="keyword">new</span> ProgressListener(){
      <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span>(<span class="keyword">long</span> pBytes, <span class="keyword">long</span> pContentLength, <span class="keyword">int</span> pItems) {
          (pBytes + <span class="number">0.0</span>)/pContentLength;
      }
  })
</pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
<h1 id="-">文件的下载</h1>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre></td><td class="code"><pre><span class="comment">// 罗列可下载的资源</span>
<span class="keyword">public</span> <span class="literal">void</span> doGet(){
    <span class="comment">//得到 WEB-INF/files 下的文件</span>
    <span class="built_in">String</span> storeDir <span class="subst">=</span> getServletContext()<span class="built_in">.</span>getRealPath();
    <span class="comment">// 递归遍历所有的文件, 把遍历到的信息封装起来</span>
    <span class="comment">// Map&lt;String,String&gt;.key:UUID, value: 老文件名</span>
    <span class="built_in">Map</span><span class="subst">&lt;</span><span class="built_in">String</span>,<span class="built_in">String</span><span class="subst">&gt;</span> <span class="built_in">map</span> <span class="subst">=</span> <span class="literal">new</span> HashMap<span class="subst">&lt;</span><span class="built_in">String</span>, <span class="built_in">String</span><span class="subst">&gt;</span>();
    treeWalk(<span class="literal">new</span> File(storeDir), <span class="built_in">map</span>)
    <span class="comment">// 把Map封装到request域中</span>
    request<span class="built_in">.</span>setAttribute(<span class="string">"map"</span>, <span class="built_in">map</span>);
    <span class="comment">// 转发到jsp取</span>
    request<span class="built_in">.</span>getRequestDispatcher(<span class="string">"/listFiles.jsp"</span>)<span class="built_in">.</span>forward(req, res);
}
<span class="keyword">public</span> <span class="literal">void</span> treeWalk(File file, <span class="built_in">Map</span><span class="subst">&lt;</span><span class="built_in">String</span>, <span class="built_in">String</span><span class="subst">&gt;</span> <span class="built_in">map</span>){
    <span class="keyword">if</span>(file<span class="built_in">.</span>isFile()){
        <span class="built_in">String</span> filename <span class="subst">=</span> file<span class="built_in">.</span>getName();
        <span class="built_in">String</span> oldFileName <span class="subst">=</span> filename<span class="built_in">.</span>subString(filename<span class="built_in">.</span>indexOf(<span class="string">"_"</span>) <span class="subst">+</span> <span class="number">1</span>);
    } <span class="keyword">else</span> {
        File<span class="preprocessor">[</span><span class="preprocessor">]</span><span class="markup"> children = file.listFiles();
        for(File f:children){
            treeWalk(f, map);
        }
    }
}</span>
</pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
</pre></td><td class="code"><pre><span class="tag">&lt;<span class="title">body</span>&gt;</span>
    <span class="tag">&lt;<span class="title">h1</span>&gt;</span><span class="tag">&lt;/<span class="title">h1</span>&gt;</span>
    <span class="tag">&lt;<span class="title">c:forEach</span> <span class="attribute">items</span>=<span class="value">""</span> <span class="attribute">var</span>=<span class="value">"me"</span>&gt;</span>
        <span class="tag">&lt;<span class="title">c:url</span> <span class="attribute">value</span>=<span class="value">"/servlet/DownloadServlet"</span> <span class="attribute">var</span>=<span class="value">"url"</span>&gt;</span>
            <span class="tag">&lt;<span class="title">c:param</span> <span class="attribute">name</span>=<span class="value">"filename"</span> <span class="attribute">value</span>=<span class="value">"${me.key}"</span>&gt;</span>
            <span class="tag">&lt;/<span class="title">c:param</span>&gt;</span>
        <span class="tag">&lt;/<span class="title">c:url</span>&gt;</span>
         ${me.value}&nbsp; nbsp; <span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"${url}"</span>&gt;</span>下载<span class="tag">&lt;/<span class="title">a</span>&gt;</span>
    <span class="tag">&lt;/<span class="title">c:forEach</span>&gt;</span>
<span class="tag">&lt;/<span class="title">body</span>&gt;</span>
</pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre></td><td class="code"><pre>public void doGet(){
    String realFilename= request<span class="preprocessor">.getParameter</span>(<span class="string">"filename"</span>)<span class="comment">;</span>
    realFilename = new String(realFilename<span class="preprocessor">.getBytes</span>(<span class="string">"ISO8859-1"</span>), <span class="string">"utf-8"</span>)<span class="comment">;</span>

    String storeDir = getServletContext()<span class="preprocessor">.getRealPath</span>()<span class="comment">;</span>
    String dir = makeDir(storeDir, realFilename)<span class="comment">;</span>

    File file = new File(storeDir + dir + <span class="string">"/"</span> + realFilename)<span class="comment">;</span>
    if(file<span class="preprocessor">.exists</span>()){
        InputStream <span class="keyword">in</span> = new FileInputStream(file)<span class="comment">;</span>
        // 截取老文件名, 并进行url编码
        String oldFileName = realFilename<span class="preprocessor">.subString</span>(realFilename<span class="preprocessor">.indexOf</span>(<span class="string">"_"</span>)+<span class="number">1</span>)<span class="comment">;</span>
        oldFileName = URLEncoder<span class="preprocessor">.encode</span>(oldFileName, <span class="string">"utf-8"</span>)<span class="comment">;</span>
        
        response<span class="preprocessor">.setHeader</span>(<span class="string">"Content-Disposition"</span>, <span class="string">"attachment;filename="</span> + oldFileName)<span class="comment">;</span>
        
        OutputStream <span class="keyword">out</span> = response<span class="preprocessor">.getOutpuStream</span>()<span class="comment">;</span>
        while(){
            <span class="keyword">out</span><span class="preprocessor">.write</span>(b, <span class="number">0</span>, len)<span class="comment">;</span>
        }
        <span class="keyword">out</span><span class="preprocessor">.close</span>()<span class="comment">;</span>
        
        response<span class="preprocessor">.getOutpuStream</span>()<span class="preprocessor">.write</span>(<span class="string">"下载成功"</span>)<span class="comment">;// 重写获得outputStream对象</span>
    } else {
       response<span class="preprocessor">.getOutpuStream</span>()<span class="preprocessor">.write</span>(<span class="string">"下载失败"</span><span class="preprocessor">.getBytes</span>(<span class="string">"utf-8"</span>))<span class="comment">;</span>
    }
}
</pre></td></tr></table></figure>

<h1 id="-">观察者模式</h1>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="code"><pre><span class="comment">// 事件源:发生事件的对象</span>
<span class="comment">// 监听器: 封装事件的接口</span>
<span class="comment">// 事件对象: 封装事件源</span>
Frame f = <span class="keyword">new</span> Frame(<span class="string">"我的窗体"</span>);
f.setSize(<span class="number">400</span>, <span class="number">280</span>);
f.setVisible(<span class="keyword">true</span>);
f.addWindowListener(<span class="keyword">new</span> MyWindowListener());
<span class="class"><span class="keyword">class</span> <span class="title">MyWindowListener</span> <span class="inheritance"><span class="keyword">extends</span></span> <span class="title">WindowAdapter</span> {</span>
    <span class="keyword">public</span> <span class="keyword">void</span> windowsClosing(WindowEvent e){
        Frame f = e.getSource();
        f.dispose();
    }
}
</pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre></td><td class="code"><pre><span class="comment">// 事件源</span>
<span class="keyword">public</span> <span class="keyword">class</span> Student {
    <span class="keyword">private</span> String name;
    <span class="keyword">private</span> StudentListener listener;
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addStudentListener</span>(){
        <span class="keyword">this</span>.listener = listener;
    }
    <span class="keyword">public</span> <span class="title">Student</span>(String name){}
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">study</span>(){
        <span class="keyword">if</span>(<span class="keyword">this</span>.listener!=<span class="keyword">null</span>){
            listener.preStudy();
        }
    }
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sleep</span>(){
        <span class="keyword">if</span>(<span class="keyword">this</span>.listener!=<span class="keyword">null</span>){
            listener.preSleep();
        }
    }
}
<span class="comment">// 监听器</span>
<span class="keyword">public</span> <span class="keyword">interface</span> StudentListener{
   <span class="keyword">void</span> preStudy(StudentEvent e);
   <span class="keyword">void</span> preSleep(StudentEvent e);
}
<span class="comment">// 事件对象</span>
<span class="keyword">public</span> <span class="keyword">class</span> StudentEvent{
    <span class="keyword">public</span> <span class="title">StudentEvent</span>(Object source){
        <span class="keyword">this</span>.source = source;
    }
    <span class="keyword">public</span> Object <span class="title">getSource</span>(){
        <span class="keyword">return</span> source;
    }
}
</pre></td></tr></table></figure>

<h1 id="servlet-">Servlet 中的监听器</h1>
<p>Servlet规范中, 提供了8个监听器(接口)</p>
<ul>
<li><p>监听 ServletContext, HttpSession, ServletRequest 三个对象的创建的创建和销毁</p>
<ol>
<li>ServletContextListener: 监听 ServletContext 的创建和销毁的监听器<br>应用启动时执行, 只执行一次<br>应用场景, 完成系统启动时的初始化工作(Spring框架)</li>
<li>HttpSessionListener: 监听 HttpSession 的创建和销毁的监听器<br>一个会话对象, 代表着一个客户端, 可以统计网站的访问量</li>
<li>ServletRequestListener: 监听 ServletReques 的创建和销毁的监听器<br>可以统计每次页面的访问次数</li>
</ol>
</li>
<li><p>监听 ServletContext, HttpSession, ServletRequest 三个对象域中数据变化的监听器</p>
<ol>
<li>ServletContextAttributeListener 监听数据的添加删除修改</li>
<li>HttpSessionAttributeListener 监听数据的添加删除修改<br>统计登陆用户列表</li>
<li>ServletRequestAttributeListener 监听数据的添加删除修改</li>
</ol>
</li>
<li><p>感知型监听器, 这种监听器不需要注册</p>
<ol>
<li><code>javax.servlet.http.HttpSessionBindingListener</code> 谁实现的这个接口, 就能感知自己合适被
HttpSession 绑定和解绑</li>
<li><code>javax.servlet.http.HttpSessionActiveListener</code> 谁实现的这个接口, 就能感知自己合适被
HttpSession 钝化和激活</li>
</ol>
</li>
</ul>
<h2 id="-">具体用法</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="code"><pre>public class MyServletContextListener extends ServletContextListener{}
<span class="comment">&lt;!-- web.xml --&gt;</span>
<span class="tag">&lt;<span class="title">listener</span>&gt;</span>
    <span class="tag">&lt;<span class="title">listener-class</span>&gt;</span>.../MyServletContextListener<span class="tag">&lt;/<span class="title">listener-class</span>&gt;</span>
<span class="tag">&lt;/<span class="title">listener</span>&gt;</span>
<span class="tag">&lt;<span class="title">listener</span>&gt;</span>
    <span class="tag">&lt;<span class="title">listener-class</span>&gt;</span>.../MyHttpSessionListener<span class="tag">&lt;/<span class="title">listener-class</span>&gt;</span>
<span class="tag">&lt;/<span class="title">listener</span>&gt;</span>
<span class="tag">&lt;<span class="title">session-config</span>&gt;</span>
    <span class="tag">&lt;<span class="title">session-timeout</span>&gt;</span>1<span class="tag">&lt;/<span class="title">session-timeout</span>&gt;</span> <span class="comment">&lt;!-- 一分钟后销毁 --&gt;</span>
<span class="tag">&lt;/<span class="title">session-config</span>&gt;</span>
</pre></td></tr></table></figure>

<h2 id="-">监听器案例</h2>
<p>在线踢人</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
</pre></td><td class="code"><pre><span class="keyword">public</span> <span class="keyword">class</span> User{
   <span class="keyword">private</span> String username;
   <span class="keyword">private</span> String password;
}
</pre></td></tr></table></figure>

<p>Login.jsp</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
</pre></td><td class="code"><pre><span class="tag">&lt;<span class="title">body</span>&gt;</span>
    <span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">"loginservlet"</span> <span class="attribute">method</span>=<span class="value">"posj"</span>&gt;</span>
        <span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"text"</span> <span class="attribute">name</span>=<span class="value">"username"</span>/&gt;</span>
        <span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"password"</span> <span class="attribute">name</span>=<span class="value">"password"</span>/&gt;</span>
        <span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"submit"</span>/&gt;</span>
    <span class="tag">&lt;/<span class="title">form</span>&gt;</span>
<span class="tag">&lt;/<span class="title">body</span>&gt;</span>
</pre></td></tr></table></figure>

<p>LoginServlet.java</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
</pre></td><td class="code"><pre>public void doGet(){
    req<span class="preprocessor">.setCharactorEncoding</span>(<span class="string">"utf-8"</span>)<span class="comment">;</span>
    String user = req<span class="preprocessor">.getParameter</span>(<span class="string">"username"</span>)<span class="comment">;</span>
    String password = req<span class="preprocessor">.getParameter</span>(<span class="string">"password"</span>)<span class="comment">;</span>
    User user = new User()<span class="comment">;</span>
    user<span class="preprocessor">.setUsername</span>(username)<span class="comment">;</span>
    user<span class="preprocessor">.setPassword</span>(password)<span class="comment">;</span>
    request<span class="preprocessor">.getSessioin</span>()<span class="preprocessor">.setAttribute</span>(<span class="string">"user"</span>, user)<span class="comment">;</span>
    res<span class="preprocessor">.sendRedirect</span>(req<span class="preprocessor">.getContexPath</span>())<span class="comment">; // 重定向到主页</span>
}
</pre></td></tr></table></figure>

<p>监听域中数据的变化</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td><td class="code"><pre><span class="keyword">public</span> class OnlineUserListener implement HttpSessionAttributeListener {
    <span class="comment">// 设置登陆标记 </span>
    <span class="comment">// 监听到的目的: 找一个容器 Map&lt;用户名, httpSession&gt; 存起来, 让index.jsp能访问到</span>

    <span class="comment">// 向任何HttpSession域中放东西, 都会经过该方法</span>
    <span class="keyword">public</span> <span class="literal">void</span> attributeAdded(HttpSessionBindingListener e) {
        HttpSession session <span class="subst">=</span> se<span class="built_in">.</span>getSession();
        Object obj <span class="subst">=</span> session<span class="built_in">.</span>getAttribute(<span class="string">"user"</span>);
        <span class="keyword">if</span>(obj<span class="subst">==</span><span class="built_in">null</span>){
            <span class="comment">// 放的标记不是User</span>
            <span class="keyword">return</span>;
        }
        <span class="keyword">if</span>(<span class="subst">!</span>(obj instanceof User){
            <span class="keyword">return</span>;
        }
        ServletContext sc <span class="subst">=</span> session<span class="built_in">.</span>getServletContext();
         <span class="comment">//存放登陆用户名和对应HttpSession对象</span>
        <span class="built_in">Map</span><span class="subst">&lt;</span><span class="built_in">String</span>, HttpSession<span class="subst">&gt;</span> <span class="built_in">map</span> <span class="subst">=</span> sc<span class="built_in">.</span>getAttribute(<span class="string">"map"</span>);
        <span class="keyword">if</span>(<span class="built_in">map</span><span class="subst">==</span><span class="built_in">null</span>){
             <span class="built_in">map</span> <span class="subst">=</span> Collections<span class="built_in">.</span>synchronizedMap(<span class="literal">new</span> HashMap<span class="subst">&lt;</span><span class="built_in">String</span>, HttpSession<span class="subst">&gt;</span>());<span class="comment">// 线程安全的Map</span>
             sc<span class="built_in">.</span>setAttribute(<span class="string">"map"</span>, <span class="built_in">map</span>);
        }
        <span class="built_in">map</span><span class="built_in">.</span>put((User)obj<span class="built_in">.</span>getUsername(), session);
    }
}
</pre></td></tr></table></figure>

<p>index.jsp, 显示当前用户登录的登陆名</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre><span class="tag">&lt;<span class="title">body</span>&gt;</span>
    <span class="tag">&lt;<span class="title">c:forEach</span> <span class="attribute">items</span>=<span class="value">"applicationScope.map"</span> <span class="attribute">var</span>=<span class="value">"me"</span>&gt;</span>
        <span class="tag">&lt;<span class="title">c:url</span> <span class="attribute">value</span>=<span class="value">"KickServlet"</span> <span class="attribute">name</span>=<span class="value">"url"</span>&gt;</span>
            <span class="tag">&lt;<span class="title">param</span> <span class="attribute">name</span>=<span class="value">"username"</span> <span class="attribute">value</span>=<span class="value">"${me.key}"</span>&gt;</span>
            <span class="tag">&lt;/<span class="title">param</span>&gt;</span>
        <span class="tag">&lt;/<span class="title">c:url</span>&gt;</span>
        ${me.key} &nbsp; <span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"${url}"</span>&gt;</span>踢出<span class="tag">&lt;/<span class="title">a</span>&gt;</span><span class="tag">&lt;<span class="title">br</span>/&gt;</span>
    <span class="tag">&lt;/<span class="title">c:forEach</span>&gt;</span>
<span class="tag">&lt;/<span class="title">body</span>&gt;</span>
</pre></td></tr></table></figure>

<p>KickServlet.java</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre><span class="keyword">public</span> <span class="literal">void</span> doGet(){
    <span class="built_in">String</span> username <span class="subst">=</span> request<span class="built_in">.</span>getParameter(<span class="string">"username"</span>);
    username <span class="subst">=</span> <span class="literal">new</span> <span class="built_in">String</span>(username<span class="built_in">.</span>getBytes(<span class="string">"ISO-8859-1"</span>, <span class="string">"utf-8"</span>))
    ServletContext sc <span class="subst">=</span> getServletContext();
    <span class="built_in">Map</span><span class="subst">&lt;</span><span class="built_in">String</span>, HttpSession<span class="subst">&gt;</span> <span class="subst">=</span> sc<span class="built_in">.</span>getParameter(<span class="string">"map"</span>);
    <span class="built_in">map</span><span class="built_in">.</span>get(username)<span class="built_in">.</span>invalidate();
    <span class="built_in">map</span><span class="built_in">.</span>remove(username);
    res<span class="built_in">.</span>sendRedirect(rq<span class="built_in">.</span>getContexPath());
}
</pre></td></tr></table></figure>

<h1 id="-">国际化</h1>
<p>程序提供适合来访者阅读习惯的文本, i18n</p>
<h2 id="-">固定文本的国际化</h2>
<p>固定文本写在一个资源包中, 一个资源包可以包括多个 <code>*.properties</code>的文件</p>
<h3 id="-">资源的写法</h3>
<p>文件基名<em>语言</em>国家.properties 语言 国家有一定的编码, ISO来指定(基名一样)</p>
<p>msg_zh_CN.properties 中国大陆</p>
<p>msg_en_US.properties 美利坚</p>
<p>msg_en_UK.properties 大不列颠</p>
<h3 id="-">编码案例</h3>
<p>msg_en_UK.properties
msg_zh_CN.properties</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
</pre></td><td class="code"><pre>// 获取来访者使用的系统的区域位置
ResourceBundle<span class="preprocessor">.getBundle</span>(<span class="string">"cn.itcast.resources.msg"</span>)
rb<span class="preprocessor">.getString</span>(<span class="string">"hello"</span>)

// 读取美国的
Locale l = Locale<span class="preprocessor">.US</span><span class="comment">;</span>
ResourceBundle<span class="preprocessor">.getBundle</span>(<span class="string">"cn.itcast.resources.msg"</span>, l)
</pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="code"><pre><span class="vbscript">&lt;%
Locate l = req.<span class="built_in">getLocale</span>();
ResourceBundle rb = ResourceBundle.getBundle(<span class="string">""</span>, l)
%&gt;</span>
<span class="tag">&lt;<span class="title">form</span> <span class="attribute">action</span>=<span class="value">""</span>&gt;</span>
    用户名: <span class="tag">&lt;<span class="title">input</span>/&gt;</span>
    <span class="vbscript">&lt;%= rb.getString(<span class="string">"username"</span>)%&gt;</span>
<span class="tag">&lt;/<span class="title">form</span>&gt;</span>

<span class="comment">&lt;!-- 等价于 --&gt;</span>
<span class="tag">&lt;<span class="title">fmt:setLocal</span> <span class="attribute">value</span>=<span class="value">"pageContext.request.locale"</span>&gt;</span>
<span class="tag">&lt;/<span class="title">fmt:setLocal</span>&gt;</span>
<span class="tag">&lt;<span class="title">fmt:setBundle</span> <span class="attribute">basename</span>=<span class="value">"cn.itcast.resources.msg"</span> <span class="attribute">var</span>=<span class="value">"msg"</span>&gt;</span>
<span class="tag">&lt;/<span class="title">fmt:setBundle</span>&gt;</span>

<span class="tag">&lt;<span class="title">fmt:message</span> <span class="attribute">key</span>=<span class="value">"username"</span> <span class="attribute">bundle</span>=<span class="value">"${msg}"</span>&gt;</span>
<span class="tag">&lt;/<span class="title">fmt:message</span>&gt;</span>
</pre></td></tr></table></figure>

<h2 id="-">时间和日期的格式化</h2>
<p>DateFormat: 用户所有界面的输入都是String, JavaBean: java.util.date</p>
<p><code>Date parse(String s)</code>: 解析字符串成为日期对象</p>
<p><code>String format(Date d)</code>: 把日期对象转换为字符串</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
</pre></td><td class="code"><pre><span class="built_in">Date</span> d <span class="subst">=</span> <span class="literal">new</span> <span class="built_in">Date</span>();
DateFormat df <span class="subst">=</span> DateFormat<span class="built_in">.</span>getDateTimeInstance();
df<span class="built_in">.</span>format(d);
<span class="built_in">String</span> s <span class="subst">=</span> <span class="string">"2014-4-29 12:21:11"</span>
<span class="built_in">Date</span> d <span class="subst">=</span> df<span class="built_in">.</span>parse(s);

Locale l <span class="subst">=</span> Locale<span class="built_in">.</span>CHINA;
<span class="built_in">Date</span> d <span class="subst">=</span> <span class="literal">new</span> <span class="built_in">Date</span>();
DateFormat df <span class="subst">=</span> DateFormat<span class="built_in">.</span>getDateTimeInstance(DateFormate<span class="built_in">.</span><span class="literal">Full</span>, DateFormat<span class="built_in">.</span><span class="literal">Full</span>, l);
df<span class="built_in">.</span>format(d);
</pre></td></tr></table></figure>

<p>在JSP中</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre>&lt;fmt:formateDate <span class="keyword">value</span>=<span class="string">"${now}"</span> <span class="class"><span class="keyword">type</span>=</span><span class="string">"both|date|time"</span>&gt;
&lt;/fmt:formateDate&gt;
</pre></td></tr></table></figure>

<h2 id="-">数字的格式化, 货币符号</h2>
<p>NumberFormat: 用户输入的String, JavaBean:Number</p>
<p><code>Number parse(String s)</code>: 解析</p>
<p><code>String (Number s)</code>: 格式化</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
</pre></td><td class="code"><pre>Locale l = Locale<span class="preprocessor">.CHINA</span>
int money = <span class="number">10000</span><span class="comment">;</span>
NumberFormat nf = NumberFormat<span class="preprocessor">.getCurrencyFomatter</span>()<span class="comment">;</span>
nf<span class="preprocessor">.format</span>(money)
</pre></td></tr></table></figure>

<h2 id="-">批量国际化</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="code"><pre><span class="comment">// String pattern = "At 12:30 pm on jul 3,1998, a hurricance destroyed 99 house and caused $100000 of damage"</span>
<span class="built_in">String</span> pattern = <span class="string">"At {0, time, media} on {1, date, medium} a hurricance destroyed {2} house and caused {3, number, currency} of damage"</span>;

<span class="built_in">Date</span> time = <span class="keyword">new</span> <span class="built_in">Date</span>(); <span class="comment">//数据库发生的日期</span>
<span class="built_in">Date</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>(); <span class="comment">// 日期</span>

int num = <span class="number">99</span>;
int money = <span class="number">100000</span>;

MessageFormat mf = <span class="keyword">new</span> MessageFormat(pattern);
<span class="built_in">String</span> s = mf.format(<span class="keyword">new</span> <span class="built_in">Object</span>[]{time, date, num, money})
</pre></td></tr></table></figure>

  
	</div>
		<footer class="article-footer clearfix">

  <div class="article-tags">
  
  <span></span> <a href="/tags/传智播客/">传智播客</a>
  </div>




<div class="article-share" id="share">

  <div data-url="http://zhpooer.github.io/2014/04/29/传智播客day22-文件操作和监听器/" data-title="传智播客day22-文件操作和监听器 | Poe&#39;s World" data-tsina="null" class="share clearfix">
  </div>

</div>
</footer>   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2014/05/05/传智播客day23-框架学习基础加强/" title="传智播客day23-框架学习基础加强">
  <strong>PREVIOUS:</strong><br/>
  <span>
  传智播客day23-框架学习基础加强</span>
</a>
</div>


<div class="next">
<a href="/2014/04/28/传智播客day21-servlet过滤器/"  title="传智播客day21-servlet过滤器">
 <strong>NEXT:</strong><br/> 
 <span>传智播客day21-servlet过滤器
</span>
</a>
</div>

</nav>

	
<section class="comment">
	<div class="ds-thread"></div>
</section>

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
  <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#-"><span class="toc-number">1.</span> <span class="toc-text">文件上传</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-"><span class="toc-number">1.1.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-"><span class="toc-number">1.2.</span> <span class="toc-text">编码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-"><span class="toc-number">1.3.</span> <span class="toc-text">考虑的问题</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#-"><span class="toc-number">2.</span> <span class="toc-text">文件的下载</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-"><span class="toc-number">3.</span> <span class="toc-text">观察者模式</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#servlet-"><span class="toc-number">4.</span> <span class="toc-text">Servlet 中的监听器</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-"><span class="toc-number">4.1.</span> <span class="toc-text">具体用法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-"><span class="toc-number">4.2.</span> <span class="toc-text">监听器案例</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#-"><span class="toc-number">5.</span> <span class="toc-text">国际化</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-"><span class="toc-number">5.1.</span> <span class="toc-text">固定文本的国际化</span></a></li><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#-"><span class="toc-number">5.1.1.</span> <span class="toc-text">资源的写法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-"><span class="toc-number">5.1.2.</span> <span class="toc-text">编码案例</span></a></li></ol><li class="toc-item toc-level-2"><a class="toc-link" href="#-"><span class="toc-number">5.2.</span> <span class="toc-text">时间和日期的格式化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-"><span class="toc-number">5.3.</span> <span class="toc-text">数字的格式化, 货币符号</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-"><span class="toc-number">5.4.</span> <span class="toc-text">批量国际化</span></a></li></ol>
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  

  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			<li><a href="/tags/AJAX/" title="AJAX">AJAX<sup>1</sup></a></li>
		
			<li><a href="/tags/Akka/" title="Akka">Akka<sup>1</sup></a></li>
		
			<li><a href="/tags/DOM/" title="DOM">DOM<sup>2</sup></a></li>
		
			<li><a href="/tags/EL表达式/" title="EL表达式">EL表达式<sup>1</sup></a></li>
		
			<li><a href="/tags/Hadoop/" title="Hadoop">Hadoop<sup>1</sup></a></li>
		
			<li><a href="/tags/Hibernate/" title="Hibernate">Hibernate<sup>2</sup></a></li>
		
			<li><a href="/tags/HttpSession/" title="HttpSession">HttpSession<sup>1</sup></a></li>
		
			<li><a href="/tags/IO/" title="IO">IO<sup>1</sup></a></li>
		
			<li><a href="/tags/JSP/" title="JSP">JSP<sup>1</sup></a></li>
		
			<li><a href="/tags/JavaBean/" title="JavaBean">JavaBean<sup>1</sup></a></li>
		
			<li><a href="/tags/JavaScript/" title="JavaScript">JavaScript<sup>1</sup></a></li>
		
			<li><a href="/tags/Mybatis/" title="Mybatis">Mybatis<sup>1</sup></a></li>
		
			<li><a href="/tags/NoSql/" title="NoSql">NoSql<sup>1</sup></a></li>
		
			<li><a href="/tags/SAX/" title="SAX">SAX<sup>1</sup></a></li>
		
			<li><a href="/tags/ServletRequest/" title="ServletRequest">ServletRequest<sup>1</sup></a></li>
		
			<li><a href="/tags/ServletResponse/" title="ServletResponse">ServletResponse<sup>1</sup></a></li>
		
			<li><a href="/tags/Spring/" title="Spring">Spring<sup>1</sup></a></li>
		
			<li><a href="/tags/Spring MVC/" title="Spring MVC">Spring MVC<sup>1</sup></a></li>
		
			<li><a href="/tags/String/" title="String">String<sup>1</sup></a></li>
		
			<li><a href="/tags/StringBuffer/" title="StringBuffer">StringBuffer<sup>1</sup></a></li>
		
		</ul>
</div>


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<div class="social-font" class="clearfix">
		
		
		
		
	</div>
		<p class="copyright">Powered by <a href="http://zespia.tw/hexo/" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/A-limon/pacman" target="_blank" title="Pacman">Pacman</a> © 2014 
		
		<a href="http://zhpooer.github.io" target="_blank" title="zhpooer">zhpooer</a>
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top",Math.max(140,320-$(this).scrollTop()));
    });
  };
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});     
</script>


<script type="text/javascript">
  var duoshuoQuery = {short_name:"zhpoooer"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 





  </body>
</html>
