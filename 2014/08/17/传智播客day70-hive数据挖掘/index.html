
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>传智播客day70-Hive数据挖掘 | Poe&#39;s World</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
    
    <meta name="author" content="zhpooer">
    
    <meta name="description" content="Hive
Hive是建立在Hadoop上的数据仓库基础架构, 它提供了一系列的工具,
可以存储、查询和分析在 Hadoop中的大规模数据机制.
Hive 定义了简单的类 SQL 查询工具, 成为 QL, 将 QL 转换为 MapReduce.
可以结合 MapReduce 来处理复杂的分析工具
Hi">
    
    
    
    
    <link rel="alternative" href="/atom.xml" title="Poe&#39;s World" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/pacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/pacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

  <body>
    <header>
      <div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.svg" alt="Poe&#39;s World" title="Poe&#39;s World"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Poe&#39;s World">Poe&#39;s World</a></h1>
				<h2 class="blog-motto">竹杖芒鞋轻胜马，一蓑烟雨任平生</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">主页</a></li>
					
						<li><a href="/english-monthly">英语角</a></li>
					
						<li><a href="/about">关于</a></li>
					
						<li><a href="/archives">归档</a></li>
					
					<li>
					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="text" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:zhpooer.github.io">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>

    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2014/08/17/传智播客day70-hive数据挖掘/" title="传智播客day70-Hive数据挖掘" itemprop="url">传智播客day70-Hive数据挖掘</a>
  </h1>
  <p class="article-author">By
    
      <a href="http://zhpooer.github.io" title="zhpooer">zhpooer</a>
    </p>
  <p class="article-time">
    <time datetime="2014-08-17T01:21:57.000Z" itemprop="datePublished">8月 17 2014</time>
    更新日期:<time datetime="2014-08-18T02:39:07.000Z" itemprop="dateModified">8月 18 2014</time>
    
  </p>
</header>
	<div class="article-content">
		
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#hive"><span class="toc-number">1.</span> <span class="toc-text">Hive</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-"><span class="toc-number">1.1.</span> <span class="toc-text">系统架构</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#-"><span class="toc-number">2.</span> <span class="toc-text">相关操作</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-"><span class="toc-number">3.</span> <span class="toc-text">设置数据库</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-"><span class="toc-number">4.</span> <span class="toc-text">外部表</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-"><span class="toc-number">5.</span> <span class="toc-text">分区表</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#sqoop-"><span class="toc-number">6.</span> <span class="toc-text">sqoop 导入导出</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-udf-"><span class="toc-number">7.</span> <span class="toc-text">自定义函数(UDF)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-flume-"><span class="toc-number">8.</span> <span class="toc-text">数据采集框架(flume)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-"><span class="toc-number">9.</span> <span class="toc-text">论坛数据分析</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-"><span class="toc-number">10.</span> <span class="toc-text">建立简历</span></a></li></ol>
		</div>
		
		<h1 id="hive">Hive</h1>
<p>Hive是建立在Hadoop上的数据仓库基础架构, 它提供了一系列的工具,
可以存储、查询和分析在 Hadoop中的大规模数据机制.
Hive 定义了简单的类 SQL 查询工具, 成为 QL, 将 QL 转换为 MapReduce.</p>
<p>可以结合 MapReduce 来处理复杂的分析工具</p>
<p>Hive表就是 HDFS 的目录, Hive数据就是目录里边的文件</p>
<h2 id="-">系统架构</h2>
<ul>
<li>用户接口, CLI, JDBC/ODBC, WebUI</li>
<li>元数据存储(Hive字段, 字段类型), 通常是存储在关系数据库如 mysql, derby 中</li>
<li>解释器, 编译器, 优化器, 执行器</li>
<li>Hadoop, 用HDFS进行存储, 利用 MapReduce 进行计算</li>
</ul>
<h1 id="-">相关操作</h1>
<p>启动Hive <code>hive</code>, 所有创建的表存在 <code>/user/hive/warehouse</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
</pre></td><td class="code"><pre><span class="operator"><span class="keyword">show</span> databases;</span>
<span class="comment">-- 默认使用 default</span>
<span class="operator"><span class="keyword">show</span> tables;</span>
<span class="operator"><span class="keyword">create</span> <span class="keyword">table</span> student (
  id <span class="keyword">int</span>,
  name string
);</span>

<span class="comment">-- /warehouse/itcast.db</span>
<span class="operator"><span class="keyword">create</span> <span class="keyword">database</span> itcast;</span>
use itcast;
<span class="comment">-- /warehouse/itcast.db/teacher</span>
<span class="operator"><span class="keyword">create</span> <span class="keyword">table</span> teacher (
  tid bigint,
  name string
);</span>

<span class="comment">-- 插入数据</span>
<span class="operator"><span class="keyword">load</span> data <span class="keyword">local</span> inpath <span class="string">'/home/a.txt'</span> <span class="keyword">into</span> <span class="keyword">table</span> student;</span>
<span class="comment">-- 四行 `Null Null`, 因为没有指定分隔符</span>
<span class="operator"><span class="keyword">select</span> * <span class="keyword">from</span> student;</span>
<span class="comment">-- 执行 MapReduce</span>
<span class="operator"><span class="keyword">select</span> <span class="aggregate">count</span>(*) <span class="keyword">from</span> student;</span>

<span class="operator"><span class="keyword">load</span> data <span class="keyword">local</span> inpath <span class="string">'/home/a.txt'</span> <span class="keyword">into</span> <span class="keyword">table</span> student;</span>

<span class="comment">-- 创建一张表, 以 \t 为分割</span>
<span class="operator"><span class="keyword">create</span> <span class="keyword">table</span> people(
  pid <span class="keyword">in</span>,
  name string
) <span class="keyword">row</span> format delimited fields terminated <span class="keyword">by</span> <span class="string">'\t'</span>;</span>

<span class="operator"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">table</span> people;</span>
<span class="operator"><span class="keyword">load</span> data <span class="keyword">local</span> inpath <span class="string">'/home/a.txt'</span> <span class="keyword">into</span> <span class="keyword">table</span> people;</span>
<span class="comment">-- 不会产生 mapReduce</span>
<span class="operator"><span class="keyword">select</span> * <span class="keyword">from</span> people limit <span class="number">2</span>;</span>

<span class="comment">-- 会产生 mapReduce</span>
<span class="operator"><span class="keyword">select</span> * <span class="keyword">from</span> people groupby pid <span class="keyword">desc</span>;</span>

<span class="comment">-- 执行 hadoop 命令</span>
dfs -ls /
dfs -put /home/hadoop/b.txt /user/hive/warehouse/peoples
</pre></td></tr></table></figure>

<p><code>data.txt</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>1  zhangsan
2  lisi
3  wangwu
</pre></td></tr></table></figure>

<p>可以将 <code>data2.txt</code> 放入 <code>/user/hive/warehouse/people</code>, 以至于也可以将文件加入数据库
<code>data2.txt</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre>10 zhangsan
11  lisi
</pre></td></tr></table></figure>

<h1 id="-">设置数据库</h1>
<p>hive默认数据库是 derby, 只允许连接一个用户</p>
<ul>
<li>安装mysql <code>/usr/bin/mysql_secure_installation</code></li>
<li><p>配置<code>hive-default.xml</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="code"><pre><span class="tag">&lt;<span class="title">configuration</span>&gt;</span>
    <span class="comment">&lt;!-- url --&gt;</span>
    <span class="tag">&lt;<span class="title">property</span>&gt;</span>
        <span class="tag">&lt;<span class="title">name</span>&gt;</span> javax.jdo.option.ConnectionURL
        <span class="tag">&lt;/<span class="title">name</span>&gt;</span>
        <span class="tag">&lt;<span class="title">value</span>&gt;</span>?createDatabaseInNotExist=true
        <span class="tag">&lt;/<span class="title">value</span>&gt;</span>
    <span class="tag">&lt;/<span class="title">property</span>&gt;</span>
    <span class="comment">&lt;!-- 连接驱动 --&gt;</span>
    <span class="comment">&lt;!-- 用户名 --&gt;</span>
    <span class="comment">&lt;!-- 密码 --&gt;</span>
<span class="tag">&lt;/<span class="title">configuration</span>&gt;</span>
</pre></td></tr></table></figure>
</li>
<li><p>拷贝jar文件到<code>lib</code>文件夹下</p>
</li>
<li>数据库授权<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre>grant all priveleges on <span class="strong">*.*</span> to <span class="smartquote">`root`@`%` identity by '</span>root';
flush priveleges;
</pre></td></tr></table></figure>

</li>
</ul>
<h1 id="-">外部表</h1>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
</pre></td><td class="code"><pre><span class="title">dfs</span> -mkdir /<span class="typedef"><span class="keyword">data</span>;</span>
<span class="title">dfs</span> -put /home/hadoop/*.txt /<span class="typedef"><span class="keyword">data</span></span>
<span class="title">dfs</span> -ls /<span class="typedef"><span class="keyword">data</span></span>
<span class="comment">-- 在其他目录创建 /data, 关联到表, 外部表</span>
<span class="title">create</span> external table users (
  uid int,row format delimited fields terminated by '\t' location '/<span class="typedef"><span class="keyword">data</span>';</span>
  uname string
) row format delimited fields terminated by '\t' location '/<span class="typedef"><span class="keyword">data</span>';</span>
</pre></td></tr></table></figure>

<h1 id="-">分区表</h1>
<p>如按月份分区存储数据, 在数据量非常大的情况下</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="code"><pre>
<span class="comment">-- 建立外部分区表</span>
<span class="operator"><span class="keyword">create</span> <span class="keyword">external</span> <span class="keyword">table</span> beauties (
  id <span class="keyword">int</span>,
  name string,
  <span class="keyword">size</span> <span class="keyword">double</span>
) <span class="keyword">row</span> format delimited fields terminated <span class="keyword">by</span> <span class="string">'\t'</span> location <span class="string">'/beauty'</span>;</span>

<span class="comment">-- 指定分区 'China', 在hdfs上要增加一个 `notion=China` 的文件夹(dfs -mkdir /beauty/nation=China), 和一个字段 </span>
<span class="operator"><span class="keyword">load</span> data <span class="keyword">local</span> inpath <span class="string">'/home/hadoop/b.c'</span> <span class="keyword">into</span> <span class="keyword">table</span> beauties partition (nation=<span class="string">'China'</span>);</span>

dfs -mkdir /beauty/nation=Japan;
<span class="operator"><span class="keyword">alter</span> <span class="keyword">table</span> beauties <span class="keyword">add</span> partition (nation=<span class="string">'Japan'</span>) location <span class="string">`/beauty/nation=Japan`</span>;</span>

<span class="comment">-- 建分区表是为了可以快速查询</span>
<span class="operator"><span class="keyword">select</span> * <span class="keyword">from</span> beauties <span class="keyword">where</span> nation = <span class="string">'china'</span>;</span>
<span class="operator"><span class="keyword">select</span> nation, <span class="aggregate">avg</span>(<span class="keyword">size</span>) si <span class="keyword">from</span> beauties <span class="keyword">group</span> <span class="keyword">by</span> nation <span class="keyword">order</span> <span class="keyword">by</span> si;</span>
</pre></td></tr></table></figure>

<h1 id="sqoop-">sqoop 导入导出</h1>
<p>mysql数据导入到 hdfs</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
</pre></td><td class="code"><pre><span class="comment">##</span> <span class="comment">导入到</span> <span class="comment">hdfs</span>
<span class="comment">##</span> <span class="literal">-</span><span class="comment">m</span> <span class="comment">启动</span> <span class="comment">2个</span> <span class="comment">mapreduce</span> <span class="comment">一起导入</span>
<span class="comment">sqoop</span> <span class="comment">import</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">connect</span> <span class="comment">jdbc:mysql://mysql:3306/itcast</span>
<span class="literal">-</span><span class="literal">-</span><span class="comment">username</span> <span class="comment">root</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">password</span> <span class="comment">123</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">table</span> <span class="comment">trade_detail</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">target</span><span class="literal">-</span><span class="comment">dir</span> <span class="comment">/sqoop</span> <span class="literal">-</span><span class="comment">m</span> <span class="comment">2</span>

<span class="comment">##</span> <span class="comment">导入到</span> <span class="comment">mysql</span>
<span class="comment">##</span> <span class="comment">create</span> <span class="comment">table</span> <span class="comment">td1</span> <span class="comment">like</span> <span class="comment">trade_detail;</span>

<span class="comment">sqoop</span> <span class="comment">exoport</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">connect</span> <span class="comment">jdbc:mysql://mysql:3306/itcast</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">username</span> <span class="comment">root</span>
<span class="literal">-</span><span class="literal">-</span><span class="comment">password</span> <span class="comment">123</span>  <span class="literal">-</span><span class="literal">-</span><span class="comment">password</span> <span class="comment">123</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">export</span><span class="literal">-</span><span class="comment">dir</span> <span class="comment">'/sqoop/td'</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">table</span> <span class="comment">td1</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">fields</span><span class="literal">-</span><span class="comment">terminatd</span><span class="literal">-</span><span class="comment">by</span> <span class="comment">'\t'</span>
</pre></td></tr></table></figure>

<h1 id="-udf-">自定义函数(UDF)</h1>
<ol>
<li>导入jar包, <code>hive.jar</code>, <code>hadoop-common.jar</code></li>
<li><p>编写程序</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="code"><pre><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NationUDF</span> <span class="keyword">extends</span> <span class="title">UDF</span> {</span>
    <span class="keyword">private</span> <span class="keyword">static</span> map&lt;String, String&gt; nationMap = <span class="keyword">new</span> HashMap&lt;String, String&gt;;
    <span class="keyword">static</span> {
        nationMap.put(<span class="string">"China"</span>, <span class="string">"天朝"</span>);
        nationMap.put(<span class="string">"Japan"</span>, <span class="string">"小日本"</span>);
        nationMap.put(<span class="string">"USA"</span>, <span class="string">"米国"</span>);
    }
    
    <span class="keyword">private</span> Text t = <span class="keyword">new</span> Text();
    
    <span class="comment">// 返回 hadoop 支持的序列化类型</span>
    <span class="keyword">public</span> Text <span class="title">evaluate</span>(Text ename) {
        String en = ename.toString();
        String cname = nationMap.get(en);
        <span class="keyword">if</span>(cname == <span class="keyword">null</span>) {
            cname = <span class="string">"火星人"</span>;
        }
        t.set(cname);
        <span class="keyword">return</span> t;
    }
}
</pre></td></tr></table></figure>
</li>
<li><p>打包</p>
</li>
<li>运行 hive 命令<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
</pre></td><td class="code"><pre>add jar /home/hadoop/udf.jar
<span class="comment">-- 创建临时函数</span>
<span class="operator"><span class="keyword">create</span> <span class="keyword">temporary</span> function getNN <span class="keyword">as</span> <span class="string">'cn.itcast.hive.udf.NationUDF'</span>;</span>
<span class="comment">-- 调用</span>
<span class="operator"><span class="keyword">select</span> id, name, getNN(nation) <span class="keyword">from</span> beauties;</span>
<span class="comment">-- 将查询语句的结果存入表</span>
<span class="operator"><span class="keyword">create</span> <span class="keyword">table</span> result <span class="keyword">row</span> format delimited fields terminated <span class="keyword">by</span> <span class="string">'\t'</span> <span class="keyword">as</span>
     <span class="keyword">select</span> id, name, getNN(nation) <span class="keyword">from</span> beauties;</span>
</pre></td></tr></table></figure>

</li>
</ol>
<h1 id="-flume-">数据采集框架(flume)</h1>
<p>注意版本(0.9和1.0)</p>
<p>Agent, 采集数据的单元, 包括 Source, Channel, Sink</p>
<p>Redis可用于分布式session存储</p>
<p>Flume 可用于收集多台机器的产生的数据(如 log), 写入到 HDFS 里面</p>
<ol>
<li><p>修改配置文件 <code>flume.env</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>JAVA_HOME=<span class="keyword">...</span>
</pre></td></tr></table></figure>
</li>
<li><p><code>conf/a2.conf</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="code"><pre><span class="preprocessor">## 设置 agent 的 源 通道 代理</span>
a2<span class="preprocessor">.sources</span> = <span class="built_in">r1</span>
a2<span class="preprocessor">.channels</span> = c1
a2<span class="preprocessor">.sinks</span> = k1

<span class="preprocessor"># 定义具体的soruce</span>
a2<span class="preprocessor">.sources</span><span class="preprocessor">.r</span>1<span class="preprocessor">.type</span> = exec   <span class="preprocessor"># 或 spooldir 监听数据变化</span>
a2<span class="preprocessor">.sources</span><span class="preprocessor">.r</span>1<span class="preprocessor">.command</span> = tail -F /root/a<span class="preprocessor">.log</span> <span class="preprocessor"># /home/hadoop/logs</span>

<span class="preprocessor"># 定义具体的 channel</span>
a2<span class="preprocessor">.channles</span><span class="preprocessor">.c</span>1<span class="preprocessor">.type</span> = memory
a2<span class="preprocessor">.channles</span><span class="preprocessor">.c</span>1<span class="preprocessor">.capacity</span> = <span class="number">1000</span>
a2<span class="preprocessor">.channles</span><span class="preprocessor">.c</span>1<span class="preprocessor">.transactionCapacity</span> = <span class="number">100</span>

<span class="preprocessor"># 定义具体的 sink</span>
a2<span class="preprocessor">.sinks</span><span class="preprocessor">.k</span>1<span class="preprocessor">.type</span> = logger  <span class="preprocessor"># 或 hdfs</span>

<span class="preprocessor"># 可以定义拦截器, 为消息添加时间戳</span>

<span class="preprocessor"># 关联 channel</span>
a2<span class="preprocessor">.sources</span><span class="preprocessor">.r</span>1<span class="preprocessor">.channels</span> = c1
a2<span class="preprocessor">.sinks</span><span class="preprocessor">.k</span>1<span class="preprocessor">.channnels</span> = c1
</pre></td></tr></table></figure>
</li>
<li><p>启动</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre><span class="preprocessor">## -c 配置文件目录, -D jvm 配置</span>
flume-ng agent -n a2 -f conf/a2<span class="preprocessor">.conf</span> -c conf -Dflume<span class="preprocessor">.root</span><span class="preprocessor">.logger</span>=INFO,console
</pre></td></tr></table></figure>

</li>
</ol>
<h1 id="-">论坛数据分析</h1>
<p>网站指标</p>
<ul>
<li>浏览量PV: 每个页面访问页面数</li>
<li>访客数UV: 通常以 Cookie 为依据</li>
<li>IP数</li>
<li>跳出率, 浏览一个页面的访问次数/全部访问次数汇总</li>
<li>版块热度排行</li>
</ul>
<p>开发步骤</p>
<ul>
<li>flume 采集数据</li>
<li>对数据进行清洗(可以使用flume拦截器)</li>
<li>使用hive进行数据的多维分析</li>
<li>hive分析结果通过 sqoop 导出到 mysql 中</li>
<li>提供视图工具供用户使用</li>
</ul>
<p>hive 创建表</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre><span class="operator"><span class="keyword">create</span> <span class="keyword">external</span> <span class="keyword">table</span> hmbbs(
  ip string,
  logtime string,
  url string
) partitioned <span class="keyword">by</span> (logdate string) <span class="keyword">row</span> format delimited fields terminated <span class="keyword">by</span> <span class="string">'\t'</span> location <span class="string">"/cleaned"</span>;</span>
</pre></td></tr></table></figure>

<p>定时运行脚本</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="code"><pre>CURRENT=`date +%y%m%d`
hadoop jar /cleaner.jar /flume/$CURRENT /cleaned/$CURRENT

## 清洗数据 
hive -e "<span class="operator"><span class="keyword">alter</span> <span class="keyword">table</span> hmbbs <span class="keyword">add</span> partition (logdate=$<span class="keyword">CURRENT</span>) location <span class="string">'/cleaned/$CURRENT'</span><span class="string">"
## PV
hive -e "</span><span class="keyword">select</span> <span class="aggregate">count</span>(*) <span class="keyword">from</span> hmbbs <span class="keyword">where</span> logdate=$<span class="keyword">CURRENT</span><span class="string">";
## UV
hive -e "</span><span class="keyword">select</span> <span class="aggregate">count</span>(<span class="keyword">distinct</span> ip) <span class="keyword">from</span> hmbbs <span class="keyword">where</span> logdate=$<span class="keyword">CURRENT</span><span class="string">";
## 注册用户数
hive -e "</span><span class="keyword">select</span> <span class="aggregate">count</span>(*) <span class="keyword">from</span> hmbbs <span class="keyword">where</span> logdate=$<span class="keyword">CURRENT</span> <span class="keyword">and</span> instr(url, <span class="string">'member.php?mod=register'</span>)&gt;<span class="number">0</span><span class="string">";

## 查找重点用户, 倒叙
hive -e "</span><span class="keyword">create</span> <span class="keyword">table</span> vip_$<span class="keyword">current</span> <span class="keyword">row</span> format delimited fields terminated <span class="keyword">by</span> <span class="string">'\t'</span>
    <span class="keyword">select</span> ip, <span class="aggregate">count</span>(*) <span class="keyword">as</span> vtimes <span class="keyword">from</span> hmbbs groupby ip <span class="keyword">having</span> vtimes &gt;= <span class="number">50</span> <span class="keyword">order</span> <span class="keyword">by</span> vtimes <span class="keyword">desc</span><span class="string">";

## 导出数据到 mysql
sqoop export --connect jdbc:mysql://mysql:3306/itcast --username root
  --password root "</span>/<span class="keyword">user</span>/hive/warehouse/vip_$<span class="keyword">CURRENT</span><span class="string">" --table vip --fields-terminatd-by '\t';</span></span>
</pre></td></tr></table></figure>

<h1 id="-">建立简历</h1>
<p>虚拟化: openStack, cloudStack</p>
<p>需要掌握技能:</p>
<ul>
<li>集群的搭建</li>
<li>MapReduce 编写</li>
</ul>
  
	</div>
		<footer class="article-footer clearfix">

  <div class="article-tags">
  
  <span></span> <a href="/tags/传智播客/">传智播客</a><a href="/tags/hadoop/">hadoop</a>
  </div>




<div class="article-share" id="share">

  <div data-url="http://zhpooer.github.io/2014/08/17/传智播客day70-hive数据挖掘/" data-title="传智播客day70-Hive数据挖掘 | Poe&#39;s World" data-tsina="null" class="share clearfix">
  </div>

</div>
</footer>   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2014/08/18/play-for-scala-json/" title="Play for Scala-JSON">
  <strong>PREVIOUS:</strong><br/>
  <span>
  Play for Scala-JSON</span>
</a>
</div>


<div class="next">
<a href="/2014/08/16/传智播客day69-搭建hadoop集群/"  title="传智播客day69-搭建Hadoop集群">
 <strong>NEXT:</strong><br/> 
 <span>传智播客day69-搭建Hadoop集群
</span>
</a>
</div>

</nav>

	
<section class="comment">
	<div class="ds-thread"></div>
</section>

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
  <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#hive"><span class="toc-number">1.</span> <span class="toc-text">Hive</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-"><span class="toc-number">1.1.</span> <span class="toc-text">系统架构</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#-"><span class="toc-number">2.</span> <span class="toc-text">相关操作</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-"><span class="toc-number">3.</span> <span class="toc-text">设置数据库</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-"><span class="toc-number">4.</span> <span class="toc-text">外部表</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-"><span class="toc-number">5.</span> <span class="toc-text">分区表</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#sqoop-"><span class="toc-number">6.</span> <span class="toc-text">sqoop 导入导出</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-udf-"><span class="toc-number">7.</span> <span class="toc-text">自定义函数(UDF)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-flume-"><span class="toc-number">8.</span> <span class="toc-text">数据采集框架(flume)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-"><span class="toc-number">9.</span> <span class="toc-text">论坛数据分析</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-"><span class="toc-number">10.</span> <span class="toc-text">建立简历</span></a></li></ol>
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  

  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			<li><a href="/tags/AJAX/" title="AJAX">AJAX<sup>1</sup></a></li>
		
			<li><a href="/tags/Akka/" title="Akka">Akka<sup>1</sup></a></li>
		
			<li><a href="/tags/Android/" title="Android">Android<sup>1</sup></a></li>
		
			<li><a href="/tags/DOM/" title="DOM">DOM<sup>2</sup></a></li>
		
			<li><a href="/tags/EL表达式/" title="EL表达式">EL表达式<sup>1</sup></a></li>
		
			<li><a href="/tags/HBase/" title="HBase">HBase<sup>1</sup></a></li>
		
			<li><a href="/tags/Hadoop/" title="Hadoop">Hadoop<sup>1</sup></a></li>
		
			<li><a href="/tags/Hibernate/" title="Hibernate">Hibernate<sup>2</sup></a></li>
		
			<li><a href="/tags/HttpSession/" title="HttpSession">HttpSession<sup>1</sup></a></li>
		
			<li><a href="/tags/IO/" title="IO">IO<sup>1</sup></a></li>
		
			<li><a href="/tags/Illustrator/" title="Illustrator">Illustrator<sup>3</sup></a></li>
		
			<li><a href="/tags/JSP/" title="JSP">JSP<sup>1</sup></a></li>
		
			<li><a href="/tags/JavaBean/" title="JavaBean">JavaBean<sup>1</sup></a></li>
		
			<li><a href="/tags/JavaScript/" title="JavaScript">JavaScript<sup>1</sup></a></li>
		
			<li><a href="/tags/Mybatis/" title="Mybatis">Mybatis<sup>1</sup></a></li>
		
			<li><a href="/tags/NoSql/" title="NoSql">NoSql<sup>1</sup></a></li>
		
			<li><a href="/tags/SAX/" title="SAX">SAX<sup>1</sup></a></li>
		
			<li><a href="/tags/ServletRequest/" title="ServletRequest">ServletRequest<sup>1</sup></a></li>
		
			<li><a href="/tags/ServletResponse/" title="ServletResponse">ServletResponse<sup>1</sup></a></li>
		
			<li><a href="/tags/Spring/" title="Spring">Spring<sup>1</sup></a></li>
		
		</ul>
</div>


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<div class="social-font" class="clearfix">
		
		
		
		
	</div>
		<p class="copyright">Powered by <a href="http://zespia.tw/hexo/" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/A-limon/pacman" target="_blank" title="Pacman">Pacman</a> © 2014 
		
		<a href="http://zhpooer.github.io" target="_blank" title="zhpooer">zhpooer</a>
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top",Math.max(140,320-$(this).scrollTop()));
    });
  };
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});     
</script>


<script type="text/javascript">
  var duoshuoQuery = {short_name:"zhpoooer"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 





  </body>
</html>
