
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>传智播客day43-ssh综合练习 仓库管理系统 | Poe&#39;s World</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
    
    <meta name="author" content="zhpooer">
    
    <meta name="description" content="仓库管理系统的分析
项目开发两种:

前端人员制作页面(CSS+DIV/Frame)
Java工程师开发前端页面(UI框架 ExtJS, JqueryEasyUI, flex),
同时开发服务器端

导入页面新项目:

新建项目, 将代码复制(不建议 import), 不同开发工具, 结构不同
使用">
    
    
    
    
    <link rel="alternative" href="/atom.xml" title="Poe&#39;s World" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/pacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/pacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

  <body>
    <header>
      <div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.svg" alt="Poe&#39;s World" title="Poe&#39;s World"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Poe&#39;s World">Poe&#39;s World</a></h1>
				<h2 class="blog-motto">竹杖芒鞋轻胜马，一蓑烟雨任平生</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">主页</a></li>
					
						<li><a href="/english-monthly">英语角</a></li>
					
						<li><a href="/about">关于</a></li>
					
						<li><a href="/archives">归档</a></li>
					
					<li>
					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="text" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:zhpooer.github.io">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>

    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2014/06/03/传智播客day43-ssh综合练习/" title="传智播客day43-ssh综合练习 仓库管理系统" itemprop="url">传智播客day43-ssh综合练习 仓库管理系统</a>
  </h1>
  <p class="article-author">By
    
      <a href="http://zhpooer.github.io" title="zhpooer">zhpooer</a>
    </p>
  <p class="article-time">
    <time datetime="2014-06-03T01:05:17.000Z" itemprop="datePublished">6月 3 2014</time>
    更新日期:<time datetime="2014-06-07T06:19:24.000Z" itemprop="dateModified">6月 7 2014</time>
    
  </p>
</header>
	<div class="article-content">
		
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#-"><span class="toc-number">1.</span> <span class="toc-text">仓库管理系统的分析</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-"><span class="toc-number">2.</span> <span class="toc-text">项目开发流程</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-"><span class="toc-number">3.</span> <span class="toc-text">数据库建模</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-"><span class="toc-number">4.</span> <span class="toc-text">登陆页面</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-"><span class="toc-number">4.1.</span> <span class="toc-text">业务层</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#-"><span class="toc-number">5.</span> <span class="toc-text">添加仓库</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-"><span class="toc-number">6.</span> <span class="toc-text">仓库列表查询</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-"><span class="toc-number">7.</span> <span class="toc-text">仓库删除和仓库修改</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-"><span class="toc-number">8.</span> <span class="toc-text">窗口嵌套</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-"><span class="toc-number">9.</span> <span class="toc-text">货物入库操作</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-"><span class="toc-number">9.1.</span> <span class="toc-text">仓库下拉列表的制作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-"><span class="toc-number">9.2.</span> <span class="toc-text">仓库列表缓存使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-"><span class="toc-number">9.3.</span> <span class="toc-text">简记码的数据回显</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-"><span class="toc-number">9.4.</span> <span class="toc-text">入库操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-"><span class="toc-number">9.5.</span> <span class="toc-text">货物名自动补全</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#-"><span class="toc-number">10.</span> <span class="toc-text">多条件组合分页查询</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-"><span class="toc-number">10.1.</span> <span class="toc-text">服务器完成分页条件查询</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#get-"><span class="toc-number">11.</span> <span class="toc-text">Get编码过滤器</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-"><span class="toc-number">12.</span> <span class="toc-text">自定义标签(分页工具)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-"><span class="toc-number">13.</span> <span class="toc-text">历史记录查询</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#paginationtag-freemarker-"><span class="toc-number">14.</span> <span class="toc-text">paginationTag的freemarker重构</span></a></li></ol>
		</div>
		
		<h1 id="-">仓库管理系统的分析</h1>
<p>项目开发两种:</p>
<ol>
<li>前端人员制作页面(CSS+DIV/Frame)</li>
<li>Java工程师开发前端页面(UI框架 ExtJS, JqueryEasyUI, flex),
同时开发服务器端</li>
</ol>
<p>导入页面新项目:</p>
<ul>
<li>新建项目, 将代码复制(不建议 import), 不同开发工具, 结构不同</li>
<li>使用 JavaEE5 版本</li>
</ul>
<p>功能</p>
<ul>
<li>用户登陆功能</li>
<li>仓库管理(仓库CURD), 单表的增删改查</li>
<li>货物的入库管理</li>
<li>货物的出库管理</li>
<li>库存管理(多条件的组合查询, 分页效果)</li>
<li>历史记录管理</li>
</ul>
<p>开发目标:</p>
<ol>
<li>实现所有功能</li>
<li>能够熟练开发 ssh, 完成 多表, 单表增删改查, 多条件分页查询, Ajax功能</li>
</ol>
<h1 id="-">项目开发流程</h1>
<p>采用 瀑布开发模型(自上而下)</p>
<ol>
<li>需求调研和需求分析</li>
<li>项目分析设计<ol>
<li>页面原型制作(CSS+DIV, Frameset, ExtJS, EasyUI), 为了和客户 确认需求</li>
<li>数据库设计(E-R图, 分析图, 企业不需要),
使用 PowerDesigner 数据库建模工具(概念数据模型CDM, 物理数据模型PDM, 面向对象模型OOM)</li>
<li>软件功能进行分析设计(UML同一建模语言)<pre><code>用例图, 描述系统功能需求
时序图, 活动图, 系统流程
类图, 程序结构
工具: Ration Rose, StarUML, Jude, 生成基础程序代码
</code></pre></li>
</ol>
</li>
<li>系统技术选项, struts2+spring3+Hibernate3+JQuery+C3P0+MySQL+Tomcat<ol>
<li>程序代码编写</li>
<li>代码测试</li>
<li>项目实施部署, 后期运维</li>
</ol>
</li>
</ol>
<h1 id="-">数据库建模</h1>
<p>仓库管理模块分析, 需要四张表</p>
<ul>
<li>Userinfo 用户信息表</li>
<li>Store 仓库表</li>
<li>Goods 货物表</li>
<li>History 进出库历史数据</li>
</ul>
<p>关系:
一个仓库存放多种货物
一个货物进出库产生多条历史记录</p>
<p>企业进行数据库设计, 通过 PowerDesigner 完成, 生成sql脚本, 经典版本 12.5</p>
<ul>
<li>CDM, 概念模型, 类似 E-R图分析</li>
<li>PDM, 表结构, 直接生成 sql 语句(入口)</li>
<li>OOM 面向对象模型, 类图, 直接生成程序代码</li>
<li>BPM 业务流程模型, 流程设计</li>
</ul>
<p><img src="/img/pd_ssh.png" alt="PowerDesigner"></p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre></td><td class="code"><pre><span class="operator"><span class="keyword">create</span> <span class="keyword">database</span> store <span class="keyword">character</span> <span class="keyword">set</span> UTF8;</span>
use store;
<span class="operator"><span class="keyword">create</span> <span class="keyword">table</span> userinfo( /*用户表*/
   id <span class="keyword">varchar</span>(<span class="number">32</span>) <span class="keyword">primary</span> <span class="keyword">key</span>,
   name <span class="keyword">varchar</span>(<span class="number">50</span>),
   password <span class="keyword">varchar</span>(<span class="number">32</span>)
);</span>
<span class="comment">/*仓库表*/</span>
<span class="operator"><span class="keyword">create</span> <span class="keyword">table</span> store(
	id <span class="keyword">varchar</span>(<span class="number">32</span>) <span class="keyword">primary</span> <span class="keyword">key</span>,
	name <span class="keyword">varchar</span>(<span class="number">32</span>),/*仓库名称*/
	addr <span class="keyword">varchar</span>(<span class="number">100</span>),/*仓库所在地*/
	manager <span class="keyword">varchar</span>(<span class="number">32</span>) /*仓库管理人员，不关联userinfo表*/
);</span>

<span class="comment">/*货物表*/</span>
<span class="operator"><span class="keyword">create</span> <span class="keyword">table</span> goods(
	id <span class="keyword">varchar</span>(<span class="number">32</span>) <span class="keyword">primary</span> <span class="keyword">key</span>,
	name <span class="keyword">varchar</span>(<span class="number">50</span>),/*货物名称*/
	nm   <span class="keyword">varchar</span>(<span class="number">10</span>),/*货物简记内码,如阿斯匹林为ASPL*/
	unit <span class="keyword">varchar</span>(<span class="number">10</span>),   /*计量单位,<span class="number">1</span>:个，<span class="number">2</span>:GK,<span class="number">3</span>:只，..*/
	amount <span class="keyword">numeric</span>(<span class="number">10</span>,<span class="number">2</span>),/*库存数量*/
	storeid <span class="keyword">varchar</span>(<span class="number">32</span>),/*所在仓库ID*/
	<span class="keyword">constraint</span> <span class="keyword">foreign</span> <span class="keyword">key</span>(storeid) <span class="keyword">references</span> store(id)
);</span>
<span class="comment">/*出入库历史记录*/</span>
<span class="operator"><span class="keyword">create</span> <span class="keyword">table</span> history(
	id <span class="keyword">varchar</span>(<span class="number">32</span>) <span class="keyword">primary</span> <span class="keyword">key</span>,
	goodsid <span class="keyword">varchar</span>(<span class="number">32</span>),
	datetime <span class="keyword">varchar</span>(<span class="number">19</span>),/*出入库时间*/
	_type   <span class="keyword">char</span>(<span class="number">1</span>),/*类型<span class="number">1</span>:入库，２：出库*/
	amount <span class="keyword">numeric</span>(<span class="number">10</span>,<span class="number">2</span>),/*这次出入库的数量*/
	remain <span class="keyword">numeric</span>(<span class="number">10</span>,<span class="number">2</span>),/*余量*/
	_user <span class="keyword">varchar</span>(<span class="number">50</span>),   /*操作员名称，直接保存名称，不引用userinfo表*/
	<span class="keyword">constraint</span> <span class="keyword">foreign</span> <span class="keyword">key</span>(goodsid) <span class="keyword">references</span> goods(id)
);</span>
</pre></td></tr></table></figure>

<h1 id="-">登陆页面</h1>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="code"><pre><span class="keyword">package</span> web.action
<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginAction</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span> <span class="keyword">implements</span> <span class="title">ModelDriver</span>{</span>
    <span class="keyword">private</span> Userinfo userinfo = <span class="keyword">new</span> Userinfo();
    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger LOG = Logger.getLogger(LoginAction.class);

    <span class="annotation">@Override</span> <span class="keyword">public</span> Userinfo <span class="title">getModel</span>(){
        <span class="keyword">return</span> userinfo;
    }

    <span class="keyword">public</span> String <span class="title">execute</span>(){
        Userinfo loinUser = userinfoService.login(userinfo);
        <span class="keyword">if</span>(loginUser==<span class="keyword">null</span>) {
            <span class="keyword">this</span>.addActionError(getText(<span class="string">"loginfail"</span>));
            <span class="keyword">return</span> INPUT;
        } <span class="keyword">else</span> {
            LOG.info(<span class="string">"登陆"</span>);
            ServletActionContext.getRequest().getSession().setAttribute(<span class="string">"user"</span>, loginUser);
            <span class="keyword">return</span> SUCCESS;
        }
    }
}
</pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="code"><pre>
<span class="tag">&lt;<span class="title">action</span> <span class="attribute">name</span>=<span class="value">"login"</span> <span class="attribute">class</span>=<span class="value">"LoginAction"</span>&gt;</span>
    <span class="tag">&lt;<span class="title">result</span> <span class="attribute">name</span>=<span class="value">"input"</span>&gt;</span> login.jsp <span class="tag">&lt;/<span class="title">result</span>&gt;</span>
    <span class="tag">&lt;<span class="title">result</span>&gt;</span> main.jsp <span class="tag">&lt;/<span class="title">result</span>&gt;</span>
<span class="tag">&lt;/<span class="title">action</span>&gt;</span>

// LoginAction-login-validation.xml
<span class="tag">&lt;<span class="title">validators</span>&gt;</span>
    <span class="tag">&lt;<span class="title">field</span> <span class="attribute">name</span>=<span class="value">"name"</span>&gt;</span>
        <span class="tag">&lt;<span class="title">field-validator</span> <span class="attribute">type</span>=<span class="value">"requiredstring"</span>&gt;</span>
            <span class="tag">&lt;<span class="title">message</span> <span class="attribute">key</span>=<span class="value">"name.required"</span>&gt;</span><span class="tag">&lt;/<span class="title">message</span>&gt;</span>
        <span class="tag">&lt;/<span class="title">field-validator</span>&gt;</span>
    <span class="tag">&lt;/<span class="title">field</span>&gt;</span>
    <span class="tag">&lt;<span class="title">field</span> <span class="attribute">name</span>=<span class="value">"password"</span>&gt;</span>
        <span class="tag">&lt;<span class="title">field-validator</span> <span class="attribute">type</span>=<span class="value">"requiredstring"</span>&gt;</span>
            <span class="tag">&lt;<span class="title">message</span> <span class="attribute">key</span>=<span class="value">"password.required"</span>&gt;</span><span class="tag">&lt;/<span class="title">message</span>&gt;</span>
        <span class="tag">&lt;/<span class="title">field-validator</span>&gt;</span>
    <span class="tag">&lt;/<span class="title">field</span>&gt;</span>
<span class="tag">&lt;/<span class="title">validators</span>&gt;</span>
</pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>// LoginAction<span class="preprocessor">.properties</span>
password<span class="preprocessor">.required</span>=密码不能为空
name<span class="preprocessor">.required</span>=用户名不能为空
</pre></td></tr></table></figure>

<h2 id="-">业务层</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="code"><pre><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserinfoServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserinfoService</span>{</span>
    <span class="keyword">public</span> Userinfo <span class="title">login</span>(Userinfo user) {
        <span class="keyword">return</span> userinfoDao.login(user);
    }
}

<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserinfoDaoImpl</span> <span class="title">impletments</span> <span class="title">UserinfoDao</span>{</span>
    <span class="keyword">public</span> Userinfo <span class="title">login</span>(Userinfo userinfo) {
        template.find(<span class="string">"from Userinfo where name=? and passwor?"</span>,
            userinfo.getName(), MD5Util.encypt(userinfo.getPassword()));
    }
}
</pre></td></tr></table></figure>

<h1 id="-">添加仓库</h1>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="code"><pre><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StoreActoin</span> <span class="keyword">extends</span> <span class="title">ActoinSupport</span> <span class="keyword">implements</span> <span class="title">ModelDirver</span> {</span>
    <span class="keyword">private</span> Store store = <span class="keyword">new</span> Store();
    <span class="keyword">public</span> String <span class="title">add</span>(){
        <span class="keyword">return</span> <span class="string">"addSuccess"</span>;
    }
}

<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StoreServiceImpl</span> <span class="keyword">implements</span> <span class="title">StoreService</span> {</span>
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveStore</span>(Store store) {
        storeDao.saveStore(store);
    }
}

<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StoreDaoImpl</span> <span class="keyword">implements</span> <span class="title">StoreDao</span> {</span>
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveStore</span>(Store store) {
        template.save(store);
    }
}
</pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>&lt;action <span class="property">name</span>=<span class="string">"store_*"</span> <span class="type">class</span>=<span class="string">"StoreAction"</span>&gt;
    &lt;<span class="constant">result</span> <span class="property">name</span>=<span class="string">"addSuccess"</span> type=<span class="string">"redirectAction"</span>&gt; stort_list &lt;/<span class="constant">result</span>&gt;
&lt;/action&gt;
</pre></td></tr></table></figure>

<h1 id="-">仓库列表查询</h1>
<p>仓库列表页面: jsp/store/store.jsp</p>
<figure class="highlight java:"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="code"><pre><span class="comment">// storeActoin</span>
<span class="keyword">public</span> String <span class="title">list</span>(){
    List&lt;Store&gt; stores = storeService.findAllService();
    ActionContext.getContext().put(<span class="string">"stores"</span>, stores);
    <span class="keyword">return</span> <span class="string">"listSuccess"</span>;   <span class="comment">// storeList.js</span>
}

<span class="comment">// StoreService</span>
<span class="keyword">public</span> List&lt;Store&gt; <span class="title">findAllStores</span>(){
    <span class="keyword">return</span> storeDao.findAll();
}
<span class="comment">// &lt;query name="store-query-all"&gt; from Store &lt;/query&gt;</span>
<span class="comment">// StoreDao</span>
<span class="keyword">public</span> List&lt;Store&gt; <span class="title">findAll</span>(){
    template.findByNamedQuery(<span class="string">"Store.findAll"</span>).list();
}
</pre></td></tr></table></figure>

<h1 id="-">仓库删除和仓库修改</h1>
<p>脑补</p>
<h1 id="-">窗口嵌套</h1>
<figure class="highlight javascript:"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>if(window<span class="preprocessor">.self</span> != window<span class="preprocessor">.top</span>){
    window<span class="preprocessor">.top</span><span class="preprocessor">.location</span><span class="preprocessor">.href</span> = <span class="string">"${pageContext.request.contentPath}/login.jsp"</span><span class="comment">;</span>
}
</pre></td></tr></table></figure>

<h1 id="-">货物入库操作</h1>
<p>登记货物入库, 将货物与仓库进行关联, 如果仓库中存在货物,
在原有的数量上增加, 如果没有就新建. 还有进行历史记录的保存.</p>
<h2 id="-">仓库下拉列表的制作</h2>
<p>做法一: 先执行 Action 查询所有仓库, 跳转 jsp 通过 <s:select> 生成下拉列表</p>
<p>做法二: 先加载 jsp, 通过Ajax查询所有仓库内容, 返回json, 显示下拉列表</p>
<figure class="highlight javascript:"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
</pre></td><td class="code"><pre>$(funciton(){
    $.get(<span class="string">"${contextPath}/store_ajaxlist.action"</span>, <span class="function"><span class="keyword">function</span><span class="params">(data)</span>{</span>
        $(data).each(<span class="function"><span class="keyword">function</span><span class="params">()</span>{</span>
            <span class="keyword">var</span> $option = $(<span class="string">"&lt;option value='"</span> + <span class="keyword">this</span>.id + <span class="string">"'&gt;&lt;/option&gt;"</span>)
            $(<span class="string">"#selectOption"</span>).append($option);
        })
    });
})
</pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="code"><pre><span class="comment">// storeAction</span>
<span class="keyword">public</span> String <span class="title">ajaxlist</span>(){
    List&lt;Store&gt; stores = storeService.findAllStores();
    
    <span class="comment">// 方案一: flexJson</span>
    JSONSerializer jsonSerializer = <span class="keyword">new</span> JSONSerializer();
    String json = jsonSerializer.serialize(stores);
    resopons.setContentType(<span class="string">"text/json;charset=utf-8"</span>);
    response.getWriter().print(json);
    
    <span class="comment">// 方案二: struts-json-plugin</span>
    ActionContext.getContext().getValueStack().push(store);
    <span class="keyword">return</span> <span class="string">"ajaxSuccess"</span>
}
<span class="keyword">public</span> <span class="keyword">class</span> Store{
    <span class="comment">// 不序列化 Goodses</span>
    @Json(serialize=<span class="keyword">false</span>)
    <span class="keyword">public</span> Set <span class="title">getGoodses</span>(){
    }
}
</pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
</pre></td><td class="code"><pre><span class="comment">&lt;!-- struts.xml  --&gt;</span>
<span class="tag">&lt;<span class="title">package</span> <span class="attribute">name</span>=<span class="value">"default"</span> <span class="attribute">namespace</span>=<span class="value">"/"</span> <span class="attribute">extends</span>=<span class="value">"jsondefault"</span>&gt;</span>
    <span class="tag">&lt;<span class="title">action</span> <span class="attribute">name</span>=<span class="value">""</span>&gt;</span>
        <span class="tag">&lt;<span class="title">result</span> <span class="attribute">name</span>=<span class="value">"ajaxSuccess"</span> <span class="attribute">type</span>=<span class="value">"json"</span>&gt;</span><span class="tag">&lt;/<span class="title">result</span>&gt;</span>
    <span class="tag">&lt;/<span class="title">action</span>&gt;</span>
<span class="tag">&lt;/<span class="title">package</span>&gt;</span>
</pre></td></tr></table></figure>

<h2 id="-">仓库列表缓存使用</h2>
<p>如果项目中不经过改变, 经常进行入库操作, 每次入库操作都显现下拉列表,</p>
<p>如果将仓库列表放入缓存, 在下次查询, 调用缓存, 不需要查询数据</p>
<p>Spring直接继承 Ehcache, 导入 <code>context-support.jar</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="code"><pre><span class="tag">&lt;<span class="title">beans</span> <span class="attribute">xmlns:cache</span>=<span class="value">"http://www.springframework.org/schema/cache"</span>&gt;</span>
<span class="comment">&lt;!-- 缓存工厂 --&gt;</span>
    <span class="tag">&lt;<span class="title">bean</span> <span class="attribute">id</span>=<span class="value">"ehCahceFactory"</span> <span class="attribute">class</span>=<span class="value">"EhCacheManagerFactoryBean"</span>&gt;</span>
    <span class="tag">&lt;/<span class="title">bean</span>&gt;</span>
    <span class="comment">&lt;!-- 缓存管理器 --&gt;</span>
    <span class="tag">&lt;<span class="title">bean</span> <span class="attribute">id</span>=<span class="value">"ehCacheManager"</span> <span class="attribute">class</span>=<span class="value">"EhCacheManager"</span>&gt;</span>
    <span class="tag">&lt;/<span class="title">bean</span>&gt;</span>
    <span class="comment">&lt;!-- 注解驱动缓存 --&gt;</span>
    <span class="comment">&lt;!-- todo --&gt;</span>
<span class="tag">&lt;/<span class="title">beans</span>&gt;</span>

<span class="comment">&lt;!-- 配置默认缓存区域 --&gt;</span>
<span class="comment">&lt;!-- ehcache.xml --&gt;</span>
<span class="tag">&lt;<span class="title">cache</span> <span class="attribute">name</span>=<span class="value">"store"</span> <span class="attribute">maxElementInMemory</span>=<span class="value">"1000"</span>&gt;</span>
    <span class="comment">&lt;!-- any other config --&gt;</span>
<span class="tag">&lt;/<span class="title">cache</span>&gt;</span>
</pre></td></tr></table></figure>

<p>使用 spring 缓存注解</p>
<ol>
<li><code>@Cacheable</code>, 负责将缓存</li>
<li><code>@CacheEvict</code>, 负责将缓存中的数据清空</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
</pre></td><td class="code"><pre><span class="comment">// service, 放入缓存 </span>
@Cachable(<span class="keyword">value</span>=<span class="string">"store"</span>)
<span class="keyword">public</span> List&lt;&gt; <span class="title">findAllStore</span>(){}

<span class="comment">// 调用后清理缓存</span>
@CacheEvict(<span class="keyword">value</span>=<span class="string">"store"</span>, allEntries=<span class="keyword">true</span>)
<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveStore</span>(){
}
</pre></td></tr></table></figure>

<h2 id="-">简记码的数据回显</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre><span class="comment">&lt;!-- 隐藏域id,用来标识货物是否存在, 当用户输入 后, 把查询到的货物id存入 --&gt;</span>
<span class="tag">&lt;<span class="title">s:hidden</span> <span class="attribute">name</span>=<span class="value">"id"</span> <span class="attribute">id</span>=<span class="value">"goodeId"</span>&gt;</span><span class="tag">&lt;/<span class="title">s:hidden</span>&gt;</span>
</pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="code"><pre>$(<span class="string">"input[name='nm']"</span>).blur(<span class="function"><span class="keyword">function</span><span class="params">()</span>{</span>
     <span class="comment">// 发送请求给服务器, 判断简记码是否存在</span>
     $.post(<span class="string">"${contextPath}/goods_findByNm.action"</span>, {<span class="string">"nm"</span>: $(<span class="keyword">this</span>).val}, <span class="function"><span class="keyword">function</span><span class="params">(data)</span>{</span>
         <span class="keyword">if</span>(data==<span class="literal">null</span>) {
             <span class="comment">// 清空表单, 但是不能隐藏域</span>
             <span class="comment">// $('form[name='select]').get(0).reset(); // 会出bug, 手动清空</span>
             $(<span class="string">"#goodsId"</span>).val(<span class="string">""</span>);
         } <span class="keyword">else</span> {
             <span class="comment">// 查询到货物</span>
             $(<span class="string">"#goodsId"</span>).val(data.id);
             $(<span class="string">"input[name='name']"</span>).val(data.name);
             $(<span class="string">"input[name=unit']"</span>).val(data.unit);
             $(<span class="string">"#storeSelect"</span>).val(data.store.id); <span class="comment">// 通过val函数, 使选中</span>
         }
     });
});
</pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="code"><pre><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GoodsAction</span> <span class="keyword">extends</span> <span class="title">ActioinSupport</span> <span class="keyword">implements</span> <span class="title">ModelDriver</span>&lt;<span class="title">Goods</span>&gt; {</span>
    <span class="comment">// 模型驱动</span>
    <span class="keyword">private</span> Goods goods = <span class="keyword">new</span> Goods();
    <span class="comment">// 业务犯法根据, 简记码查询</span>
    <span class="keyword">public</span> String findByNum(){
        <span class="comment">// 会报错, 可以用 OpenSessionInView</span>
        Goods goodsResult = goodsService.findByNm(goods.getNm());
        <span class="keyword">return</span> <span class="string">"findByNmSuccess"</span>; <span class="comment">// result type=json</span>
    }
}
<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GoodsDao</span> {</span>
    <span class="keyword">public</span> Good findByNm(String nm) {
        template.findByNamedQeury(<span class="string">"Goods.findByNm"</span>, nm);
    }
}
</pre></td></tr></table></figure>

<h2 id="-">入库操作</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre></td><td class="code"><pre>// GoodsAction
public String save(){
    Userinfo user = session<span class="preprocessor">.get</span>(<span class="string">"user"</span>)<span class="comment">;</span>
    goodsService<span class="preprocessor">.saveGoods</span>(goods)<span class="comment">;</span>
    return <span class="string">"saveSccess"</span><span class="comment">;  // remain.jsp</span>
}

// GoodeService, goods history -&gt; uuid
public void saveGoods(Goods goods, Userinfo user) {
    // 判断页面是否传递货物 id
    // 如果goods 里id不为空, 说明货物已经存在, 只需要修改数量
    // apache common-lang 工具
    if(StingUtils<span class="preprocessor">.isNotBlank</span>(goods<span class="preprocessor">.getId</span>())){
        // 修改数量----update
        Goods persistGoods = goodsDao<span class="preprocessor">.findById</span>(goods<span class="preprocessor">.getId</span>())<span class="comment">;</span>
        persistGoods<span class="preprocessor">.setAmount</span>(persistGoods<span class="preprocessor">.getAmount</span>() + goods<span class="preprocessor">.getAmount</span>())<span class="comment">;</span>
        History history = new History()<span class="comment">;</span>
        history<span class="preprocessor">.setUser</span>(user<span class="preprocessor">.getName</span>())<span class="comment">;</span>
        history<span class="preprocessor">.setType</span>(<span class="string">"1"</span>)<span class="comment">;</span>
        history<span class="preprocessor">.setDatetime</span>(new Date()<span class="preprocessor">.toLocaleString</span>)<span class="comment">;</span>
        history<span class="preprocessor">.setGoods</span>(persistGoods)<span class="comment">;</span>
        history<span class="preprocessor">.setAmount</span>(goods<span class="preprocessor">.getAmount</span>())<span class="comment">;</span>
        history<span class="preprocessor">.setRemain</span>(persistGoods<span class="preprocessor">.getAmount</span>())<span class="comment">;// 余量</span>
        historyDao<span class="preprocessor">.save</span>(history)<span class="comment">;</span>
    } else {
        // 新货物入库
        goodsDao<span class="preprocessor">.save</span>(goods)<span class="comment">;</span>

        History history = new History()<span class="comment">;</span>
        history<span class="preprocessor">.setUser</span>(user<span class="preprocessor">.getName</span>())<span class="comment">;</span>
        history<span class="preprocessor">.setType</span>(<span class="string">"1"</span>)<span class="comment">;</span>
        history<span class="preprocessor">.setDatetime</span>(new Date()<span class="preprocessor">.toLocaleString</span>)<span class="comment">;</span>
        history<span class="preprocessor">.setGoods</span>(persistGoods)<span class="comment">;</span>
        history<span class="preprocessor">.setAmount</span>(goods<span class="preprocessor">.getAmount</span>())<span class="comment">;</span>
        history<span class="preprocessor">.setRemain</span>(goods<span class="preprocessor">.getAmount</span>())<span class="comment">;// 余量</span>
        historyDao<span class="preprocessor">.save</span>(history)<span class="comment">;</span>
    }
}
</pre></td></tr></table></figure>

<h2 id="-">货物名自动补全</h2>
<p>使用 Jquery UI 库完成</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="code"><pre><span class="comment">// 静态, 一次性查询所有货物</span>
$(<span class="string">"input[name='name']"</span>).autocomplete({
    source: []
});
<span class="comment">// 动态, 根据用户当前输入, 自动补全</span>
$(<span class="string">"input[name='name']"</span>).autocomplete({
    source: <span class="function"><span class="keyword">function</span><span class="params">(request, response)</span> {</span>
        <span class="comment">// 获取用户当前输入的字符</span>
        <span class="keyword">var</span> term = request.term;
        $.post(<span class="string">"goods_findNameLick"</span>, {name: term}, <span class="function"><span class="keyword">function</span><span class="params">(data)</span>{</span>
            <span class="comment">// 回显数据</span>
            response(data);
        })
    },
    <span class="comment">// 选择补全列表回显 </span>
    select: <span class="function"><span class="keyword">function</span><span class="params">(event, ui)</span>{</span>
        <span class="comment">// ui.item可以是 source 绑定数组的某个元素</span>
        <span class="comment">// ui.item.value 返回选中值</span>
        <span class="comment">// TODO 进行回显</span>
    }
});
</pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="code"><pre><span class="comment">// GoodsAction</span>
<span class="keyword">public</span> String <span class="title">findNameLike</span>(){
    goodsService.findNameLike(name);
    <span class="keyword">return</span> <span class="string">"findNameLickSuccess"</span>; <span class="comment">// type json</span>
}

<span class="comment">// GoodsDao</span>
<span class="keyword">public</span> List&lt;Goods&gt; <span class="title">findNameLike</span>(){
    String hql = <span class="string">"from Goods where name lick ?"</span>;
    <span class="keyword">return</span> template.findQuery(hql, <span class="string">"%"</span> + hql + <span class="string">"%"</span>).list();
}

<span class="comment">// Goods</span>
<span class="keyword">public</span> String <span class="title">getValue</span>(){
    <span class="keyword">return</span> name;
}
</pre></td></tr></table></figure>

<h1 id="-">多条件组合分页查询</h1>
<ol>
<li>修改库存管理的查询表单</li>
</ol>
<h2 id="-">服务器完成分页条件查询</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
</pre></td><td class="code"><pre><span class="comment">// Pagination</span>
package page
<span class="keyword">public</span> <span class="keyword">class</span> Pagination{
    <span class="keyword">private</span> <span class="keyword">int</span> pageno; <span class="comment">// 页码</span>
    <span class="keyword">private</span> <span class="keyword">int</span> numberPerPage = <span class="number">10</span>; <span class="comment">// 每页记录条数</span>

    <span class="keyword">private</span> Map parameterMap;<span class="comment">// request 提供的方法</span>

    <span class="comment">// 结果显示数据</span>
    <span class="keyword">private</span> <span class="keyword">long</span> totalCount; <span class="comment"><span class="xmlDocTag">///</span> 总记录数</span>
    <span class="keyword">private</span> <span class="keyword">int</span> totalPageCount; <span class="comment">//总页数</span>

    privaate List data; <span class="comment">// 当前显示数据</span>

    <span class="keyword">public</span> Strinig <span class="title">getParamUrl</span>(){
        <span class="keyword">for</span>(Entry&lt;String, String[]&gt; entry : parameterMap.entrySet()){
             <span class="comment">// TODO </span>
        }
    }
}

<span class="comment">// option value= 请选择</span>
<span class="comment">// GoodAction</span>
<span class="keyword">public</span> String <span class="title">pageQuery</span>(){
     Pagination pagination = <span class="keyword">new</span> Pagination();
     <span class="keyword">if</span>(req.getParameter(<span class="string">"pageno"</span>) == <span class="keyword">null</span>) {
         pagination.setPageno(<span class="number">1</span>);
     } <span class="keyword">else</span> {
         pagination.setPageinfo(Integer.parseInt(req.getParameter(<span class="string">"pageno"</span>)));
     }
     pagination.setParameterMap(req.getParameterMap());
     goodsService.findPageData(pagination);
     <span class="keyword">return</span> <span class="string">"pageQuerySuccess"</span>;
}

<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findPageData</span>(Pagination pagination){
    Map pMap = pagination.getParameterMap();
    DetachedCriteria detachedCriteria = DetachedCriteria.forClass(Goods.class);

    <span class="comment">// QBC 单表条件 TODO, pmap.get()[0], 可能会报错</span>
    <span class="keyword">if</span>(StringUtis.isNotBlank(pMap.<span class="keyword">get</span>(<span class="string">"nm"</span>)[<span class="number">0</span>])) {
        detachedCriteria.add(Restriction.eq(<span class="string">"nm"</span>, pMap.<span class="keyword">get</span>(<span class="string">"nm"</span>)));
    }
    <span class="keyword">if</span>(StringUtis.isNotBlank(pMap.<span class="keyword">get</span>(<span class="string">"name"</span>))) {
        detachedCriteria.add(Restriction.lick(<span class="string">"name"</span>, <span class="string">"%"</span> + pMap.<span class="keyword">get</span>(<span class="string">"name"</span>)) + <span class="string">"%"</span>);
    }
    
    <span class="keyword">if</span>(StringUtis.isNotBlank(pMap.<span class="keyword">get</span>(<span class="string">"store.id"</span>))) {
        Store s = <span class="keyword">new</span> Store();
        store.setId(pMap.<span class="keyword">get</span>(<span class="string">"store.id"</span>));
        detachedCriteria.add(Restriction.eq(<span class="string">"store"</span>, store);
    }
    <span class="comment">// 设置投影, select count(*)</span>
    detachedCriteria.setProjection(Projections.rowCount()); 
    Long count = goodsDao.findTotalCount(detachedCriteria);
    pagination.setTotalCount(totalCount);

    <span class="keyword">int</span> totalPageCount = (totalCount + pagination.getNumberPerPage()-<span class="number">1</span>) / pagination.getNumberPerpage();
    
    <span class="comment">// 分页代码查询</span>
    <span class="keyword">int</span> firstResult = (paination.getPageno()-<span class="number">1</span>)*pagination.getNumberPerpate();
    <span class="keyword">int</span> maxResults = pagination.getNumberPerpage();
    
    <span class="comment">// 清除投影效果</span>
    detachedCriteria.setProjection(<span class="keyword">null</span>); 
    List&lt;Goods&gt; goodses = goodsDao.findPageData(detachedCriteria, firstResult, maxResult )
    pagination.setData(goods);
}
<span class="comment">// GoodsDao</span>
<span class="keyword">public</span> <span class="keyword">long</span> <span class="title">findTotalCount</span>(DetachedCriteria criteria){
    <span class="keyword">return</span> template.findByCriteria(criteria).<span class="keyword">get</span>(<span class="number">0</span>);
}
</pre></td></tr></table></figure>

<h1 id="get-">Get编码过滤器</h1>
<p>TODO</p>
<p>问题: 如果开发需要在url中拼接中文, 手动对url编码</p>
<ol>
<li><code>response.encodeUrl()</code></li>
<li><code>c:url</code> 在页面中对url编码</li>
<li><code>UrlEncoder.encode(paramValue)</code></li>
</ol>
<h1 id="-">自定义标签(分页工具)</h1>
<p>自定义标签最常见应用: 权限控制(控制按钮没有权限不显示), 分页工具条</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="code"><pre><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PaginationTag</span> <span class="keyword">extends</span> <span class="title">SimpleTagSuppport</span>{</span>
    <span class="keyword">private</span> <span class="keyword">int</span> pageno; <span class="comment">// 当前页码</span>
    <span class="keyword">private</span> <span class="keyword">long</span> totalCoiunt; <span class="comment">// 总记录上</span>
    <span class="keyword">private</span> <span class="keyword">int</span> numberPerpage; <span class="comment">// 每页记录数</span>
    <span class="keyword">private</span> String paramUrl; .<span class="comment">// 查询条件的参数url</span>
    
    <span class="annotation">@Override</span> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doTag</span>() {
        JspWriter out = getJspContext().getOut();
        <span class="comment">// 生成div输出分页工具条</span>
        out.write(<span class="string">"&lt;a href=&gt;"</span> + request.getContextPath() + <span class="string">"div"</span>);
        
        <span class="comment">// 输出页码, 总记录数, 没页记录数</span>
        <span class="comment">// TODO</span>
        <span class="comment">// 以上太麻烦, 可以用freemark</span>
    }
}
</pre></td></tr></table></figure>

<h1 id="-">历史记录查询</h1>
<p>查询条件来自 goods 表字段, 查询结果来自 history表字段</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
</pre></td><td class="code"><pre><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HistoryAction</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span> <span class="keyword">implements</span> <span class="title">ModelDriven</span> {</span>
    <span class="keyword">private</span> History history = <span class="keyword">new</span> History();
    <span class="keyword">private</span> HistoryService historyService;
    
    <span class="keyword">public</span> String <span class="title">pageQuery</span>(){
        <span class="comment">// 根据请求的参数, 封装 pagination</span>
        Pagination pagination = <span class="keyword">new</span> Pagination();
        String pageno = ServletActionContext.getRequest().getParameter(<span class="string">"pageno"</span>);
        <span class="keyword">if</span>(pageno==<span class="keyword">null</span>){
            pagination.setPageno(<span class="number">1</span>);
        } <span class="keyword">else</span> {
            pagination.setPageno(Integer.parseInt(pageno));
        }
        <span class="comment">// 参数</span>
        pagination.setParameterMap(SevletActionContext.getRequest().getParameterMap());
        historyService..findPageData(pagination);
        <span class="keyword">return</span> <span class="string">"pageQeurySuccess"</span>;
    }
}

<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HistoryServiceImpl</span> <span class="keyword">implements</span> <span class="title">HistoryService</span>{</span>
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findPageData</span>(Pagination pagination){
        <span class="comment">// 将参数转换为 查询 sql, 使用QBC</span>
        Map&lt;String, String[]&gt; parameterMap = pagination.getParameterMap();
        DetachedCriteria detachedCriteria = DetachedCriteria.forClass(History.class);
        <span class="comment">// 添加条件</span>
        <span class="comment">// 如果查询根对象和查询条件位于同一张表中, 单表查询</span>
        <span class="comment">// 跟对象history ,条件goods --- 多表查询</span>
        String nm = getValueFromMap(parameterMap, <span class="string">"goods.nm"</span>);
        String name = getValueFromMap(parameterMap, <span class="string">"goods.name"</span>);
        String storeid = getValueFromMap(parameterMap, <span class="string">"goods.store.id"</span>);

        <span class="comment">// 多表查询</span>
        detachedCriteria.createAlias(<span class="string">"goods"</span>, <span class="string">"g"</span>, Criteria.INNER_JOIN);
        <span class="comment">// 三表关联 detachedCriteria.createAlias("g.store", "s", Criteria.INNER_JOIN);</span>
        
        <span class="keyword">if</span>(String Utils.isNotBlank(nm)) {
            <span class="comment">// 根据货物的简记码查询</span>
            detachedCriteria.add(Restriction.eq(<span class="string">"g.nm"</span>, nm));
        }
        <span class="keyword">if</span>(String Utils.isNotBlank(name)) {
            detachedCriteria.add(Restriction.like(<span class="string">"g.name"</span>, <span class="string">"%"</span>+ name + <span class="string">"%"</span>));
        }
        <span class="keyword">if</span>(String Utils.isNotBlank(name)) {
            Store store = <span class="keyword">new</span> Store();
            detachedCriteria.add(Restriction.eq(<span class="string">"g.store"</span>, store));
        }
        detachedCriteria.setProjection(Projections.rowCount());
        <span class="keyword">long</span> totalCount = historyDao.findTotalCount(detachedCriteria);
        pagination.setTotalCount(totalcount);

        <span class="keyword">int</span> totalPageCount = TODO;
        pagination.setTotalPageCount();
        <span class="comment">// 参照上一次分页代码</span>
        
        <span class="comment">//多表关联和投影查询, 返回两个对象的数组</span>
        <span class="comment">// 投影改变结果策略, 不再将结果封装到Root数组, 而是根据查询数据类型进行返回</span>
        detachedCriteria.setProjection(<span class="keyword">null</span>); <span class="comment">// 清除了投影, 也重置了封装策略</span>
        <span class="comment">// 恢复封装策略</span>
        <span class="comment">// AliaToBeanResultTransformer, 组装非 bean 对象</span>
        detachedCriteria.setResultTransformer(Criteria.ROOT_ENTITY);
    }
}

<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HistoryDaoImpl</span> <span class="keyword">implements</span> <span class="title">HistoryDao</span> {</span>
    <span class="comment">// TODO</span>
}
</pre></td></tr></table></figure>

<h1 id="paginationtag-freemarker-">paginationTag的freemarker重构</h1>
<p>在标签类中输出HTML十分不方便</p>
<p>freemarker: 基于模板, 用来生成输出文本的通用工具</p>
<p>原理: ftl模板文件 + 动态数据 = 输出(通常是 html 访问文件)</p>
<p>应用: 页面静态化</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td><td class="code"><pre><span class="xml"><span class="tag">&lt;<span class="title">#--</span> 这是注释 <span class="attribute">--</span>&gt;</span>
<span class="tag">&lt;<span class="title">html</span>&gt;</span>${title}<span class="tag">&lt;/<span class="title">html</span>&gt;</span> <span class="comment">&lt;!-- 变量 --&gt;</span>
${title ! 默认值}
<span class="tag">&lt;<span class="title">#user</span> ??&gt;</span> 判断是否存在
<span class="tag">&lt;<span class="title">#list</span>&gt;</span>               <span class="comment">&lt;!-- ftl指令 --&gt;</span>

<span class="comment">&lt;!-- if指令 --&gt;</span>
<span class="tag">&lt;<span class="title">#if</span> <span class="attribute">animals.python</span> &lt; <span class="attribute">100</span>&gt;</span>
    大于
<span class="tag">&lt;<span class="title">#else</span>&gt;</span>
    小于
<span class="tag">&lt;/<span class="title">#if</span>&gt;</span>

<span class="comment">&lt;!-- list指令 --&gt;</span>
<span class="tag">&lt;<span class="title">#list</span> <span class="attribute">as</span> <span class="attribute">being</span>&gt;</span>
   输出${being.price}
<span class="tag">&lt;/<span class="title">#list</span>&gt;</span>

<span class="comment">&lt;!-- 页面包含 --&gt;</span>
<span class="tag">&lt;<span class="title">#inlcude</span> "/<span class="attribute">a.html</span>"&gt;</span>

<span class="comment">&lt;!-- 内置函数 --&gt;</span>
${test?html} <span class="comment">&lt;!-- 转义 --&gt;</span>
${test?cap_first} <span class="comment">&lt;!-- 第一个字母大写 --&gt;</span>
${test?lower_case}
${test?size}</span>
</pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
</pre></td><td class="code"><pre><span class="keyword">Configuration</span> conf = <span class="keyword">new</span> <span class="keyword">Configuration</span>();
conf.setDirectoryForTemplateLoading(<span class="keyword">new</span> <span class="keyword">File</span>(<span class="string">"模板文件文件夹"</span>));

Template tmp = conf.getTemplate(<span class="string">"flt文件名"</span>);
<span class="keyword">Map</span>&lt;<span class="typename">String</span>, <span class="typename">String</span>&gt; dataMap = <span class="keyword">new</span> HashMap&lt;<span class="typename">String</span>, <span class="typename">String</span>&gt;();
dataMap.put(<span class="string">"title"</span>, <span class="string">"freemarker入门"</span>);

tmp.<span class="keyword">process</span>(<span class="keyword">map</span>, <span class="keyword">new</span> PrintWriter(System.<span class="keyword">out</span>));
</pre></td></tr></table></figure>

  
	</div>
		<footer class="article-footer clearfix">

  <div class="article-tags">
  
  <span></span> <a href="/tags/传智播客/">传智播客</a>
  </div>




<div class="article-share" id="share">

  <div data-url="http://zhpooer.github.io/2014/06/03/传智播客day43-ssh综合练习/" data-title="传智播客day43-ssh综合练习 仓库管理系统 | Poe&#39;s World" data-tsina="null" class="share clearfix">
  </div>

</div>
</footer>   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2014/06/08/scala-thoughtworks培训/" title="scala thoughtworks培训">
  <strong>PREVIOUS:</strong><br/>
  <span>
  scala thoughtworks培训</span>
</a>
</div>


<div class="next">
<a href="/2014/05/29/传智播客day42-spring-事务管理/"  title="传智播客day42-Spring 事务管理">
 <strong>NEXT:</strong><br/> 
 <span>传智播客day42-Spring 事务管理
</span>
</a>
</div>

</nav>

	
<section class="comment">
	<div class="ds-thread"></div>
</section>

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
  <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#-"><span class="toc-number">1.</span> <span class="toc-text">仓库管理系统的分析</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-"><span class="toc-number">2.</span> <span class="toc-text">项目开发流程</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-"><span class="toc-number">3.</span> <span class="toc-text">数据库建模</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-"><span class="toc-number">4.</span> <span class="toc-text">登陆页面</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-"><span class="toc-number">4.1.</span> <span class="toc-text">业务层</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#-"><span class="toc-number">5.</span> <span class="toc-text">添加仓库</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-"><span class="toc-number">6.</span> <span class="toc-text">仓库列表查询</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-"><span class="toc-number">7.</span> <span class="toc-text">仓库删除和仓库修改</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-"><span class="toc-number">8.</span> <span class="toc-text">窗口嵌套</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-"><span class="toc-number">9.</span> <span class="toc-text">货物入库操作</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-"><span class="toc-number">9.1.</span> <span class="toc-text">仓库下拉列表的制作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-"><span class="toc-number">9.2.</span> <span class="toc-text">仓库列表缓存使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-"><span class="toc-number">9.3.</span> <span class="toc-text">简记码的数据回显</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-"><span class="toc-number">9.4.</span> <span class="toc-text">入库操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-"><span class="toc-number">9.5.</span> <span class="toc-text">货物名自动补全</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#-"><span class="toc-number">10.</span> <span class="toc-text">多条件组合分页查询</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-"><span class="toc-number">10.1.</span> <span class="toc-text">服务器完成分页条件查询</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#get-"><span class="toc-number">11.</span> <span class="toc-text">Get编码过滤器</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-"><span class="toc-number">12.</span> <span class="toc-text">自定义标签(分页工具)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-"><span class="toc-number">13.</span> <span class="toc-text">历史记录查询</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#paginationtag-freemarker-"><span class="toc-number">14.</span> <span class="toc-text">paginationTag的freemarker重构</span></a></li></ol>
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  

  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			<li><a href="/tags/AJAX/" title="AJAX">AJAX<sup>1</sup></a></li>
		
			<li><a href="/tags/Akka/" title="Akka">Akka<sup>1</sup></a></li>
		
			<li><a href="/tags/DOM/" title="DOM">DOM<sup>2</sup></a></li>
		
			<li><a href="/tags/EL表达式/" title="EL表达式">EL表达式<sup>1</sup></a></li>
		
			<li><a href="/tags/Hadoop/" title="Hadoop">Hadoop<sup>1</sup></a></li>
		
			<li><a href="/tags/Hibernate/" title="Hibernate">Hibernate<sup>2</sup></a></li>
		
			<li><a href="/tags/HttpSession/" title="HttpSession">HttpSession<sup>1</sup></a></li>
		
			<li><a href="/tags/IO/" title="IO">IO<sup>1</sup></a></li>
		
			<li><a href="/tags/JSP/" title="JSP">JSP<sup>1</sup></a></li>
		
			<li><a href="/tags/JavaBean/" title="JavaBean">JavaBean<sup>1</sup></a></li>
		
			<li><a href="/tags/JavaScript/" title="JavaScript">JavaScript<sup>1</sup></a></li>
		
			<li><a href="/tags/Mybatis/" title="Mybatis">Mybatis<sup>1</sup></a></li>
		
			<li><a href="/tags/NoSql/" title="NoSql">NoSql<sup>1</sup></a></li>
		
			<li><a href="/tags/SAX/" title="SAX">SAX<sup>1</sup></a></li>
		
			<li><a href="/tags/ServletRequest/" title="ServletRequest">ServletRequest<sup>1</sup></a></li>
		
			<li><a href="/tags/ServletResponse/" title="ServletResponse">ServletResponse<sup>1</sup></a></li>
		
			<li><a href="/tags/Spring/" title="Spring">Spring<sup>1</sup></a></li>
		
			<li><a href="/tags/Spring MVC/" title="Spring MVC">Spring MVC<sup>1</sup></a></li>
		
			<li><a href="/tags/String/" title="String">String<sup>1</sup></a></li>
		
			<li><a href="/tags/StringBuffer/" title="StringBuffer">StringBuffer<sup>1</sup></a></li>
		
		</ul>
</div>


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<div class="social-font" class="clearfix">
		
		
		
		
	</div>
		<p class="copyright">Powered by <a href="http://zespia.tw/hexo/" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/A-limon/pacman" target="_blank" title="Pacman">Pacman</a> © 2014 
		
		<a href="http://zhpooer.github.io" target="_blank" title="zhpooer">zhpooer</a>
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top",Math.max(140,320-$(this).scrollTop()));
    });
  };
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});     
</script>


<script type="text/javascript">
  var duoshuoQuery = {short_name:"zhpoooer"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 





  </body>
</html>
