
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>haskell趣学-构造Type和Typeclass | Poe&#39;s World</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
    
    <meta name="author" content="zhpooer">
    
    <meta name="description" content="使用data关键字定义自己的类型 data Bool = False | True
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
data Shape = Circle Float Float Floa">
    
    
    
    
    <link rel="alternative" href="/atom.xml" title="Poe&#39;s World" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/pacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/pacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

  <body>
    <header>
      <div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.svg" alt="Poe&#39;s World" title="Poe&#39;s World"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Poe&#39;s World">Poe&#39;s World</a></h1>
				<h2 class="blog-motto">竹杖芒鞋轻胜马，一蓑烟雨任平生</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">主页</a></li>
					
						<li><a href="/english-monthly">英语角</a></li>
					
						<li><a href="/about">关于</a></li>
					
						<li><a href="/archives">归档</a></li>
					
					<li>
					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="text" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:zhpooer.github.io">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>

    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2014/06/29/haskell趣学-构造type和typeclass/" title="haskell趣学-构造Type和Typeclass" itemprop="url">haskell趣学-构造Type和Typeclass</a>
  </h1>
  <p class="article-author">By
    
      <a href="http://zhpooer.github.io" title="zhpooer">zhpooer</a>
    </p>
  <p class="article-time">
    <time datetime="2014-06-29T07:02:14.000Z" itemprop="datePublished">6月 29 2014</time>
    更新日期:<time datetime="2014-06-30T07:05:48.000Z" itemprop="dateModified">6月 30 2014</time>
    
  </p>
</header>
	<div class="article-content">
		
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#-"><span class="toc-number">1.</span> <span class="toc-text">类型记录</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-"><span class="toc-number">2.</span> <span class="toc-text">类型参数</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#car-"><span class="toc-number">2.1.</span> <span class="toc-text">Car的案例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#vector-"><span class="toc-number">2.2.</span> <span class="toc-text">Vector(三维矢量)</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#derived-instances"><span class="toc-number">3.</span> <span class="toc-text">Derived instances</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-type-synonyms-"><span class="toc-number">4.</span> <span class="toc-text">类型别名(Type synonyms)</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#either-"><span class="toc-number">4.1.</span> <span class="toc-text">Either 的使用</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#-"><span class="toc-number">5.</span> <span class="toc-text">递归地定义数据结构</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-"><span class="toc-number">5.1.</span> <span class="toc-text">二元搜索树构建</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#typeclass"><span class="toc-number">6.</span> <span class="toc-text">TypeClass</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#yes-no-typeclass"><span class="toc-number">7.</span> <span class="toc-text">yes-no typeclass</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#functor-typeclass"><span class="toc-number">8.</span> <span class="toc-text">Functor typeclass</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#kind"><span class="toc-number">9.</span> <span class="toc-text">Kind</span></a></li></ol>
		</div>
		
		<p>使用<code>data</code>关键字定义自己的类型 <code>data Bool = False | True</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre></td><td class="code"><pre><span class="typedef"><span class="keyword">data</span> <span class="type">Shape</span> = <span class="type">Circle</span> <span class="type">Float</span> <span class="type">Float</span> <span class="type">Float</span> | <span class="type">Retangle</span> <span class="type">Float</span> <span class="type">Float</span> <span class="type">Float</span></span>

<span class="comment">-- 值构造子的本质是个函数，可以返回一个类型的值</span>
<span class="comment">-- class Circle(x:Float, y:Float, radius:Float), 没有变量名吗?</span>
<span class="title">ghci</span>&gt; :t <span class="type">Circle</span> 
<span class="type">Circle</span> :: <span class="type">Float</span> -&gt; <span class="type">Float</span> -&gt; <span class="type">Float</span> -&gt; <span class="type">Shape</span> 
<span class="title">ghci</span>&gt; :t <span class="type">Rectangle</span> 
<span class="type">Rectangle</span> :: <span class="type">Float</span> -&gt; <span class="type">Float</span> -&gt; <span class="type">Float</span> -&gt; <span class="type">Float</span> -&gt; <span class="type">Shape</span>

<span class="title">surface</span> :: <span class="type">Shape</span> -&gt; <span class="type">Float</span> 
<span class="title">surface</span> (<span class="type">Circle</span> _ _ r) = pi * r ^ <span class="number">2</span> 
<span class="title">surface</span> (<span class="type">Rectangle</span> x1 y1 x2 y2) = (abs $ x2 - x1) * (abs $ y2 - y1)


<span class="comment">-- Shape类型成为 Show 类型类的成员</span>
<span class="typedef"><span class="keyword">data</span> <span class="type">Shape</span> = <span class="type">Circle</span> <span class="type">Float</span> <span class="type">Float</span> <span class="type">Float</span> | <span class="type">Retangle</span> <span class="type">Float</span> <span class="type">Float</span> <span class="type">Float</span> <span class="type">Float</span> <span class="keyword">deriving</span> <span class="container">(<span class="type">Show</span>)</span></span>

<span class="comment">-- 获取一组不同半径的同心圆</span>
<span class="title">map</span> (<span class="type">Circle</span> <span class="number">10</span> <span class="number">20</span>) [<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">6</span>]

<span class="comment">-- 增加加一个表示二维空间中点的类型，可以让我们的 Shape 更加容易理解</span>
<span class="typedef"><span class="keyword">data</span> <span class="type">Point</span> = <span class="type">Point</span> <span class="type">Float</span> <span class="type">Float</span> <span class="keyword">deriving</span> <span class="container">(<span class="type">Show</span>)</span></span>
<span class="typedef"><span class="keyword">data</span> <span class="type">Shape</span> = <span class="type">Circle</span> <span class="type">Point</span> <span class="type">Float</span> | <span class="type">Retangle</span> <span class="type">Point</span> <span class="type">Point</span> <span class="keyword">deriving</span> <span class="container">(<span class="type">Show</span>)</span></span>

<span class="title">surface</span> :: <span class="type">Shape</span> -&gt; <span class="type">Float</span>
<span class="title">surface</span> (<span class="type">Circle</span> _ r) = pi * r^<span class="number">2</span>
<span class="title">surface</span> (<span class="type">Retangle</span> (<span class="type">Point</span> x1 y1) (<span class="type">Point</span> x2 y2)) = (abs $ x2 - x1) * (abs $ y2 - y1)
</pre></td></tr></table></figure>

<h1 id="-">类型记录</h1>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="code"><pre><span class="typedef"><span class="keyword">data</span> <span class="type">Person</span> = <span class="type">Person</span> <span class="container">{
      <span class="title">firstName</span> :: <span class="type">String</span>
    , <span class="title">lastName</span> :: <span class="type">String</span>
    , <span class="title">age</span> :: <span class="type">Int</span>
    , <span class="title">height</span> :: <span class="type">Float</span>
    , <span class="title">phoneNumber</span> :: <span class="type">String</span>
    , <span class="title">flavor</span> :: <span class="type">String</span>
}</span> <span class="keyword">deriving</span> <span class="container">(<span class="type">Show</span>)</span></span>

<span class="title">ghci</span>&gt; :t flavor 
<span class="title">flavor</span> :: <span class="type">Person</span> -&gt; <span class="type">String</span> 
<span class="title">ghci</span>&gt; :t firstName 
<span class="title">firstName</span> :: <span class="type">Person</span> -&gt; <span class="type">String</span>
</pre></td></tr></table></figure>

<h1 id="-">类型参数</h1>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="code"><pre>-- <span class="literal">a</span> 相当于 泛型
data Maybe <span class="literal">a</span> = Nothing | Just <span class="literal">a</span>

ghci&gt; Just <span class="string">"Haha"</span> 
Just <span class="string">"Haha"</span> 
ghci&gt; Just <span class="number">84</span> 
Just <span class="number">84</span> 
<span class="label">ghci&gt; :</span>t Just <span class="string">"Haha"</span> 
Just <span class="string">"Haha"</span> :: Maybe [Char] 
<span class="label">ghci&gt; :</span>t Just <span class="number">84</span> 
<span class="label">Just 84 ::</span> (Num t) =&gt; Maybe t 
<span class="label">ghci&gt; :</span>t Nothing 
<span class="label">Nothing ::</span> Maybe <span class="literal">a</span>
</pre></td></tr></table></figure>

<h2 id="car-">Car的案例</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="code"><pre><span class="typedef"><span class="keyword">data</span> <span class="type">Car</span> = <span class="type">Car</span> <span class="container">{ <span class="title">company</span> :: <span class="type">String</span> 
                 , <span class="title">model</span> :: <span class="type">String</span> 
                 , <span class="title">year</span> :: <span class="type">Int</span> 
                 }</span> <span class="keyword">deriving</span> <span class="container">(<span class="type">Show</span>)</span></span>
<span class="comment">-- 也可以改为这样, 但是可能没有用处</span>
<span class="typedef"><span class="keyword">data</span> <span class="type">Car</span> a b c = <span class="type">Car</span> <span class="container">{ <span class="title">company</span> :: <span class="title">a</span> 
                       , <span class="title">model</span> :: <span class="title">b</span> 
                       , <span class="title">year</span> :: <span class="title">c</span> 
                        }</span> <span class="keyword">deriving</span> <span class="container">(<span class="type">Show</span>)</span></span>

<span class="title">tellCar</span> :: <span class="type">Car</span> -&gt; <span class="type">String</span> 
<span class="title">tellCar</span> (<span class="type">Car</span> {company = c, model = m, year = y}) = <span class="string">"This "</span> ++ c ++ <span class="string">" "</span> ++ m ++ <span class="string">" was made in "</span> ++ show y
</pre></td></tr></table></figure>

<h2 id="vector-">Vector(三维矢量)</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre><span class="typedef"><span class="keyword">data</span> <span class="type">Vecotr</span> a = <span class="type">Vector</span> a a a <span class="keyword">deriving</span> <span class="container">(<span class="type">Show</span>)</span></span>
<span class="title">vplus</span> :: (<span class="type">Num</span> t) =&gt; <span class="type">Vector</span> t -&gt; <span class="type">Vector</span> t -&gt; <span class="type">Vector</span> t
(<span class="type">Vector</span> i j k) `vplus` (<span class="type">Vector</span> l m n) = <span class="type">Vector</span> (i+l) (j+m) (k+n)
</pre></td></tr></table></figure>

<h1 id="derived-instances">Derived instances</h1>
<p><code>TypeClass</code>, 在 Java, C++ 等语言中, 类就像是蓝图,
我们可以根据它来创造对象保存对象并执行操作.
<code>TypeClass</code> 更像是接口, 我们不是靠它构造数据，而是给既有的数据类型描述行为.</p>
<p>什么东西若可以判定相等性，我们就可以让它成为 Eq 类型类的 instance。什么东西若可以比较大小，
那就可以让它成为 Ord 类型类的 instance。</p>
<p>在一个类型 derive 为 Eq 的 instance 后，
就可以直接使用 == 或 /= 来判断它们的相等性了。
Haskell 会先看下这两个值的值构造子是否一致(这里只是单值构造子)，
再用 == 来检查其中的所有数据(必须都是 Eq 的成员)是否一致。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td><td class="code"><pre><span class="typedef"><span class="keyword">data</span> <span class="type">Person</span> = <span class="type">Person</span> <span class="container">{ <span class="title">firstName</span> :: <span class="type">String</span> 
                     , <span class="title">lastName</span> :: <span class="type">String</span> 
                     , <span class="title">age</span> :: <span class="type">Int</span> 
                     }</span> <span class="keyword">deriving</span> <span class="container">(<span class="type">Eq</span>, <span class="type">Show</span>, <span class="type">Read</span>)</span></span>

<span class="title">ghci</span>&gt; read <span class="string">"Person {firstName =\"Michael\", lastName =\"Diamond\", age = 43}"</span> :: <span class="type">Person</span>
<span class="comment">-- 如果我们 read 的结果会在后面用到参与计算，</span>
<span class="comment">-- Haskell 就可以推导出是一个 Person 的行为，不加注释也是可以的</span>
<span class="title">ghci</span>&gt; read <span class="string">"Person {firstName =\"Michael\", lastName =\"Diamond\", age = 43}"</span> == mikeD
<span class="type">True</span>

<span class="title">ghci</span>&gt; <span class="type">Nothing</span> 
<span class="type">True</span> 
<span class="title">ghci</span>&gt; <span class="type">Nothing</span> &gt; <span class="type">Just</span> (-<span class="number">49999</span>) 
<span class="type">False</span> 
<span class="title">ghci</span>&gt; <span class="type">Just</span> <span class="number">100</span> &gt; <span class="type">Just</span> <span class="number">50</span> 
<span class="type">True</span>

<span class="comment">-- 使用 Enmu 和 Bounded 类型类, 做枚举</span>
<span class="typedef"><span class="keyword">data</span> <span class="type">Day</span> = <span class="type">Monday</span> | <span class="type">Tuesday</span> | <span class="type">Wednesday</span> | <span class="type">Thursday</span> | <span class="type">Friday</span> | <span class="type">Saturday</span> | <span class="type">Sunday</span></span>
           <span class="keyword">deriving</span> (<span class="type">Eq</span>, <span class="type">Ord</span>, <span class="type">Show</span>, <span class="type">Read</span>, <span class="type">Bounded</span>, <span class="type">Enum</span>)

<span class="title">ghci</span>&gt; minBound :: <span class="type">Day</span> 
<span class="type">Monday</span> 
<span class="title">ghci</span>&gt; maxBound :: <span class="type">Day</span> 
<span class="type">Sunday</span>
</pre></td></tr></table></figure>

<h1 id="-type-synonyms-">类型别名(Type synonyms)</h1>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="code"><pre><span class="typedef"><span class="keyword">type</span> <span class="type">String</span> = [<span class="type">Char</span>]</span>
<span class="title">toUpperString</span> :: [<span class="type">Char</span>] -&gt; [<span class="type">Char</span>]
<span class="comment">-- 等同于</span>
<span class="title">toUpperString</span> :: <span class="type">String</span> -&gt; <span class="type">String</span>

<span class="typedef"><span class="keyword">type</span> <span class="type">PhoneNumber</span> = <span class="type">String</span> </span>
<span class="typedef"><span class="keyword">type</span> <span class="type">Name</span> = <span class="type">String</span> </span>
<span class="typedef"><span class="keyword">type</span> <span class="type">PhoneBook</span> = [<span class="container">(<span class="type">Name</span>,<span class="type">PhoneNumber</span>)</span>]</span>
<span class="comment">-- 可以这样使用, 更加易读</span>
<span class="title">inPhoneBook</span> :: <span class="type">Name</span> -&gt; <span class="type">PhoneNumber</span> -&gt; <span class="type">PhoneBook</span> -&gt; <span class="type">Bool</span> 
<span class="title">inPhoneBook</span> name pnumber pbook = (name,pnumber) `elem` pbook

<span class="comment">-- 类型别名的参数, 相当于泛型(类型构造子)</span>
<span class="typedef"><span class="keyword">type</span> <span class="type">AssocList</span> k v = [<span class="container">(<span class="title">k</span>, <span class="title">v</span>)</span>]</span>

<span class="type">AssocList</span> [(<span class="number">1</span>,<span class="number">2</span>),(<span class="number">4</span>,<span class="number">5</span>),(<span class="number">7</span>,<span class="number">9</span>)]   <span class="comment">-- 不能这么用</span>
[(<span class="number">1</span>,<span class="number">2</span>),(<span class="number">4</span>,<span class="number">5</span>),(<span class="number">7</span>,<span class="number">9</span>)] :: <span class="type">AssocList</span> <span class="type">Int</span> <span class="type">Int</span>  <span class="comment">-- 正确使用方法</span>

<span class="comment">-- 他有两个值构造子 Left 和 Right, 类型构造子是 Either</span>
<span class="typedef"><span class="keyword">data</span> <span class="type">Either</span> a b = <span class="type">Left</span> a | <span class="type">Right</span> b <span class="keyword">deriving</span> <span class="container">(<span class="type">Eq</span>, <span class="type">Ord</span>, <span class="type">Read</span>, <span class="type">Show</span>)</span></span>
</pre></td></tr></table></figure>

<h2 id="either-">Either 的使用</h2>
<p>学生向管理员索取储物箱, 保存物品, 每个储物箱都要密码.
如果学生想要用, 就要告诉管理员储物柜的号码.
如果已经被别人用了, 管理员就不能告诉它密码, 得换一个储物箱.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="code"><pre><span class="import"><span class="keyword">import</span> <span class="keyword">qualified</span> Data.Map <span class="keyword">as</span> Map</span>

<span class="typedef"><span class="keyword">data</span> <span class="type">LockerState</span> = <span class="type">Taken</span> | <span class="type">Free</span> <span class="keyword">deriving</span> <span class="container">(<span class="type">Show</span>, <span class="type">Eq</span>)</span></span>
<span class="typedef"><span class="keyword">type</span> <span class="type">Code</span> = <span class="type">String</span></span>
<span class="typedef"><span class="keyword">type</span> <span class="type">LockerMap</span> = <span class="type">Map</span>.<span class="type">Map</span> <span class="type">Int</span> <span class="container">(<span class="type">LockerState</span>, <span class="type">Code</span>)</span></span>

<span class="title">lockerLookup</span> :: <span class="type">Int</span> -&gt; <span class="type">LockerMap</span> -&gt; <span class="type">Either</span> <span class="type">String</span> <span class="type">Code</span>
<span class="title">lockerLookup</span> lockerNumber map =
     <span class="keyword">case</span> <span class="type">Map</span>.lookup lockerNumber map <span class="keyword">of</span>
         <span class="type">Nothing</span> -&gt; <span class="type">Left</span> $ <span class="string">"Locker number"</span> ++ show lockerNumber ++ <span class="string">"doesn't exist!"</span>
         <span class="type">Just</span> (state, code) -&gt; <span class="keyword">if</span> state /= <span class="type">Taken</span>
                                <span class="keyword">then</span> <span class="type">Right</span> code
                                <span class="keyword">else</span> <span class="type">Left</span> $ <span class="string">"Locker"</span> ++ show lockerNumber ++ <span class="string">" is already taken"</span>

<span class="comment">-- 我们完全可以用 Maybe a 来表示它的结果，但这样一来我们就对得不到密码的原因不得而知了。</span>
<span class="comment">-- 而在这里，我们的新类型可以告诉我们失败的原因。</span>
</pre></td></tr></table></figure>

<h1 id="-">递归地定义数据结构</h1>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="code"><pre><span class="label">-- cons 其实就是指 `:<span class="escape">`
</span></span>ghci&gt; Empty 
Empty 
ghci&gt; <span class="number">5</span> <span class="escape">`C</span>ons<span class="escape">` </span>Empty 
Cons <span class="number">5</span> Empty 
ghci&gt; <span class="number">4</span> <span class="escape">`C</span>ons<span class="escape">` </span>(<span class="number">5</span> <span class="escape">`C</span>ons<span class="escape">` </span>Empty) 
Cons <span class="number">4</span> (Cons <span class="number">5</span> Empty) 
ghci&gt; <span class="number">3</span> <span class="escape">`C</span>ons<span class="escape">` </span>(<span class="number">4</span> <span class="escape">`C</span>ons<span class="escape">` </span>(<span class="number">5</span> <span class="escape">`C</span>ons<span class="escape">` </span>Empty)) 
Cons <span class="number">3</span> (Cons <span class="number">4</span> (Cons <span class="number">5</span> Empty))

-- 定义List
data List <span class="literal">a</span> = Empty | Cons <span class="literal">a</span> (List <span class="literal">a</span>) deriving (Show, Read, Eq, Ord)
</pre></td></tr></table></figure>

<p><code>infixr</code>, <code>infixl</code> 优先级设置(左结合, 右结合)</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre><span class="comment">-- 代表左结合</span>
<span class="comment">-- (4 * 3 * 2) 等于 ((4 * 3) * 2)。</span>
<span class="comment">-- * 拥有比 + 更高的优先级。所以 5 * 4 + 3 会是 (5 * 4) + 3。</span>
<span class="infix"><span class="keyword">infixl</span> <span class="number">7</span> *</span>
<span class="infix"><span class="keyword">infixl</span> <span class="number">6</span> +</span>
</pre></td></tr></table></figure>

<h2 id="-">二元搜索树构建</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="code"><pre>data Tree <span class="operator">a</span> = EmptyTree | Node <span class="operator">a</span> (Tree <span class="operator">a</span>) (Tree <span class="operator">a</span>) deriving (Show, Read, Eq)

<span class="comment">-- 定义单节点树</span>
single :: <span class="operator">a</span> -&gt; Tree <span class="operator">a</span>
singleton x = Node x EmptyTree EmptyTree
<span class="comment">-- 插入</span>
treeInsert :: (Ord <span class="operator">a</span>) =&gt; <span class="operator">a</span> -&gt; Tree <span class="operator">a</span> -&gt; Tree <span class="operator">a</span>
treeInsert x EmptyTree = singleton x
treeInsert x (Node x left <span class="constant">right</span>)
    | x == <span class="operator">a</span> = Node x left <span class="constant">right</span>
    | x &lt; <span class="operator">a</span> = Node <span class="operator">a</span> (treeInsert x left) <span class="constant">right</span>
    | x &gt; <span class="operator">a</span> = Node <span class="operator">a</span> left (treeInsert x <span class="constant">right</span>)

<span class="comment">-- 查找</span>
treeElem :: (Ord <span class="operator">a</span>) =&gt; <span class="operator">a</span> -&gt; Tree <span class="operator">a</span> -&gt; Bool 
treeElem x EmptyTree = False 
treeElem x (Node <span class="operator">a</span> left <span class="constant">right</span>) 
    | x == <span class="operator">a</span> = True 
    | x &lt; <span class="operator">a</span>  = treeElem x left 
    | x &gt; <span class="operator">a</span>  = treeElem x <span class="constant">right</span>
</pre></td></tr></table></figure>

<h1 id="typeclass">TypeClass</h1>
<p>ypeclass 就像是 interface。
一个 typeclass 定义了一些行为(像是比较相不相等，
比较大小顺序，能否穷举)
而我们会把希望满足这些性质的类型定义成这些 typeclass 的 instance。
typeclass 的行为是由定义的函数来描述。并写出对应的实作。
当我们把一个类型定义成某个 typeclass 的 instance，
就表示我们可以对那个类型使用 typeclass 中定义的函数。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre></td><td class="code"><pre><span class="comment">-- Prelude 中 Eq 如何被定义</span>
<span class="class"><span class="keyword">class</span> <span class="type">Eq</span> a <span class="keyword">where</span></span>
   (==) :: a -&gt; a -&gt; <span class="type">Bool</span>
   (/=) :: a -&gt; a -&gt; <span class="type">Bool</span>
   x == y = not (x /= y)
   x /= y = not (x == y)


<span class="typedef"><span class="keyword">data</span> <span class="type">TrafficLight</span> = <span class="type">Red</span> | <span class="type">Yellow</span> | <span class="type">Green</span></span>
<span class="comment">-- 可以透过 derive 让他成为 Eq 的instance</span>
<span class="comment">-- 手动编写</span>
<span class="class">
<span class="keyword">instance</span> <span class="type">Eq</span> <span class="type">TrafficLight</span> <span class="keyword">where</span></span>
    <span class="type">Red</span> == <span class="type">Red</span> = <span class="type">True</span>
    <span class="type">Green</span> == <span class="type">Green</span> = <span class="type">True</span>
    <span class="type">Yellow</span> == <span class="type">Yellow</span> = <span class="type">True</span>
    _ == _ = <span class="type">False</span>
<span class="class">
<span class="keyword">instance</span> <span class="type">Show</span> <span class="type">TrafficLight</span> <span class="keyword">where</span></span> 
    show <span class="type">Red</span> = <span class="string">"Red light"</span> 
    show <span class="type">Yellow</span> = <span class="string">"Yellow light"</span> 
    show <span class="type">Green</span> = <span class="string">"Green light"</span>

<span class="comment">-- 类型约束, 定义一个类型为 Num 之前，必须先为他定义 Eq 的 instance</span>
<span class="class"><span class="keyword">class</span> <span class="container">(<span class="type">Eq</span> <span class="title">a</span>)</span> =&gt; <span class="type">Num</span> a <span class="keyword">where</span></span>

<span class="comment">-- instance Eq Maybe where, 错误用法</span>
<span class="comment">-- 是不是可以理解为类型 (Maybe a) 才是一个完整的类型</span>
<span class="class"><span class="keyword">instance</span> <span class="type">Eq</span> <span class="container">(<span class="type">Maybe</span> <span class="title">m</span>)</span> <span class="keyword">where</span></span> 
    <span class="type">Just</span> x == <span class="type">Just</span> y = x == y 
    <span class="type">Nothing</span> == <span class="type">Nothing</span> = <span class="type">True</span> 
    _ == _ = <span class="type">False</span>

<span class="comment">-- 最终极版本</span>
<span class="class"><span class="keyword">instance</span> <span class="container">(<span class="type">Eq</span> <span class="title">m</span>)</span> =&gt; <span class="type">Eq</span> <span class="container">(<span class="type">Maybe</span> <span class="title">m</span>)</span> <span class="keyword">where</span></span>
    <span class="type">Just</span> x == <span class="type">Just</span> y = x == y
    <span class="type">Nothing</span> == <span class="type">Nothing</span> = <span class="type">True</span>
    _ == _ <span class="type">False</span>
</pre></td></tr></table></figure>

<p><code>:info</code> 也可以查询类型跟类型构造子的信息</p>
<h1 id="yes-no-typeclass">yes-no typeclass</h1>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre></td><td class="code"><pre><span class="class"><span class="keyword">class</span> <span class="type">YesNo</span> a <span class="keyword">where</span></span>
    yesno :: a -&gt; <span class="type">Bool</span>
<span class="class">
<span class="keyword">instance</span> <span class="type">YesNo</span> <span class="type">Int</span> <span class="keyword">where</span></span> 
    yesno <span class="number">0</span> = <span class="type">False</span> 
    yesno _ = <span class="type">True</span>
<span class="class">
<span class="keyword">instance</span> <span class="type">YesNo</span> [a] <span class="keyword">where</span></span>
    yesno [] = <span class="type">False</span>
    yesno _ = <span class="type">True</span>

<span class="comment">-- 标准函式库中的一个函数，他接受一个参数并回传相同的东西</span>
<span class="class"><span class="keyword">instance</span> <span class="type">YesNo</span> <span class="type">Bool</span> <span class="keyword">where</span></span>
    yesno = id

<span class="title">yesnoIf</span> :: (<span class="type">YesNo</span> y) =&gt; y -&gt; a -&gt; a -&gt; a
<span class="title">yesnoIf</span> yesnoVal yesResult noResult =
    <span class="keyword">if</span> yesno yesnoVal <span class="keyword">then</span> yesResult <span class="keyword">else</span> noResult

<span class="title">ghci</span>&gt; yesnoIf [] <span class="string">"YEAH!"</span> <span class="string">"NO!"</span> 
<span class="string">"NO!"</span> 
<span class="title">ghci</span>&gt; yesnoIf [<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>] <span class="string">"YEAH!"</span> <span class="string">"NO!"</span> 
<span class="string">"YEAH!"</span> 
<span class="title">ghci</span>&gt; yesnoIf <span class="type">True</span> <span class="string">"YEAH!"</span> <span class="string">"NO!"</span> 
<span class="string">"YEAH!"</span> 
<span class="title">ghci</span>&gt; yesnoIf (<span class="type">Just</span> <span class="number">500</span>) <span class="string">"YEAH!"</span> <span class="string">"NO!"</span> 
<span class="string">"YEAH!"</span> 
<span class="title">ghci</span>&gt; yesnoIf <span class="type">Nothing</span> <span class="string">"YEAH!"</span> <span class="string">"NO!"</span> 
<span class="string">"NO!"</span>
</pre></td></tr></table></figure>

<h1 id="functor-typeclass">Functor typeclass</h1>
<p><code>Functor</code> 这个 typeclass，基本上就代表可以被 map over 的事物</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="code"><pre><span class="comment">-- f 代表一个类型构造子 Maybe(不是 Maybe a), 不是具体类型</span>
<span class="comment">-- 可以当作盒子的类型可能就是一个 functor, 如 List, Maybe</span>
<span class="comment">-- 实例化后: (a -&gt; b) -&gt; Tree a -&gt; Tree b</span>
<span class="comment">-- (a -&gt; b) -&gt; Maybe a -&gt; Maybe b</span>
<span class="class"><span class="keyword">class</span> <span class="type">Functor</span> f <span class="keyword">where</span></span>
    fmap :: (a -&gt; b) -&gt; f a -&gt; f b

<span class="comment">-- map :: (a -&gt; ) -&gt; [a] -&gt; [b]</span>
<span class="comment">-- 注意这里没有写 [a]</span>
<span class="class"><span class="keyword">instance</span> <span class="type">Functor</span> [] <span class="keyword">where</span></span>
    fmap = map
    
<span class="comment">-- 注意 这边没有写 Maybe a</span>
<span class="class"><span class="keyword">instance</span> <span class="type">Functor</span> <span class="type">Maybe</span> <span class="keyword">where</span></span> 
    fmap f (<span class="type">Just</span> x) = <span class="type">Just</span> (f x) 
    fmap f <span class="type">Nothing</span> = <span class="type">Nothing</span>
</pre></td></tr></table></figure>

<h1 id="kind">Kind</h1>
<p>类型构造子接受其他类型作为他的参数，来构造出一个具体类型.
我们可以在 ghci 中用 <code>:k</code> 来得知一个类型的 kind。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre></td><td class="code"><pre><span class="comment">-- 一个 * 代表这个类型是具体类型</span>
<span class="title">ghci</span>&gt; :k <span class="type">Int</span> 
<span class="type">Int</span> :: *
<span class="comment">-- * -&gt; * 代表这个类型构造子接受一个具体类型并回传一个具体类型</span>
<span class="title">ghci</span>&gt; :k <span class="type">Maybe</span> 
<span class="type">Maybe</span> :: * -&gt; *
<span class="title">ghci</span>&gt; :k <span class="type">Maybe</span> <span class="type">Int</span> 
<span class="type">Maybe</span> <span class="type">Int</span> :: *

<span class="comment">-- f 必须是 * -&gt; * kind</span>
<span class="class"><span class="keyword">class</span> <span class="type">Functor</span> f <span class="keyword">where</span></span> 
    fmap :: (a -&gt; b) -&gt; f a -&gt; f b
    
<span class="comment">-- a 是 *</span>
<span class="comment">-- j 是 * -&gt; * </span>
<span class="comment">-- t 是 * -&gt; (* -&gt; *) -&gt; *</span>
<span class="class"><span class="keyword">class</span> <span class="type">Tofu</span> t <span class="keyword">where</span></span> 
    tofu :: j a -&gt; t a j

<span class="comment">-- a 是 *</span>
<span class="comment">-- b 是 * -&gt; *</span>
<span class="typedef"><span class="keyword">data</span> <span class="type">Frank</span> a b  = <span class="type">Frank</span> <span class="container">{<span class="title">frankField</span> :: <span class="title">b</span> <span class="title">a</span>}</span> <span class="keyword">deriving</span> <span class="container">(<span class="type">Show</span>)</span></span>

<span class="comment">-- Barry 是 (* -&gt; *) -&gt; * -&gt; * -&gt; *</span>
<span class="typedef"><span class="keyword">data</span> <span class="type">Barry</span> t k p = <span class="type">Barry</span> <span class="container">{ <span class="title">yabba</span> :: <span class="title">p</span>, <span class="title">dabba</span> :: <span class="title">t</span> <span class="title">k</span> }</span></span>
<span class="class">
<span class="keyword">instance</span> <span class="type">Functor</span> <span class="container">(<span class="type">Barry</span> <span class="title">a</span> <span class="title">b</span>)</span> <span class="keyword">where</span></span>
    fmap :: (a -&gt; b) -&gt; <span class="type">Barry</span> c d a -&gt; <span class="type">Barry</span> c d b
<span class="class">
<span class="keyword">instance</span> <span class="type">Functor</span> <span class="container">(<span class="type">Barry</span> <span class="title">a</span> <span class="title">b</span>)</span> <span class="keyword">where</span></span>
    fmap f (<span class="type">Barry</span> {yabba = x, dabba =})
</pre></td></tr></table></figure>

  
	</div>
		<footer class="article-footer clearfix">

  <div class="article-tags">
  
  <span></span> <a href="/tags/haskell/">haskell</a>
  </div>




<div class="article-share" id="share">

  <div data-url="http://zhpooer.github.io/2014/06/29/haskell趣学-构造type和typeclass/" data-title="haskell趣学-构造Type和Typeclass | Poe&#39;s World" data-tsina="null" class="share clearfix">
  </div>

</div>
</footer>   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2014/06/30/haskell趣学-输入与输出/" title="haskell趣学-输入与输出">
  <strong>PREVIOUS:</strong><br/>
  <span>
  haskell趣学-输入与输出</span>
</a>
</div>


<div class="next">
<a href="/2014/06/29/haskell趣学-模块/"  title="haskell趣学-模块">
 <strong>NEXT:</strong><br/> 
 <span>haskell趣学-模块
</span>
</a>
</div>

</nav>

	
<section class="comment">
	<div class="ds-thread"></div>
</section>

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
  <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#-"><span class="toc-number">1.</span> <span class="toc-text">类型记录</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-"><span class="toc-number">2.</span> <span class="toc-text">类型参数</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#car-"><span class="toc-number">2.1.</span> <span class="toc-text">Car的案例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#vector-"><span class="toc-number">2.2.</span> <span class="toc-text">Vector(三维矢量)</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#derived-instances"><span class="toc-number">3.</span> <span class="toc-text">Derived instances</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#-type-synonyms-"><span class="toc-number">4.</span> <span class="toc-text">类型别名(Type synonyms)</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#either-"><span class="toc-number">4.1.</span> <span class="toc-text">Either 的使用</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#-"><span class="toc-number">5.</span> <span class="toc-text">递归地定义数据结构</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-"><span class="toc-number">5.1.</span> <span class="toc-text">二元搜索树构建</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#typeclass"><span class="toc-number">6.</span> <span class="toc-text">TypeClass</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#yes-no-typeclass"><span class="toc-number">7.</span> <span class="toc-text">yes-no typeclass</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#functor-typeclass"><span class="toc-number">8.</span> <span class="toc-text">Functor typeclass</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#kind"><span class="toc-number">9.</span> <span class="toc-text">Kind</span></a></li></ol>
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  

  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			<li><a href="/tags/AJAX/" title="AJAX">AJAX<sup>1</sup></a></li>
		
			<li><a href="/tags/DOM/" title="DOM">DOM<sup>2</sup></a></li>
		
			<li><a href="/tags/EL表达式/" title="EL表达式">EL表达式<sup>1</sup></a></li>
		
			<li><a href="/tags/Hibernate/" title="Hibernate">Hibernate<sup>2</sup></a></li>
		
			<li><a href="/tags/HttpSession/" title="HttpSession">HttpSession<sup>1</sup></a></li>
		
			<li><a href="/tags/IO/" title="IO">IO<sup>1</sup></a></li>
		
			<li><a href="/tags/JSP/" title="JSP">JSP<sup>1</sup></a></li>
		
			<li><a href="/tags/JavaBean/" title="JavaBean">JavaBean<sup>1</sup></a></li>
		
			<li><a href="/tags/JavaScript/" title="JavaScript">JavaScript<sup>1</sup></a></li>
		
			<li><a href="/tags/SAX/" title="SAX">SAX<sup>1</sup></a></li>
		
			<li><a href="/tags/ServletRequest/" title="ServletRequest">ServletRequest<sup>1</sup></a></li>
		
			<li><a href="/tags/ServletResponse/" title="ServletResponse">ServletResponse<sup>1</sup></a></li>
		
			<li><a href="/tags/Spring/" title="Spring">Spring<sup>1</sup></a></li>
		
			<li><a href="/tags/String/" title="String">String<sup>1</sup></a></li>
		
			<li><a href="/tags/StringBuffer/" title="StringBuffer">StringBuffer<sup>1</sup></a></li>
		
			<li><a href="/tags/activiti/" title="activiti">activiti<sup>2</sup></a></li>
		
			<li><a href="/tags/cookie/" title="cookie">cookie<sup>1</sup></a></li>
		
			<li><a href="/tags/css/" title="css">css<sup>1</sup></a></li>
		
			<li><a href="/tags/dom4j/" title="dom4j">dom4j<sup>1</sup></a></li>
		
			<li><a href="/tags/dtd/" title="dtd">dtd<sup>1</sup></a></li>
		
		</ul>
</div>


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<div class="social-font" class="clearfix">
		
		
		
		
	</div>
		<p class="copyright">Powered by <a href="http://zespia.tw/hexo/" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/A-limon/pacman" target="_blank" title="Pacman">Pacman</a> © 2014 
		
		<a href="http://zhpooer.github.io" target="_blank" title="zhpooer">zhpooer</a>
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top",Math.max(140,320-$(this).scrollTop()));
    });
  };
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});     
</script>


<script type="text/javascript">
  var duoshuoQuery = {short_name:"zhpoooer"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 





  </body>
</html>
