
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>Scala in Action-ScalaTest | Poe&#39;s World</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
    
    <meta name="author" content="zhpooer">
    
    <meta name="description" content="There are two kinds of automated tests: ones you write (the most common)
and ones you generate for your code.
If you’re a Java developer and have used">
    
    
    
    
    <link rel="alternative" href="/atom.xml" title="Poe&#39;s World" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/pacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/pacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

  <body>
    <header>
      <div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.svg" alt="Poe&#39;s World" title="Poe&#39;s World"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Poe&#39;s World">Poe&#39;s World</a></h1>
				<h2 class="blog-motto">竹杖芒鞋轻胜马，一蓑烟雨任平生</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">主页</a></li>
					
						<li><a href="/english-monthly">英语角</a></li>
					
						<li><a href="/about">关于</a></li>
					
						<li><a href="/archives">归档</a></li>
					
					<li>
					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="text" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:zhpooer.github.io">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>

    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2014/07/24/scala-in-action-scalatest/" title="Scala in Action-ScalaTest" itemprop="url">Scala in Action-ScalaTest</a>
  </h1>
  <p class="article-author">By
    
      <a href="http://zhpooer.github.io" title="zhpooer">zhpooer</a>
    </p>
  <p class="article-time">
    <time datetime="2014-07-24T02:11:32.000Z" itemprop="datePublished">7月 24 2014</time>
    更新日期:<time datetime="2014-07-25T12:45:29.000Z" itemprop="dateModified">7月 25 2014</time>
    
  </p>
</header>
	<div class="article-content">
		
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#automated-test-generation-using-scalacheck"><span class="toc-number">1.</span> <span class="toc-text">Automated test generation using ScalaCheck</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#working-with-scalacheck"><span class="toc-number">1.1.</span> <span class="toc-text">Working with ScalaCheck</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#tdd"><span class="toc-number">2.</span> <span class="toc-text">TDD</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ci"><span class="toc-number">2.1.</span> <span class="toc-text">CI</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#using-junit"><span class="toc-number">2.2.</span> <span class="toc-text">Using JUnit</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#di"><span class="toc-number">3.</span> <span class="toc-text">DI</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#techniques-to-implement-di"><span class="toc-number">3.1.</span> <span class="toc-text">Techniques to implement DI</span></a></li><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#cake-pattern"><span class="toc-number">3.1.1.</span> <span class="toc-text">Cake pattern</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#structural-typing"><span class="toc-number">3.1.2.</span> <span class="toc-text">Structural typing</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#implicit-parameters"><span class="toc-number">3.1.3.</span> <span class="toc-text">implicit parameters</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dependency-injection-in-functional-style"><span class="toc-number">3.1.4.</span> <span class="toc-text">Dependency injection in functional style</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#using-a-dependency-injection-framework-spring"><span class="toc-number">3.1.5.</span> <span class="toc-text">Using a dependency injection framework: Spring</span></a></li></ol></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#behavior-driven-development-using-specs2"><span class="toc-number">4.</span> <span class="toc-text">Behavior-driven development using Specs2</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#getting-started-with-specs2"><span class="toc-number">4.1.</span> <span class="toc-text">Getting started with Specs2</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#testing-asynchronous-messaging-systems"><span class="toc-number">5.</span> <span class="toc-text">Testing asynchronous messaging systems</span></a></li></ol>
		</div>
		
		<p>There are two kinds of automated tests: ones you write (the most common)
and ones you generate for your code.</p>
<p>If you’re a Java developer and have used JUnit before, using it to test your Scala
code is easy. Specs is a testing tool written in Scala for Scala and
provides more expressiveness in your tests.</p>
<p>Dependency injection is a design pattern used by developers to make their code
more testable.As a hybrid language, Scala provides a number of
abstraction techniques you can use to implement dependency injection.</p>
<p>Automated tests are tests that are recorded or prewritten and can be run by a machine
without any manual intervention.</p>
<p>In the agile software development process, teams don’t analyze and design the
application up front; they build it using an evolutionary design.</p>
<ul>
<li>What does evolving design have to do with automated testing?</li>
<li>Why is evolving the design better than designing the application up front?</li>
</ul>
<p>There are varied types of automated tests: specification-based, unit, integration,
functional, and regression, to name a few.</p>
<h1 id="automated-test-generation-using-scalacheck">Automated test generation using ScalaCheck</h1>
<p>In ScalaCheck, a property is a testable unit. To create a
new property in ScalaCheck, you have to make a statement that describes the behavior
you want to test.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="code"><pre>name := <span class="string">"ScalaCheckExample"</span>

<span class="built_in">version</span> := <span class="string">"1.0"</span>

organization := <span class="string">"Scala in Action"</span>

scalaVersion := <span class="string">"2.10.0"</span>

resolvers ++= Seq(
  <span class="string">"Sonatype Snapshots"</span> <span class="keyword">at</span> <span class="string">"http://oss.sonatype.org/content/repositories/snapshots"</span>,
  <span class="string">"Sonatype Releases"</span> <span class="keyword">at</span> <span class="string">"http://oss.sonatype.org/content/repositories/releases"</span>
)

libraryDependencies ++= Seq (
  <span class="string">"org.scalacheck"</span> %% <span class="string">"scalacheck"</span> % <span class="string">"1.10.0"</span> % <span class="string">"test"</span>
)
<span class="comment">
// append options passed to the Scala compiler</span>
scalacOptions ++= Seq(<span class="string">"-deprecation"</span>, <span class="string">"-unchecked"</span>, <span class="string">"-feature"</span>)
</pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="code"><pre><span class="comment">// The job of ScalaCheck would be to falsify this statement</span>
<span class="comment">// by generating random test data. </span>
<span class="keyword">val</span> anyString = <span class="string">"some string value"</span>
anyString.reverse.reverse == anyString

<span class="keyword">import</span> org.scalacheck.Prop
Prop.forAll((a: String) =&gt; a.reverse.reverse == a)

<span class="keyword">package</span> checks
<span class="keyword">import</span> org.scalacheck._
<span class="comment">// The org.scalacheck.Properties represents a collection of ScalaCheck</span>
<span class="comment">// properties, and SBT has built-in support for running Properties:</span>
<span class="class"><span class="keyword">object</span> <span class="title">StringSpecification</span> <span class="keyword">extends</span> <span class="title">Properties</span><span class="params">(<span class="string">"String"</span>)</span> {</span>
  property(<span class="string">"reverse of reverse gives you same string back"</span>) =
    Prop.forAll((a: String) =&gt; a.reverse.reverse == a)
}
</pre></td></tr></table></figure>

<p>The ScalaCheck generators are responsible for generating test data, and the
org.scalacheck.Gen class represents them.</p>
<p>One in particular is quite important: the arbitrary generator. This is a special
generator that generates arbitrary values for any supported type.</p>
<h2 id="working-with-scalacheck">Working with ScalaCheck</h2>
<ol>
<li>Either will have value on either Left or Right, but not both at any point
in time.</li>
<li>fold on the Left should produce the value contained by Left.</li>
<li>fold on the Right should produce the value contained by Right.</li>
<li>swap returns the Left value to the Right and vice versa.</li>
<li>getOrElse on Left returns the value from Left or the given argument if this is
Right.</li>
<li>forAll on Right returns true if Left or returns the result of the application of
the given function to the Right value.</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
</pre></td><td class="code"><pre>import Gen._
import Arbitrary.arbitrary
//  creates a new instance of the Int type generator and
// maps it to <span class="operator"><span class="keyword">create</span> <span class="keyword">values</span> <span class="keyword">for</span> <span class="keyword">Left</span>
val leftValueGenerator = arbitrary[<span class="keyword">Int</span>].map(<span class="keyword">Left</span>(_))
val rightValueGenerator = arbitrary[<span class="keyword">Int</span>].map(<span class="keyword">Right</span>(_))

// randomly generate instances <span class="keyword">of</span> <span class="keyword">Left</span> <span class="keyword">or</span> <span class="keyword">Right</span>.
// methods <span class="keyword">like</span> oneOf <span class="keyword">or</span> frequency , called combinators.
// They allow you <span class="keyword">to</span> combine multiple generators.
implicit val eitherGenerator =
    oneOf(leftValueGenerator, rightValueGenerator)
    
// The generator you’ve defined here <span class="keyword">only</span> generates <span class="keyword">Int</span> <span class="keyword">values</span>,
// but <span class="keyword">if</span> you wanted <span class="keyword">to</span> play <span class="keyword">with</span> different types <span class="keyword">of</span> <span class="keyword">values</span>, you’d also
// define the generator <span class="keyword">like</span> this:
implicit def arbitraryEither[X, Y](implicit xa: Arbitrary[X],
      ya: Arbitrary[Y]): Arbitrary[Either[X, Y]] =
  Arbitrary[Either[X, Y]]( oneOf(arbitrary[X].map(<span class="keyword">Left</span>(_)), arbitrary[Y].map(<span class="keyword">Right</span>(_))) )

// <span class="keyword">If</span> you wanted <span class="keyword">to</span> use leftValueGenerator <span class="number">75</span>% <span class="keyword">of</span> the <span class="keyword">time</span> compared
// <span class="keyword">to</span> the rightValueGenerator, you could use Gen.frequency <span class="keyword">like</span> this:
implicit val eitherGenerator =
    frequency((<span class="number">3</span>, leftValueGenerator), (<span class="number">1</span>, rightValueGenerator))

// 测试代码
property(<span class="string">"isLeft or isRight not both"</span>) =
    Prop.forAll((e: Either[<span class="keyword">Int</span>, <span class="keyword">Int</span>]) =&gt; e.isLeft != e.isRight)

//  <span class="keyword">on</span> the <span class="keyword">Left</span> should produce the <span class="keyword">value</span> contained <span class="keyword">by</span> <span class="keyword">Left</span>
property(<span class="string">"left value"</span>) =
    Prop.forAll{(n: <span class="keyword">Int</span>) =&gt; <span class="keyword">Left</span>(n).fold(x =&gt; x, b =&gt; error(<span class="string">"fail"</span>)) == n }

// fold <span class="keyword">on</span> the <span class="keyword">Right</span> should produce the <span class="keyword">value</span> contained <span class="keyword">by</span> <span class="keyword">Right</span>
property(<span class="string">"Right value"</span>) =
    Prop.forAll{(n: <span class="keyword">Int</span>) =&gt; <span class="keyword">Right</span>(n).fold(b =&gt; error(<span class="string">"fail"</span>), x =&gt; x) == n }

//def fold[X](fa: A =&gt; X, fb: B =&gt; X) = this <span class="keyword">match</span> {
//  <span class="keyword">case</span> <span class="keyword">Left</span>(a) =&gt; fa(a)
//  <span class="keyword">case</span> <span class="keyword">Right</span>(b) =&gt; fb(b)
//}

// “swap returns the <span class="keyword">Left</span> <span class="keyword">value</span> <span class="keyword">to</span> <span class="keyword">Right</span> <span class="keyword">and</span> vice versa”
property(<span class="string">"swap values"</span>) = Prop.forAll{(e: Either[<span class="keyword">Int</span>, <span class="keyword">Int</span>]) =&gt; e <span class="keyword">match</span> {
    <span class="keyword">case</span> <span class="keyword">Left</span>(a) =&gt; e.swap.<span class="keyword">right</span>.<span class="keyword">get</span> == a
    <span class="keyword">case</span> <span class="keyword">Right</span>(b) =&gt; e.swap.<span class="keyword">left</span>.<span class="keyword">get</span> == b
  }
}

property(<span class="string">"getOrElse"</span>) =
  Prop.forAll{ (e: Either[<span class="keyword">Int</span>, <span class="keyword">Int</span>], <span class="keyword">or</span>: <span class="keyword">Int</span>) =&gt;
    e.<span class="keyword">left</span>.getOrElse(<span class="keyword">or</span>) == (e <span class="keyword">match</span> {
      <span class="keyword">case</span> <span class="keyword">Left</span>(a) =&gt; a
      <span class="keyword">case</span> <span class="keyword">Right</span>(_) =&gt; <span class="keyword">or</span>
    })
  }

property(<span class="string">"forall"</span>) = Prop.forAll {(e: Either[<span class="keyword">Int</span>, <span class="keyword">Int</span>]) =&gt;
  e.<span class="keyword">right</span>.forall(_ % <span class="number">2</span> == <span class="number">0</span>) == (e.isLeft || e.<span class="keyword">right</span>.<span class="keyword">get</span> % <span class="number">2</span> == <span class="number">0</span>)
}</span>
</pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre>// setting <span class="keyword">for</span> <span class="operator">the</span> minimum successful (-s) tests <span class="built_in">from</span> <span class="number">100</span> <span class="built_in">to</span> <span class="number">500</span> <span class="keyword">by</span> passing test arguments
&gt; test-only <span class="comment">-- -s 500</span>
</pre></td></tr></table></figure>

<h1 id="tdd">TDD</h1>
<p>Acceptance criteria:</p>
<pre><code>A 100 product code should use cost plus the percent amount.
Example: 150 (cost) + 20% = $180
All products whose ID starts with B should use an external price source to get
the price.
</code></pre><ul>
<li>Where should you implement the pricing logic?</li>
<li>Should you create a trait or start with a simple function?</li>
<li>What parameters will the function take?</li>
<li>How should you test the output?</li>
<li>Should it hit the database or filesystem to pull up the cost?</li>
</ul>
<p>The most common theme of TDD is to pick the simplest
solution that could possibly work. In this case the simplest solution would be to create
a function that takes a product code, looks it up in a Map, and returns the price using
the formula specified in the acceptance criterion.</p>
<p>Do the simplest thing that could possibly work, and
then incrementally design and build your application.</p>
<p>Once your test is running, you have the opportunity to refactor or clean up.
Refactoring (www.refactoring.com) is a technique you can use to improve the design of
existing code without changing the behavior.</p>
<p>Most popular: JUnit and Specs. JUnit is more
popular among Java developers and can be easily used to test Scala code.</p>
<h2 id="ci">CI</h2>
<ul>
<li>Jenkins CI</li>
<li>Jenkins SBT plugins</li>
<li>Code coverage</li>
</ul>
<p>You can also generate a <code>.POM</code> file (Maven build file) from
your SBT project using the make-pom action.</p>
<h2 id="using-junit">Using JUnit</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>libraryDependencies += <span class="string">"junit"</span> % <span class="string">"junit"</span> % <span class="string">"4.10"</span> % <span class="string">"test"</span>

libraryDependencies += <span class="string">"com.novocode"</span> % <span class="string">"junit-interface"</span> % <span class="string">"0.8"</span> % <span class="string">"test"</span>
</pre></td></tr></table></figure>

<h1 id="di">DI</h1>
<p>Dependency injection (DI) is a design pattern that separates
behavior from dependency resolution.</p>
<p>This example is about calculating the price of a product based on various pricing
rules. Typically any pricing system will have hundreds of rules, but to keep
things simple I will only talk about two:</p>
<ul>
<li>The cost-plus rule determines the price by adding a percentage of the cost.</li>
<li>Getting the price from an external pricing source.</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td><td class="code"><pre><span class="keyword">sealed</span> <span class="class"><span class="keyword">class</span> <span class="title">CalculatePriceService</span> {</span>
  <span class="keyword">val</span> costPlusCalculator = <span class="keyword">new</span> CostPlusCalculator()
  <span class="keyword">val</span> externalPriceSourceCalculator = <span class="keyword">new</span> ExternalPriceSourceCalculator()
  <span class="keyword">val</span> calculators = Map(
    <span class="string">"costPlus"</span> -&gt; calculate(costPlusCalculator) _ ,
    <span class="string">"externalPriceSource"</span> -&gt; calculate(externalPriceSourceCalculator) _)
    
  <span class="keyword">def</span> calculate(priceType: String, productId: String): Double = {
    calculators(priceType)(productId)
  }
  
  <span class="keyword">private</span>[<span class="keyword">this</span>] <span class="keyword">def</span> calculate(c: Calculator)(productId: String):Double =
    c.calculate(productId)
}
<span class="class"><span class="keyword">trait</span> <span class="title">Calculator</span> {</span>
  <span class="keyword">def</span> calculate(productId: String): Double
}

<span class="class"><span class="keyword">class</span> <span class="title">CostPlusCalculator</span> <span class="keyword">extends</span> <span class="title">Calculator</span> {</span>
  <span class="keyword">def</span> calculate(productId: String) = {}
}

<span class="class"><span class="keyword">class</span> <span class="title">ExternalPriceSourceCalculator</span> <span class="keyword">extends</span> <span class="title">Calculator</span> {</span>
  <span class="keyword">def</span> calculate(productId: String) = {}
}
</pre></td></tr></table></figure>

<p>Dependency injection is a specific form of inversion of control where the
concern being inverted is the process of obtaining the needed dependencie</p>
<p>There are some potential problems with this,
in particular when your software is evolving.</p>
<p>Using DI, you can easily solve this problem. If the dependent calculators could be
passed in (injected) to the CalculatePriceService, then the service could be easily
configured with various implementations of calculators.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
</pre></td><td class="code"><pre><span class="comment">// 通过构造器注入</span>
<span class="keyword">sealed</span> <span class="class"><span class="keyword">class</span> <span class="title">CalculatePriceService</span><span class="params">(
    val costPlusCalculator: Calculator,
    val externalPriceSourceCalculator: Calculator)</span> {</span>
  TODO
}
</pre></td></tr></table></figure>

<h2 id="techniques-to-implement-di">Techniques to implement DI</h2>
<p>A measure of a good unit test is that it should be free of side effects,
the same as writing a pure function in functional programming.</p>
<p>If you follow TDD as a driver for your design, you don’t have to worry too much about
the coupling problem—your tests will force you to come up with a decoupled design.
You’ll notice that your functions, classes, and methods follow a DI pattern.</p>
<p>Techniques to implement dependency injection</p>
<ol>
<li>Cake pattern, Handles dependency using trait mixins and abstract members.</li>
<li>Structural typing, Uses structural typing to manage dependencies.
The Scala structural typing feature provides duck typinga in a type-safe manner.</li>
<li>Implicit parameters, Manages dependencies using implicit parameters so that
as a caller you don’t have to pass them.
In this case, dependencies could be easily controlled using scope.</li>
<li>Functional programming style, Uses function currying to control dependencies.</li>
<li>Using a DI framework</li>
</ol>
<h3 id="cake-pattern">Cake pattern</h3>
<p>A cake pattern 13 is a technique to build multiple layers of indirection in your applica-
tion to help with managing dependencies. </p>
<ul>
<li>Abstract members</li>
<li>Self type</li>
<li>Mixin Composition</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
</pre></td><td class="code"><pre><span class="comment">// The idea behind this Calculator trait is to have a component namespace that has all</span>
<span class="comment">// the calculators in your application.</span>
<span class="class"><span class="keyword">trait</span> <span class="title">Calculators</span> {</span>
  <span class="keyword">val</span> costPlusCalculator: CostPlusCalculator
  <span class="keyword">val</span> externalPriceSourceCalculator: ExternalPriceSourceCalculator
  <span class="class"><span class="keyword">trait</span> <span class="title">Calculator</span> {</span>
    <span class="keyword">def</span> calculate(productId: String): Double
  }
  <span class="class"><span class="keyword">class</span> <span class="title">CostPlusCalculator</span> <span class="keyword">extends</span> <span class="title">Calculator</span> {</span>
    <span class="keyword">def</span> calculate(productId: String) = {
      ...
    }
  }
  <span class="class"><span class="keyword">class</span> <span class="title">ExternalPriceSourceCalculator</span> <span class="keyword">extends</span> <span class="title">Calculator</span> {</span>
    <span class="keyword">def</span> calculate(productId: String) = {
      ...
    }
  }
}

<span class="comment">// self type</span>
<span class="comment">// The benefit is that now you can reference both</span>
<span class="comment">// costPlusCalculator and externalPriceSourceCalculator freely.</span>
<span class="class"><span class="keyword">trait</span> <span class="title">CalculatePriceServiceComponent</span> {</span><span class="keyword">this</span>: Calculators =&gt;
  <span class="class"><span class="keyword">class</span> <span class="title">CalculatePriceService</span> {</span>
    <span class="keyword">val</span> calculators = Map(
      <span class="string">"costPlus"</span> -&gt; calculate(costPlusCalculator) _
      <span class="string">"externalPriceSource"</span> -&gt; calculate(externalPriceSourceCalculator) _)
    
    <span class="keyword">def</span> calculate(priceType: String, productId: String): Double = {
      calculators(priceType)(productId)
    }
    <span class="keyword">private</span>[<span class="keyword">this</span>] <span class="keyword">def</span> calculate(c: Calculator)(productId: String):Double =
      c.calculate(productId)
  }
}
<span class="comment">// Remember from the tests, you don’t want to use the calculators; instead you want to</span>
<span class="comment">// use a fake or TestDouble version of the calculators.</span>

<span class="comment">// For production mode you could create a pricing system by compos-</span>
<span class="comment">// ing all the real versions of these components, as in the following:</span>
<span class="class"><span class="keyword">object</span> <span class="title">PricingSystem</span> <span class="keyword">extends</span> <span class="title">CalculatePriceServiceComponent</span> <span class="keyword">with</span> <span class="title">Calculators</span> {</span>
  <span class="keyword">val</span> costPlusCalculator = <span class="keyword">new</span> CostPlusCalculator
  <span class="keyword">val</span> externalPriceSourceCalculator = <span class="keyword">new</span> ExternalPriceSourceCalculator
}

<span class="comment">// or testing the pricing could be created using the fake implementation</span>
<span class="class"><span class="keyword">trait</span> <span class="title">TestPricingSystem</span> <span class="keyword">extends</span> <span class="title">CalculatePriceServiceComponent</span> <span class="keyword">with</span> <span class="title">Calculators</span> {</span>
  <span class="class"><span class="keyword">class</span> <span class="title">StubCostPlusCalculator</span> <span class="keyword">extends</span> <span class="title">CostPlusCalculator</span> {</span>
    <span class="keyword">override</span> <span class="keyword">def</span> calculate(productId: String) = <span class="number">0.0</span>
  }
  
  <span class="class"><span class="keyword">class</span> <span class="title">StubExternalPriceSourceCalculator</span> <span class="keyword">extends</span> <span class="title">ExternalPriceSourceCalculator</span> {</span>
    <span class="keyword">override</span> <span class="keyword">def</span> calculate(productId: String) = <span class="number">0.0</span>
  }
  <span class="keyword">val</span> costPlusCalculator = <span class="keyword">new</span> StubCostPlusCalculator
  <span class="keyword">val</span> externalPriceSourceCalculator = <span class="keyword">new</span> StubExternalPriceSourceCalculator
}
</pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="code"><pre><span class="keyword">package</span> scala.book.cakepatterntest {
  <span class="keyword">import</span> junit.framework.Assert._
  <span class="keyword">import</span> org.junit.Test
  <span class="keyword">import</span> cakepattern._
  <span class="class"><span class="keyword">class</span> <span class="title">CalculatePriceServiceTest</span> <span class="keyword">extends</span> <span class="title">TestPricingSystem</span> {</span>
    <span class="annotation">@Test</span>
    <span class="keyword">def</span> shouldUseCostPlusCalculatorWhenPriceTypeIsCostPlus() {
      <span class="keyword">val</span> calculatePriceService = <span class="keyword">new</span> CalculatePriceService
      <span class="keyword">val</span> price = calculatePriceService.calculate(<span class="string">"costPlus"</span>,<span class="string">"some product"</span>)
      assertEquals(<span class="number">5.0</span>D, price)
    }
  }
}
</pre></td></tr></table></figure>

<p>This is a common technique used by Scala developers to manage dependencies. In
smaller projects, it’s reasonable to have the wiring of dependencies implemented like
the PricingSystem and the TestPricingSystem, but for large projects it may become
difficult to manage them. For large projects it makes more sense to use a DI
framework that allows you to completely separate object creation
and injection from business logic.</p>
<h3 id="structural-typing">Structural typing</h3>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="code"><pre><span class="keyword">type</span> Calculators = {
  <span class="keyword">val</span> costPlusCalculator: Calculator
  <span class="keyword">val</span> externalPriceSourceCalculator: Calculator
}

<span class="class"><span class="keyword">class</span> <span class="title">CalculatePriceService</span><span class="params">(c: Calculators)</span> {</span>
  <span class="keyword">val</span> calculators = Map(
    <span class="string">"costPlus"</span> -&gt; calculate(c.costPlusCalculator) _ ,
    <span class="string">"externalPriceSource"</span> -&gt; calculate(c.externalPriceSourceCalculator) _)
  <span class="keyword">def</span> calculate(priceType: String, productId: String): Double = {
    calculators(priceType)(productId)
  }
  <span class="keyword">private</span>[<span class="keyword">this</span>] <span class="keyword">def</span> calculate(c: Calculator)(productId: String):Double =
    c.calculate(productId)
}
</pre></td></tr></table></figure>

<p>The advantage of structural typing in Scala is that it’s immutable and type-safe.
The Scala compiler will ensure that the constructor
parameter of CalculatePriceService implements both the
abstract vals costPlusCalculator and externalPriceSourceCalculator .</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="code"><pre><span class="class"><span class="keyword">object</span> <span class="title">ProductionConfig</span> {</span>
  <span class="keyword">val</span> costPlusCalculator = <span class="keyword">new</span> CostPlusCalculator
  <span class="keyword">val</span> externalPriceSourceCalculator = <span class="keyword">new</span> ExternalPriceSourceCalculator
  <span class="keyword">val</span> priceService = <span class="keyword">new</span> CalculatePriceService(<span class="keyword">this</span>)
}

<span class="class"><span class="keyword">object</span> <span class="title">TestConfig</span> {</span>
  <span class="keyword">val</span> costPlusCalculator = <span class="keyword">new</span> CostPlusCalculator {
    <span class="keyword">override</span> <span class="keyword">def</span> calculate(productId: String) = <span class="number">0.0</span>
  }
  
  <span class="keyword">val</span> externalPriceSourceCalculator = <span class="keyword">new</span> ExternalPriceSourceCalculator {
    <span class="keyword">override</span> <span class="keyword">def</span> calculate(productId: String) = <span class="number">0.0</span>
  }
  <span class="keyword">val</span> priceService = <span class="keyword">new</span> CalculatePriceService(<span class="keyword">this</span>)
}
</pre></td></tr></table></figure>

<p>You have the flexibility to pick the appropriate configuration.
Internally, structural typing is implemented using
reflection, so it’s slower compared to other approaches. Sometimes that’s acceptable,
but be aware of it when using structural typing.</p>
<h3 id="implicit-parameters">implicit parameters</h3>
<p>Implicit parameters provide a way to allow parameters to be found. Using this tech-
nique you can have the Scala compiler inject appropriate dependencies into your
code. </p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre></td><td class="code"><pre><span class="class"><span class="keyword">class</span> <span class="title">CalculatePriceService</span><span class="params">(
  implicit val costPlusCalculator: CostPlusCalculator,
  implicit val externalPriceSourceCalculator: ExternalPriceSourceCalculator
)</span></span>

<span class="class"><span class="keyword">object</span> <span class="title">ProductionServices</span> {</span>
  implicit <span class="keyword">val</span> costPlusCalculator = <span class="keyword">new</span> CostPlusCalculator
  implicit <span class="keyword">val</span> externalPriceSourceCalculator = <span class="keyword">new</span> ExternalPriceSourceCalculator
}

<span class="class"><span class="keyword">object</span> <span class="title">ProductionConfig</span> {</span>
  <span class="keyword">import</span> ProductionServices._
  <span class="keyword">val</span> priceService = <span class="keyword">new</span> CalculatePriceService
}


<span class="class"><span class="keyword">object</span> <span class="title">TestServices</span> {</span>
  implicit <span class="keyword">val</span> costPlusCalculator = <span class="keyword">new</span> CostPlusCalculator {
    <span class="keyword">override</span> <span class="keyword">def</span> calculate(productId: String) = <span class="number">0.0</span>
  }
  implicit <span class="keyword">val</span> externalPriceSourceCalculator = <span class="keyword">new</span> ExternalPriceSourceCalculator {
    <span class="keyword">override</span> <span class="keyword">def</span> calculate(productId: String) = <span class="number">0.0</span>
  }
}
<span class="class"><span class="keyword">object</span> <span class="title">TestConfig</span> {</span>
  <span class="keyword">import</span> TestServices._
  <span class="keyword">val</span> priceService = <span class="keyword">new</span> CalculatePriceService
}
</pre></td></tr></table></figure>

<p>Using implicit to handle dependencies can easily get out of hand as your application grows
in size, unless they’re grouped together like the preceding configuration objects.</p>
<h3 id="dependency-injection-in-functional-style">Dependency injection in functional style</h3>
<p>If you consider a function as a component, then its dependencies are its parameters.
If you create function currying, you can also
hide the dependencies as you did with other patterns.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td><td class="code"><pre><span class="class"><span class="keyword">trait</span> <span class="title">Calculators</span> {</span>
  <span class="comment">//  type Calculator is an alias of function that takes product ID and returns the price</span>
  <span class="keyword">type</span> Calculator = String =&gt; Double
  <span class="keyword">protected</span> <span class="keyword">val</span> findCalculator: String =&gt; Calculator
  <span class="keyword">protected</span> <span class="keyword">val</span> calculate: (Calculator, String) =&gt; Double =
    (calculator, productId) =&gt; calculator(productId)
}

<span class="comment">//  it created a function that takes Calculator and</span>
<span class="comment">// returns a function that calculates the price for a productid </span>
<span class="class"><span class="keyword">object</span> <span class="title">TestCalculators</span> <span class="keyword">extends</span> <span class="title">Calculators</span> {</span>
  <span class="keyword">val</span> costPlusCalculator: String =&gt; Double = productId =&gt; <span class="number">0.0</span>
  <span class="keyword">val</span> externalPriceSource: String =&gt; Double = productId =&gt; <span class="number">0.0</span>
  <span class="keyword">override</span> <span class="keyword">protected</span> <span class="keyword">val</span> findCalculator = Map(
    <span class="string">"costPlus"</span> -&gt; costPlusCalculator,
    <span class="string">"externalPriceSource"</span> -&gt; externalPriceSource
  )
  <span class="keyword">def</span> priceCalculator(priceType: String): String =&gt; Double = {
    <span class="keyword">val</span> f: Calculator =&gt; String =&gt; Double = calculate.curried
    f(findCalculator(priceType))
  }
}

<span class="comment">// The benefit of doing this now is you have a function that knows</span>
<span class="comment">// how to calculate price but hides the Calculator from the users.</span>
</pre></td></tr></table></figure>

<p>The priceCalculator method returns a function that takes the productId and
returns the price of the product that encapsulates the dependencies used to compute
the price.</p>
<h3 id="using-a-dependency-injection-framework-spring">Using a dependency injection framework: Spring</h3>
<p>DI frameworks provide the following additional services
that aren’t available in these abstraction techniques above:</p>
<ul>
<li>They create a clean separation between object initialization and creation from
the business logic. This way, your wiring between components becomes
transparent from the code.</li>
<li>These frameworks help you to work with various other frameworks.
A DI framework will help to inject your Scala objects as dependencies.</li>
<li>Most of the DI frameworks, like Spring (www.springsource.org) and Guice
provide aspect-oriented programming ( AOP) support to handle cross-cutting
behaviors like transaction and logging out of the box.</li>
</ul>
<p>In the Spring world, all the dependencies are called beans, because all the objects
follow the JavaBean convention. According to this convention a class
should provide a default constructor, and class properties
should be accessible using get, set, and is methods.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="code"><pre><span class="keyword">package</span> scala.book
<span class="keyword">import</span> scala.reflect._
<span class="keyword">sealed</span> <span class="class"><span class="keyword">class</span> <span class="title">CalculatePriceService</span> {</span>
  <span class="annotation">@BeanProperty</span> <span class="keyword">var</span> costPlusCalculator: Calculator = _1
  <span class="annotation">@BeanProperty</span> <span class="keyword">var</span> externalPriceSourceCalculator: Calculator = _
}
<span class="annotation">@RunWith</span>(classOf[SpringJUnit4ClassRunner])
<span class="annotation">@ContextConfiguration</span>(locations =
    Array(<span class="string">"classpath:/application-context.xml"</span>))
<span class="class"><span class="keyword">class</span> <span class="title">CalculatePriceServiceTest</span> {</span>
  <span class="annotation">@Resource</span>
  <span class="keyword">var</span> calculatePriceService: CalculatePriceService = _
}
</pre></td></tr></table></figure>

<p>In large projects it’s recommended to have a test
version of a configuration file where you can configure
all your beans with fake implementations of their dependencies.</p>
<h1 id="behavior-driven-development-using-specs2">Behavior-driven development using Specs2</h1>
<p>Behavior-driven development (BDD ) is about implementing an application by describ-
ing the behavior from the point of view of stakeholders.</p>
<p>BDD is doing TDD the right way. The first
thing to notice is that the definition of BDD doesn’t talk about testing at all.
And BDD puts more emphasis on solving business problems.
In fact, it recommends looking at the application from the stakeholder’s perspective.</p>
<ul>
<li>Delivering value quickly—Because you’re focused on viewing the application
from the stakeholder’s point of view, you understand and deliver value quickly.</li>
<li>Focus on behavior—This is the most important improvement because at the end
of the day, behaviors that you implement are the ones your stakeholders want.</li>
</ul>
<p>Think of a specification as a list of examples.</p>
<h2 id="getting-started-with-specs2">Getting started with Specs2</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>scalaVersion <span class="symbol">:</span>= <span class="string">"2.10.0"</span>

libraryDependencies += <span class="string">"org.specs2"</span> <span class="string">%% "specs2" %</span> <span class="string">"1.13"</span> % <span class="string">"test"</span>
</pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
</pre></td><td class="code"><pre>
<span class="class"><span class="keyword">trait</span> <span class="title">TestPricingSystem</span> <span class="keyword">extends</span> <span class="title">CalculatePriceServiceComponent</span> <span class="keyword">with</span> <span class="title">Calculators</span> {</span>
  <span class="class"><span class="keyword">class</span> <span class="title">StubCostPlusCalculator</span> <span class="keyword">extends</span> <span class="title">CostPlusCalculator</span> {</span>
    <span class="keyword">override</span> <span class="keyword">def</span> calculate(productId: String) = <span class="number">5.0</span>D
  }
  <span class="class"><span class="keyword">class</span> <span class="title">StubExternalPriceSourceCalculator</span> <span class="keyword">extends</span> <span class="title">ExternalPriceSourceCalculator</span> {</span>
    <span class="keyword">override</span> <span class="keyword">def</span> calculate(productId: String) = <span class="number">10.0</span>D
  }
  <span class="keyword">val</span> costPlusCalculator = <span class="keyword">new</span> StubCostPlusCalculator
  <span class="keyword">val</span> externalPriceSourceCalculator = <span class="keyword">new</span> StubExternalPriceSourceCalculator
}

<span class="keyword">package</span> scala.book

<span class="keyword">import</span> org.specs2.mutable._

<span class="class"><span class="keyword">class</span> <span class="title">CalculatePriceServiceSpecification</span> <span class="keyword">extends</span> <span class="title">Specification</span> {</span>
  <span class="string">"Calculate price service"</span> should {
    <span class="string">"calculate price for cost plus price type"</span> in {
      <span class="keyword">val</span> service = <span class="keyword">new</span> CalculatePriceService
      <span class="keyword">val</span> price: Double = service.calculate(<span class="string">"costPlus"</span>, <span class="string">"some product"</span>)
      price must beEqualTo(<span class="number">5.0</span>D)
    }
    <span class="string">"calculate price for external price source type"</span> in {
      <span class="keyword">val</span> service = <span class="keyword">new</span> CalculatePriceService
      <span class="keyword">val</span> price: Double = service.calculate(<span class="string">"externalPriceSource"</span>,<span class="string">"some product"</span>)
      price must be_==(<span class="number">10.0</span>D)
    }
  }

}
<span class="comment">// The must method is again added by Specs using implicit conversions to</span>
<span class="comment">// almost all the types to make the specification more readable.</span>

<span class="comment">// nest </span>
<span class="string">"calculate price for cost plus price type"</span> in {
  <span class="keyword">val</span> service = <span class="keyword">new</span> CalculatePriceService
  <span class="keyword">val</span> price: Double = service.calculate(<span class="string">"costPlus"</span>, <span class="string">"some product"</span>)
  price must beEqualTo(<span class="number">5.0</span>D)
  <span class="string">"for empty product id return 0.0"</span> in {
    <span class="keyword">val</span> service = <span class="keyword">new</span> CalculatePriceService
    service.calculate(<span class="string">"costPlus"</span>, <span class="string">""</span>) must beEqualTo(<span class="number">0.0</span>D)
  }
}
</pre></td></tr></table></figure>

<p>Another interesting way to declare specifications in Specs is to use data tables.
Data tables allow you to execute your example with a set of test data.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
</pre></td><td class="code"><pre><span class="string">"cost plus price is calculated using 'cost + 20% of cost + given service charge' rule"</span> <span class="function_or_atom">in</span> {
  <span class="string">"cost"</span> | <span class="string">"service charge"</span> | <span class="string">"price"</span> |&gt;
  <span class="number">100.0</span> <span class="exclamation_mark">!</span>  <span class="number">4</span>    <span class="exclamation_mark">!</span> <span class="number">124</span>  |
  <span class="number">200.0</span> <span class="exclamation_mark">!</span> <span class="number">4</span>     <span class="exclamation_mark">!</span> <span class="number">244</span>  |
  <span class="number">0.0</span>   <span class="exclamation_mark">!</span> <span class="number">2</span>     <span class="exclamation_mark">!</span> <span class="number">2</span>    | {
  (<span class="function_or_atom">cost</span>, <span class="function_or_atom">serviceCharge</span>, <span class="function_or_atom">expected</span>) =&gt;
    <span class="function_or_atom">applyCostPlusBusinessRule</span>(<span class="function_or_atom">cost</span>, <span class="function_or_atom">serviceCharge</span>) <span class="function_or_atom">must</span> <span class="function_or_atom">be_</span>==(<span class="function_or_atom">expected</span>)
}
</pre></td></tr></table></figure>

<h1 id="testing-asynchronous-messaging-systems">Testing asynchronous messaging systems</h1>
<p>Let’s see Awaitility work in a simple example.
Imagine that you have an order-placing service that saves orders to the
database asynchronously, and you place an order by sending a PlaceOrder message.
Here’s the dummy ordering service implemented as an actor:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre><span class="keyword">package</span> example.actors
<span class="class"><span class="keyword">case</span> <span class="keyword">class</span> <span class="title">PlaceOrder</span><span class="params">(productId: String, quantity: Int, customerId: String)</span></span>
<span class="class"><span class="keyword">class</span> <span class="title">OrderingService</span> <span class="keyword">extends</span> <span class="title">Actor</span> {</span>
  <span class="keyword">def</span> act = {
    react {
      <span class="keyword">case</span> PlaceOrder(productId, quantity, customer) =&gt;
    }
  }
}
</pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="code"><pre><span class="keyword">import</span> org.specs2.mutable._
<span class="keyword">import</span> example.actors._
<span class="keyword">import</span> com.jayway.awaitility.scala._
<span class="keyword">import</span> com.jayway.awaitility.Awaitility._
<span class="class"><span class="keyword">class</span> <span class="title">OrderServiceSpecification</span> <span class="keyword">extends</span> <span class="title">Specification</span> <span class="keyword">with</span> <span class="title">AwaitilitySupport</span> {</span>
  <span class="string">"Ordering system"</span> should {
    <span class="string">"place order asynchronously"</span> in {
      <span class="keyword">val</span> s = <span class="keyword">new</span> OrderingService().start
      s ! PlaceOrder(<span class="string">"product id"</span>, <span class="number">1</span>, <span class="string">"some customer id"</span>)
      <span class="comment">// waits until the order is saved into the database.</span>
      <span class="comment">// The default timeout for Awaitility is 10 seconds</span>
      await until {orderSavedInDatabase(<span class="string">"some customer id"</span>) }
      <span class="number">1</span> must_== <span class="number">1</span>
    }
    <span class="comment">// Inside the orderSavedInDatabase, you could go to the data source and</span>
    <span class="comment">// check whether the order is saved for a given customer ID</span>
    <span class="keyword">def</span> orderSavedInDatabase(customerId: String) = ...
  }

}
</pre></td></tr></table></figure>

  
	</div>
		<footer class="article-footer clearfix">

  <div class="article-tags">
  
  <span></span> <a href="/tags/scala/">scala</a>
  </div>




<div class="article-share" id="share">

  <div data-url="http://zhpooer.github.io/2014/07/24/scala-in-action-scalatest/" data-title="Scala in Action-ScalaTest | Poe&#39;s World" data-tsina="null" class="share clearfix">
  </div>

</div>
</footer>   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2014/07/25/传智播客day63-医药集中采购平台-药品目录/" title="传智播客day63-医药集中采购平台 药品目录">
  <strong>PREVIOUS:</strong><br/>
  <span>
  传智播客day63-医药集中采购平台 药品目录</span>
</a>
</div>


<div class="next">
<a href="/2014/07/23/scala-in-action-concurrency-programming/"  title="Scala in Action-Concurrency programming">
 <strong>NEXT:</strong><br/> 
 <span>Scala in Action-Concurrency programming
</span>
</a>
</div>

</nav>

	
<section class="comment">
	<div class="ds-thread"></div>
</section>

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
  <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#automated-test-generation-using-scalacheck"><span class="toc-number">1.</span> <span class="toc-text">Automated test generation using ScalaCheck</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#working-with-scalacheck"><span class="toc-number">1.1.</span> <span class="toc-text">Working with ScalaCheck</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#tdd"><span class="toc-number">2.</span> <span class="toc-text">TDD</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ci"><span class="toc-number">2.1.</span> <span class="toc-text">CI</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#using-junit"><span class="toc-number">2.2.</span> <span class="toc-text">Using JUnit</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#di"><span class="toc-number">3.</span> <span class="toc-text">DI</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#techniques-to-implement-di"><span class="toc-number">3.1.</span> <span class="toc-text">Techniques to implement DI</span></a></li><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#cake-pattern"><span class="toc-number">3.1.1.</span> <span class="toc-text">Cake pattern</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#structural-typing"><span class="toc-number">3.1.2.</span> <span class="toc-text">Structural typing</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#implicit-parameters"><span class="toc-number">3.1.3.</span> <span class="toc-text">implicit parameters</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dependency-injection-in-functional-style"><span class="toc-number">3.1.4.</span> <span class="toc-text">Dependency injection in functional style</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#using-a-dependency-injection-framework-spring"><span class="toc-number">3.1.5.</span> <span class="toc-text">Using a dependency injection framework: Spring</span></a></li></ol></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#behavior-driven-development-using-specs2"><span class="toc-number">4.</span> <span class="toc-text">Behavior-driven development using Specs2</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#getting-started-with-specs2"><span class="toc-number">4.1.</span> <span class="toc-text">Getting started with Specs2</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#testing-asynchronous-messaging-systems"><span class="toc-number">5.</span> <span class="toc-text">Testing asynchronous messaging systems</span></a></li></ol>
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  

  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			<li><a href="/tags/AJAX/" title="AJAX">AJAX<sup>1</sup></a></li>
		
			<li><a href="/tags/Akka/" title="Akka">Akka<sup>1</sup></a></li>
		
			<li><a href="/tags/Android/" title="Android">Android<sup>1</sup></a></li>
		
			<li><a href="/tags/DOM/" title="DOM">DOM<sup>2</sup></a></li>
		
			<li><a href="/tags/EL表达式/" title="EL表达式">EL表达式<sup>1</sup></a></li>
		
			<li><a href="/tags/HBase/" title="HBase">HBase<sup>1</sup></a></li>
		
			<li><a href="/tags/Hadoop/" title="Hadoop">Hadoop<sup>1</sup></a></li>
		
			<li><a href="/tags/Hibernate/" title="Hibernate">Hibernate<sup>2</sup></a></li>
		
			<li><a href="/tags/HttpSession/" title="HttpSession">HttpSession<sup>1</sup></a></li>
		
			<li><a href="/tags/IO/" title="IO">IO<sup>1</sup></a></li>
		
			<li><a href="/tags/Illustrator/" title="Illustrator">Illustrator<sup>3</sup></a></li>
		
			<li><a href="/tags/JSP/" title="JSP">JSP<sup>1</sup></a></li>
		
			<li><a href="/tags/JavaBean/" title="JavaBean">JavaBean<sup>1</sup></a></li>
		
			<li><a href="/tags/JavaScript/" title="JavaScript">JavaScript<sup>1</sup></a></li>
		
			<li><a href="/tags/Mybatis/" title="Mybatis">Mybatis<sup>1</sup></a></li>
		
			<li><a href="/tags/NoSql/" title="NoSql">NoSql<sup>1</sup></a></li>
		
			<li><a href="/tags/SAX/" title="SAX">SAX<sup>1</sup></a></li>
		
			<li><a href="/tags/ServletRequest/" title="ServletRequest">ServletRequest<sup>1</sup></a></li>
		
			<li><a href="/tags/ServletResponse/" title="ServletResponse">ServletResponse<sup>1</sup></a></li>
		
			<li><a href="/tags/Spring/" title="Spring">Spring<sup>1</sup></a></li>
		
		</ul>
</div>


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<div class="social-font" class="clearfix">
		
		
		
		
	</div>
		<p class="copyright">Powered by <a href="http://zespia.tw/hexo/" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/A-limon/pacman" target="_blank" title="Pacman">Pacman</a> © 2014 
		
		<a href="http://zhpooer.github.io" target="_blank" title="zhpooer">zhpooer</a>
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top",Math.max(140,320-$(this).scrollTop()));
    });
  };
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});     
</script>


<script type="text/javascript">
  var duoshuoQuery = {short_name:"zhpoooer"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 





  </body>
</html>
