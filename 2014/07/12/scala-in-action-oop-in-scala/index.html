
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>Scala in Action-OOP in Scala | Poe&#39;s World</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
    
    <meta name="author" content="zhpooer">
    
    <meta name="description" content="一些特性
_root_的使用
1
2
3
4
5
6
7
8
9
10
11
package monads { class IOMonad }
package io {
  package monads {
    class Console { val m = new _root_.monads.">
    
    
    
    
    <link rel="alternative" href="/atom.xml" title="Poe&#39;s World" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/pacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/pacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

  <body>
    <header>
      <div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.svg" alt="Poe&#39;s World" title="Poe&#39;s World"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Poe&#39;s World">Poe&#39;s World</a></h1>
				<h2 class="blog-motto">竹杖芒鞋轻胜马，一蓑烟雨任平生</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">主页</a></li>
					
						<li><a href="/english-monthly">英语角</a></li>
					
						<li><a href="/about">关于</a></li>
					
						<li><a href="/archives">归档</a></li>
					
					<li>
					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="text" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:zhpooer.github.io">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>

    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2014/07/12/scala-in-action-oop-in-scala/" title="Scala in Action-OOP in Scala" itemprop="url">Scala in Action-OOP in Scala</a>
  </h1>
  <p class="article-author">By
    
      <a href="http://zhpooer.github.io" title="zhpooer">zhpooer</a>
    </p>
  <p class="article-time">
    <time datetime="2014-07-12T13:56:24.000Z" itemprop="datePublished">7月 12 2014</time>
    更新日期:<time datetime="2014-08-10T09:06:10.092Z" itemprop="dateModified">8月 10 2014</time>
    
  </p>
</header>
	<div class="article-content">
		
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#-"><span class="toc-number">1.</span> <span class="toc-text">一些特性</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-_root_-"><span class="toc-number">1.1.</span> <span class="toc-text">的使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bean-"><span class="toc-number">1.2.</span> <span class="toc-text">bean方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#object-"><span class="toc-number">1.3.</span> <span class="toc-text">object 的工厂方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#package-object"><span class="toc-number">1.4.</span> <span class="toc-text">package object</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#trait"><span class="toc-number">1.5.</span> <span class="toc-text">trait</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#case-class"><span class="toc-number">1.6.</span> <span class="toc-text">case class</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#copy-constructor"><span class="toc-number">1.7.</span> <span class="toc-text">copy constructor</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#abstract-override"><span class="toc-number">1.8.</span> <span class="toc-text">abstract override</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sealed"><span class="toc-number">1.9.</span> <span class="toc-text">sealed</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#value-class"><span class="toc-number">2.</span> <span class="toc-text">Value Class</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#implicit"><span class="toc-number">3.</span> <span class="toc-text">implicit</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#demo-mongo"><span class="toc-number">4.</span> <span class="toc-text">DEMO: Mongo</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1"><span class="toc-number">4.1.</span> <span class="toc-text">1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2"><span class="toc-number">4.2.</span> <span class="toc-text">2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3"><span class="toc-number">4.3.</span> <span class="toc-text">3</span></a></li></ol>
		</div>
		
		<h1 id="-">一些特性</h1>
<h2 id="-_root_-"><code>_root_</code>的使用</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="code"><pre><span class="keyword">package</span> monads { <span class="class"><span class="keyword">class</span> <span class="title">IOMonad</span> }</span>
<span class="keyword">package</span> io {
  <span class="keyword">package</span> monads {
    <span class="class"><span class="keyword">class</span> <span class="title">Console</span> {</span> <span class="keyword">val</span> m = <span class="keyword">new</span> _root_.monads.IOMonad }
  }
}

<span class="keyword">import</span> java.util.Date
<span class="keyword">import</span> java.sql.{Date =&gt; SqlDate}
<span class="comment">// 也可以这样</span>
<span class="keyword">import</span> java.sql.{Date =&gt; _ }
</pre></td></tr></table></figure>

<h2 id="bean-">bean方法</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
</pre></td><td class="code"><pre><span class="comment">// 如果在构造函数中没有定义 var 或者 val, 将会是似有的</span>
<span class="keyword">class</span> Person(<span class="keyword">var</span> firstName:<span class="keyword">String</span>, <span class="keyword">var</span> lastName:<span class="keyword">String</span>,
        <span class="keyword">private</span> <span class="keyword">var</span> _age:Int) <span class="comment">{
  def age = _age
  def age_=(newAge: Int) = _age = newAge
}</span>
</pre></td></tr></table></figure>

<h2 id="object-">object 的工厂方法</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="code"><pre><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Role</span> {</span> <span class="keyword">def</span> canAccess(page: String): Boolean }
<span class="class"><span class="keyword">class</span> <span class="title">Root</span> <span class="keyword">extends</span> <span class="title">Role</span> {</span>
  <span class="keyword">override</span> <span class="keyword">def</span> canAccess(page:String) = <span class="keyword">true</span>
}
<span class="class"><span class="keyword">class</span> <span class="title">SuperAnalyst</span> <span class="keyword">extends</span> <span class="title">Role</span> {</span>
  <span class="keyword">override</span> <span class="keyword">def</span> canAccess(page:String) = page != <span class="string">"Admin"</span>
}
<span class="class"><span class="keyword">class</span> <span class="title">Analyst</span> <span class="keyword">extends</span> <span class="title">Role</span> {</span>
  <span class="keyword">override</span> <span class="keyword">def</span> canAccess(page:String) = <span class="keyword">false</span>
}
<span class="class"><span class="keyword">object</span> <span class="title">Role</span> {</span>
  <span class="keyword">def</span> apply(roleName:String) = roleName <span class="keyword">match</span> {
    <span class="keyword">case</span> <span class="string">"root"</span> =&gt; <span class="keyword">new</span> Root
    <span class="keyword">case</span> <span class="string">"superAnalyst"</span> =&gt; <span class="keyword">new</span> SuperAnalyst
    <span class="keyword">case</span> <span class="string">"analyst"</span> =&gt; <span class="keyword">new</span> Analyst
  }
}
</pre></td></tr></table></figure>

<h2 id="package-object">package object</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="code"><pre><span class="comment">// 一般放在 package.scala文件下</span>
<span class="comment">// minimumAge and verifyAge will be available to</span>
<span class="comment">// all members of the package bar</span>
<span class="keyword">package</span> <span class="class"><span class="keyword">object</span> <span class="title">bar</span> {</span>
  <span class="keyword">val</span> minimumAge = <span class="number">18</span>
  <span class="keyword">def</span> verifyAge = {}
}

<span class="comment">// 用法如下</span>
<span class="keyword">package</span> bar
<span class="class"><span class="keyword">class</span> <span class="title">BarTender</span> {</span>
  <span class="keyword">def</span> serveDrinks = { verifyAge; ... }
}
</pre></td></tr></table></figure>

<h2 id="trait">trait</h2>
<p>In OOP languages, a mixin is a class that provides certain functionality
that could be used by other classes.</p>
<p>Another difference between traits and abstract classes in Scala is that an
abstract class can have constructor parameters, but traits can’t take any param-
eters. Both can take type parameters.</p>
<p>The difference between def and val is that val gets evaluated when an
object is created, but def is evaluated every time a method is called.</p>
<h2 id="case-class">case class</h2>
<p>when you prefix a class with case, the following things will hap-
pen automatically:</p>
<ul>
<li>Scala prefixes all the parameters with val, and that will make them public value.
But remember that you still never access the value directly; you always access
through accessors.</li>
<li>Both equals and hashCode are implemented for you based on the given
parameters.</li>
<li>The compiler implements the toString method that returns the class name
and its parameters.</li>
<li>Every case class has a method named copy that allows you to easily create a mod-
ified copy of the class’s instance. You’ll learn about this later in this chapter.</li>
<li>A companion object is created with the appropriate apply method, which takes
the same arguments as declared in the class.</li>
<li>The compiler adds a method called unapply, which allows the class name to be
used as an extractor for pattern matching (more on this later).</li>
<li>A default implementation is provided for serialization:<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="code"><pre>scala&gt; val me = Person(<span class="string">"Nilanjan"</span>, <span class="string">"Raychaudhuri"</span>)
<span class="label">me:</span> Person = Person(Nilanjan,Raychaudhuri)

scala&gt; val myself = Person(<span class="string">"Nilanjan"</span>, <span class="string">"Raychaudhuri"</span>)
<span class="label">myself:</span> Person = Person(Nilanjan,Raychaudhuri)

scala&gt; me<span class="preprocessor">.equals</span>(myself)
<span class="label">res1:</span> Boolean = true

scala&gt; me<span class="preprocessor">.hashCode</span>
<span class="label">res2:</span> Int = <span class="number">1688656232</span>

scala&gt; myself<span class="preprocessor">.hashCode</span>
<span class="label">res4:</span> Int = <span class="number">1688656232</span>
</pre></td></tr></table></figure>

</li>
</ul>
<h2 id="copy-constructor">copy constructor</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="code"><pre>scala&gt; val skipOption = <span class="keyword">Skip</span>(<span class="number">10</span>, NoOption)
  skipOption: <span class="keyword">Skip</span> = <span class="keyword">Skip</span>(<span class="number">10</span>,NoOption())
  
scala&gt; val skipWithLimit = skipOption.<span class="keyword">copy</span>(anotherOption = Limit(<span class="number">10</span>, NoOption))
  skipWithLimit: <span class="keyword">Skip</span> = <span class="keyword">Skip</span>(<span class="number">10</span>,Limit(<span class="number">10</span>,NoOption))

<span class="comment">// 内部结构如下</span>
<span class="keyword">case</span> <span class="keyword">class</span> <span class="keyword">Skip</span>(number: Int, anotherOption: QueryOption)
    extends QueryOption <span class="comment">{
  def copy(number: Int = number,
  anotherOption: QueryOption = anotherOption) = {
    Skip(number, anotherOption)
  }</span>
}
</pre></td></tr></table></figure>

<h2 id="abstract-override">abstract override</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="code"><pre><span class="class"><span class="keyword">trait</span> <span class="title">DogMood</span> {</span>
  <span class="keyword">def</span> greet
}

<span class="class"><span class="keyword">trait</span> <span class="title">AngryMood</span> <span class="keyword">extends</span> <span class="title">DogMood</span> {</span>
  <span class="comment">// 父方法是抽象方法, 错误</span>
  <span class="keyword">override</span> <span class="keyword">def</span> greet = {
    println(<span class="string">"bark"</span>)
    <span class="keyword">super</span>.greet
  }
}
<span class="comment">// 但是可以这样</span>
<span class="comment">//  abstract override, which means it should be mixed in</span>
<span class="comment">// with some class that has the concrete definition of the greet method.</span>
<span class="class"><span class="keyword">trait</span> <span class="title">AngryMood</span> <span class="keyword">extends</span> <span class="title">DogMood</span> {</span>
 <span class="keyword">abstract</span> <span class="keyword">override</span> <span class="keyword">def</span> greet = {
   println(<span class="string">"bark"</span>)
   <span class="keyword">super</span>.greet
 }
}
</pre></td></tr></table></figure>

<h2 id="sealed">sealed</h2>
<p>classes marked final in Scala
can’t be overridden by subclasses. But classes marked sealed can be overridden as
long as the subclasses belong to the same source file.</p>
<h1 id="value-class">Value Class</h1>
<p>Scala allows user-defined value classes (which could be case
classes as well) that extend AnyVal. Value classes are a new mechanism to avoid run-time allocation of the objects.
To create a value class you need to abide by some
important rules, including:</p>
<ul>
<li>The class must have exactly one val parameter (vars are not allowed).</li>
<li>The parameter type may not be a value class.</li>
<li>The class can not have any auxiliary constructors.</li>
<li>The class can only have def members, no vals or vars.</li>
<li>The class cannot extend any traits, only universal traits.</li>
</ul>
<p>Value classes allow you to add extension
methods to a type without the runtime overhead of creating instances.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="code"><pre><span class="class"><span class="keyword">class</span> <span class="title">Wrapper</span><span class="params">(val name: String)</span> <span class="keyword">extends</span> <span class="title">AnyVal</span> {</span>
  <span class="keyword">def</span> up() = name.toUpperCase
}

<span class="keyword">val</span> w = <span class="keyword">new</span> Wrapper(<span class="string">"hey"</span>)
w.up()

<span class="comment">// 他被编译成这样</span>
<span class="class"><span class="keyword">object</span> <span class="title">Wrapper</span> {</span>
  <span class="keyword">def</span> up$extension(_name: String) = _name.toUpperCase
}
</pre></td></tr></table></figure>

<p>A value class can only extend a universal trait, one that extends Any (normally traits by
default extend AnyRef). Universal traits can only have def members and no initializa-
tion code:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre><span class="class"><span class="keyword">trait</span> <span class="title">Printable</span> <span class="keyword">extends</span> <span class="title">Any</span> {</span>
  <span class="keyword">def</span> p() = println(<span class="keyword">this</span>)
}
<span class="class"><span class="keyword">case</span> <span class="keyword">class</span> <span class="title">Wrapper</span><span class="params">(val name: String)</span> <span class="keyword">extends</span> <span class="title">AnyVal</span> <span class="keyword">with</span> <span class="title">Printable</span> {</span>
  <span class="keyword">def</span> up() = name.toUpperCase
}
...
<span class="keyword">val</span> w = Wrapper(<span class="string">"Hey"</span>)
w.p()
</pre></td></tr></table></figure>

<p>Even though now you can invoke the p method on a Wrapper instance at runtime an
instance will also be created because the implementation of the p method prints the
type. There are limitations when allocation is necessary; if you assign a value class to
an array, the optimization will fail.</p>
<h1 id="implicit">implicit</h1>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="code"><pre>implicit <span class="keyword">def</span> double2Int(d: Double): Int = d.toInt

<span class="keyword">val</span> someInt: Int = <span class="number">2.3</span>

-- rewritten by the compiler:
<span class="keyword">val</span> someInt: Int = double2Int(<span class="number">2.3</span>)

-- we can avoid the runtime cost by turning our implicit classes
-- into value classes
implicit <span class="class"><span class="keyword">class</span> <span class="title">RangeMaker</span><span class="params">(val left: Int)</span> <span class="keyword">extends</span> <span class="title">AnyVal</span> {</span>
  <span class="keyword">def</span> --&gt;(right: Int): Range = left to right
}
</pre></td></tr></table></figure>

<h1 id="demo-mongo">DEMO: Mongo</h1>
<h2 id="1">1</h2>
<p>As a developer, I want an easier way to connect to my MongoDB server and access
document databases.</p>
<p>As a developer, I want to query and manage documents.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="code"><pre><span class="keyword">package</span> com.scalainaction.mongo

<span class="class"><span class="keyword">class</span> <span class="title">MongoClient</span><span class="params">(val host:String, val port:Int)</span> {</span>
  require(host != <span class="keyword">null</span>, <span class="string">"You have to provide a host name"</span>)
  <span class="keyword">private</span> <span class="keyword">val</span> underlying = <span class="keyword">new</span> Mongo(host, port)
  <span class="keyword">def</span> <span class="keyword">this</span>() = <span class="keyword">this</span>(<span class="string">"127.0.0.1"</span>, <span class="number">27017</span>)
  <span class="keyword">def</span> version = underlying.getVersion
  <span class="keyword">def</span> dropDB(name:String) = underlying.dropDatabase(name)
  <span class="keyword">def</span> createDB(name:String) = DB(underlying.getDB(name))
  <span class="keyword">def</span> db(name:String) = DB(underlying.getDB(name))
}

<span class="keyword">package</span> com.scalainaction.mongo
<span class="keyword">import</span> com.mongodb.{DB =&gt; MongoDB}
<span class="comment">// 私有构造器, 除了伴生对象能够访问</span>
<span class="class"><span class="keyword">class</span> <span class="title">DB</span> <span class="title">private</span><span class="params">(val underlying: MongoDB)</span> {</span>
  <span class="keyword">def</span> collectionNames = <span class="keyword">for</span>(name &lt;- <span class="keyword">new</span>
    JSetWrapper(underlying.getCollectionNames)) <span class="keyword">yield</span> name

}
<span class="class"><span class="keyword">object</span> <span class="title">DB</span> {</span>
  <span class="keyword">def</span> apply(underlying: MongDB) = <span class="keyword">new</span> DB(underlying)
}
</pre></td></tr></table></figure>

<p>case class 的 unapply</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
</pre></td><td class="code"><pre>object Person {
def apply(firstName:<span class="built_in">String</span>, lastName:<span class="built_in">String</span>) = {
  <span class="keyword">new</span> Person(firstName, lastName)
}
def unapply(p:Person): <span class="keyword">Option</span>[(<span class="built_in">String</span>, <span class="built_in">String</span>)] =
  Some((p.firstName, p.lastName))
}
</pre></td></tr></table></figure>

<h2 id="2">2</h2>
<p>The second user story you need to implement in your driver is an ability to create,
delete, and find documents in a MongoDB database.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
</pre></td><td class="code"><pre>
<span class="keyword">package</span> com.scalainaction.mongo
<span class="keyword">import</span> com.mongodb.{DBCollection =&gt; MongoDBColleciton}
<span class="keyword">import</span> com.mongodb.DBObject

<span class="class"><span class="keyword">class</span> <span class="title">DBCollection</span><span class="params">(override val underlying: MongoDBCollection)</span> <span class="keyword">extends</span> <span class="title">ReadOnly</span></span>

<span class="class"><span class="keyword">trait</span> <span class="title">ReadOnly</span> {</span>
  <span class="keyword">val</span> underlying:MongoDBCollection
  <span class="keyword">def</span> name = underlying getName
  <span class="keyword">def</span> fullName = underlying getFullName
  <span class="keyword">def</span> find(doc: DBObject) = underlying find doc
  <span class="keyword">def</span> findOne(doc: DBObject) = underlying findOne doc
  <span class="keyword">def</span> findOne = underlying findOne
  <span class="keyword">def</span> getCount(doc: DBObject) = underlying getCount doc
}

<span class="class"><span class="keyword">trait</span> <span class="title">Administrable</span> <span class="keyword">extends</span> <span class="title">ReadOnly</span> {</span>
  <span class="keyword">def</span> drop: Unit = underlying drop
  <span class="keyword">def</span> dropIndexes: Unit = underlying dropIndexes
}

<span class="class"><span class="keyword">trait</span> <span class="title">Updatable</span> <span class="keyword">extends</span> <span class="title">ReadOnly</span> {</span>
  <span class="keyword">def</span> -=(doc: DBObject): Unit = underlying remove doc
  <span class="keyword">def</span> +=(doc: DBObject): Unit = underlying save doc
}

<span class="class"><span class="keyword">trait</span> <span class="title">Memoizer</span> <span class="keyword">extends</span> <span class="title">ReadOnly</span> {</span>
  <span class="keyword">val</span> history = scala.collection.mutable.Map[Int, DBObject]()
  <span class="keyword">override</span> <span class="keyword">def</span> findOne = {
    history.getOrElseUpdate(-<span class="number">1</span>, { <span class="keyword">super</span>.findOne })
  }
  <span class="keyword">override</span> <span class="keyword">def</span> findOne(doc: DBObject) = {
    history.getOrElseUpdate(doc.hashCode, { <span class="keyword">super</span>.findOne(doc) })
  }
}


<span class="keyword">import</span> com.mongodb.{DB =&gt; MongoDB}
<span class="keyword">import</span> scala.collection.convert.Wrappers._
<span class="class"><span class="keyword">class</span> <span class="title">DB</span> <span class="title">private</span><span class="params">(val underlying: MongoDB)</span> {</span>
  <span class="keyword">private</span> <span class="keyword">def</span> collection(name: String) = underlying.getCollection(name)
  <span class="keyword">def</span> readOnlyCollection(name: String) =
      <span class="keyword">new</span> DBCollection(collection(name)) <span class="keyword">with</span> Memoizer
  <span class="keyword">def</span> administrableCollection(name: String) =
      <span class="keyword">new</span> DBCollection(collection(name)) <span class="keyword">with</span> Administrable <span class="keyword">with</span> Memoizer
  <span class="keyword">def</span> updatableCollection(name: String) =
      <span class="keyword">new</span> DBCollection(collection(name)) <span class="keyword">with</span> Updatable <span class="keyword">with</span> Memoizer
  <span class="keyword">def</span> collectionNames = <span class="keyword">for</span>(name &lt;- <span class="keyword">new</span>
    JSetWrapper(underlying.getCollectionNames)) <span class="keyword">yield</span> name
}
<span class="class"><span class="keyword">object</span> <span class="title">DB</span> {</span>
  <span class="keyword">def</span> apply(underlying: MongoDB) = <span class="keyword">new</span> DB(underlying)
}
</pre></td></tr></table></figure>

<h2 id="3">3</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre></td><td class="code"><pre><span class="keyword">sealed</span> <span class="class"><span class="keyword">trait</span> <span class="title">QueryOption</span></span>
<span class="keyword">case</span> <span class="class"><span class="keyword">object</span> <span class="title">NoOption</span> <span class="keyword">extends</span> <span class="title">QueryOption</span></span>
<span class="class"><span class="keyword">case</span> <span class="keyword">class</span> <span class="title">Sort</span><span class="params">(sorting: DBObject, anotherOption: QueryOption)</span></span>
    <span class="keyword">extends</span> QueryOption
<span class="class"><span class="keyword">case</span> <span class="keyword">class</span> <span class="title">Skip</span><span class="params">(number: Int, anotherOption: QueryOption)</span></span>
    <span class="keyword">extends</span> QueryOption
<span class="class"><span class="keyword">case</span> <span class="keyword">class</span> <span class="title">Limit</span><span class="params">(limit: Int, anotherOption: QueryOption)</span></span>
    <span class="keyword">extends</span> QueryOption

<span class="class"><span class="keyword">case</span> <span class="keyword">class</span> <span class="title">Query</span><span class="params">(q: DBObject, option: QueryOption = NoOption)</span> {</span>
  <span class="keyword">def</span> sort(sorting: DBObject) = Query(q, Sort(sorting, option))
  <span class="keyword">def</span> skip(skip: Int) = Query(q, Skip(skip, option))
  <span class="keyword">def</span> limit(limit: Int) = Query(q, Limit(limit, option))
}

<span class="class"><span class="keyword">trait</span> <span class="title">ReadOnly</span> {</span>
  <span class="keyword">val</span> underlying: MongoDBCollection
  <span class="keyword">def</span> name = underlying getName
  <span class="keyword">def</span> fullName = underlying getFullName
  <span class="keyword">def</span> find(query: Query): DBCursor = {
    <span class="keyword">def</span> applyOptions(cursor:DBCursor, option: QueryOption): DBCursor = {
      option <span class="keyword">match</span> {
        <span class="keyword">case</span> Skip(skip, next) =&gt; applyOptions(cursor.skip(skip), next)
        <span class="keyword">case</span> Sort(sorting, next)=&gt; applyOptions(cursor.sort(sorting), next)
        <span class="keyword">case</span> Limit(limit, next) =&gt; applyOptions(cursor.limit(limit), next)
        <span class="keyword">case</span> NoOption =&gt; cursor
      }
    }
    applyOptions(find(query.q), query.option)
  }
  <span class="keyword">def</span> find(doc: DBObject): DBCursor = underlying find doc
  <span class="keyword">def</span> findOne(doc: DBObject) = underlying findOne doc
  <span class="keyword">def</span> findOne = underlying findOne
  <span class="keyword">def</span> getCount(doc: DBObject) = underlying getCount doc
}
</pre></td></tr></table></figure>

  
	</div>
		<footer class="article-footer clearfix">

  <div class="article-tags">
  
  <span></span> <a href="/tags/scala/">scala</a>
  </div>




<div class="article-share" id="share">

  <div data-url="http://zhpooer.github.io/2014/07/12/scala-in-action-oop-in-scala/" data-title="Scala in Action-OOP in Scala | Poe&#39;s World" data-tsina="null" class="share clearfix">
  </div>

</div>
</footer>   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2014/07/13/传智播客day56-spring-mvc/" title="传智播客day56-Spring mvc">
  <strong>PREVIOUS:</strong><br/>
  <span>
  传智播客day56-Spring mvc</span>
</a>
</div>


<div class="next">
<a href="/2014/07/12/scala-in-action-scala-入门/"  title="Scala in Action-scala 入门">
 <strong>NEXT:</strong><br/> 
 <span>Scala in Action-scala 入门
</span>
</a>
</div>

</nav>

	
<section class="comment">
	<div class="ds-thread"></div>
</section>

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
  <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#-"><span class="toc-number">1.</span> <span class="toc-text">一些特性</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-_root_-"><span class="toc-number">1.1.</span> <span class="toc-text">的使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bean-"><span class="toc-number">1.2.</span> <span class="toc-text">bean方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#object-"><span class="toc-number">1.3.</span> <span class="toc-text">object 的工厂方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#package-object"><span class="toc-number">1.4.</span> <span class="toc-text">package object</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#trait"><span class="toc-number">1.5.</span> <span class="toc-text">trait</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#case-class"><span class="toc-number">1.6.</span> <span class="toc-text">case class</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#copy-constructor"><span class="toc-number">1.7.</span> <span class="toc-text">copy constructor</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#abstract-override"><span class="toc-number">1.8.</span> <span class="toc-text">abstract override</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sealed"><span class="toc-number">1.9.</span> <span class="toc-text">sealed</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#value-class"><span class="toc-number">2.</span> <span class="toc-text">Value Class</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#implicit"><span class="toc-number">3.</span> <span class="toc-text">implicit</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#demo-mongo"><span class="toc-number">4.</span> <span class="toc-text">DEMO: Mongo</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1"><span class="toc-number">4.1.</span> <span class="toc-text">1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2"><span class="toc-number">4.2.</span> <span class="toc-text">2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3"><span class="toc-number">4.3.</span> <span class="toc-text">3</span></a></li></ol>
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  

  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			<li><a href="/tags/AJAX/" title="AJAX">AJAX<sup>1</sup></a></li>
		
			<li><a href="/tags/Akka/" title="Akka">Akka<sup>1</sup></a></li>
		
			<li><a href="/tags/Android/" title="Android">Android<sup>1</sup></a></li>
		
			<li><a href="/tags/DOM/" title="DOM">DOM<sup>2</sup></a></li>
		
			<li><a href="/tags/EL表达式/" title="EL表达式">EL表达式<sup>1</sup></a></li>
		
			<li><a href="/tags/HBase/" title="HBase">HBase<sup>1</sup></a></li>
		
			<li><a href="/tags/Hadoop/" title="Hadoop">Hadoop<sup>1</sup></a></li>
		
			<li><a href="/tags/Hibernate/" title="Hibernate">Hibernate<sup>2</sup></a></li>
		
			<li><a href="/tags/HttpSession/" title="HttpSession">HttpSession<sup>1</sup></a></li>
		
			<li><a href="/tags/IO/" title="IO">IO<sup>1</sup></a></li>
		
			<li><a href="/tags/Illustrator/" title="Illustrator">Illustrator<sup>3</sup></a></li>
		
			<li><a href="/tags/JSP/" title="JSP">JSP<sup>1</sup></a></li>
		
			<li><a href="/tags/JavaBean/" title="JavaBean">JavaBean<sup>1</sup></a></li>
		
			<li><a href="/tags/JavaScript/" title="JavaScript">JavaScript<sup>1</sup></a></li>
		
			<li><a href="/tags/Mybatis/" title="Mybatis">Mybatis<sup>1</sup></a></li>
		
			<li><a href="/tags/NoSql/" title="NoSql">NoSql<sup>1</sup></a></li>
		
			<li><a href="/tags/SASS/" title="SASS">SASS<sup>1</sup></a></li>
		
			<li><a href="/tags/SAX/" title="SAX">SAX<sup>1</sup></a></li>
		
			<li><a href="/tags/ServletRequest/" title="ServletRequest">ServletRequest<sup>1</sup></a></li>
		
			<li><a href="/tags/ServletResponse/" title="ServletResponse">ServletResponse<sup>1</sup></a></li>
		
		</ul>
</div>


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<div class="social-font" class="clearfix">
		
		
		
		
	</div>
		<p class="copyright">Powered by <a href="http://zespia.tw/hexo/" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/A-limon/pacman" target="_blank" title="Pacman">Pacman</a> © 2015 
		
		<a href="http://zhpooer.github.io" target="_blank" title="zhpooer">zhpooer</a>
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top",Math.max(140,320-$(this).scrollTop()));
    });
  };
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});     
</script>


<script type="text/javascript">
  var duoshuoQuery = {short_name:"zhpoooer"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 





  </body>
</html>
