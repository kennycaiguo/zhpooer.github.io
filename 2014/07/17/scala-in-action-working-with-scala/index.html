
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>Scala in Action-working with scala | Poe&#39;s World</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
    
    <meta name="author" content="zhpooer">
    
    <meta name="description" content="Building web application
用户故事
You can move one more story from the ready phase to the
dev phase. A pair of developers looking for new work can select ">
    
    
    
    
    <link rel="alternative" href="/atom.xml" title="Poe&#39;s World" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/pacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/pacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

  <body>
    <header>
      <div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.svg" alt="Poe&#39;s World" title="Poe&#39;s World"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Poe&#39;s World">Poe&#39;s World</a></h1>
				<h2 class="blog-motto">竹杖芒鞋轻胜马，一蓑烟雨任平生</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">主页</a></li>
					
						<li><a href="/english-monthly">英语角</a></li>
					
						<li><a href="/about">关于</a></li>
					
						<li><a href="/archives">归档</a></li>
					
					<li>
					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="text" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:zhpooer.github.io">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>

    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2014/07/17/scala-in-action-working-with-scala/" title="Scala in Action-working with scala" itemprop="url">Scala in Action-working with scala</a>
  </h1>
  <p class="article-author">By
    
      <a href="http://zhpooer.github.io" title="zhpooer">zhpooer</a>
    </p>
  <p class="article-time">
    <time datetime="2014-07-17T03:35:34.000Z" itemprop="datePublished">7月 17 2014</time>
    更新日期:<time datetime="2014-07-19T08:24:43.000Z" itemprop="dateModified">7月 19 2014</time>
    
  </p>
</header>
	<div class="article-content">
		
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#building-web-application"><span class="toc-number">1.</span> <span class="toc-text">Building web application</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-"><span class="toc-number">1.1.</span> <span class="toc-text">用户故事</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sbt"><span class="toc-number">1.2.</span> <span class="toc-text">sbt</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#seting-up"><span class="toc-number">1.3.</span> <span class="toc-text">Seting up</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#introducing-scalaz-module"><span class="toc-number">1.4.</span> <span class="toc-text">introducing scalaz module</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#database"><span class="toc-number">1.5.</span> <span class="toc-text">database</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-page"><span class="toc-number">1.6.</span> <span class="toc-text">web page</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#moving-cards-in-the-kanban-board"><span class="toc-number">1.7.</span> <span class="toc-text">Moving cards in the Kanban board</span></a></li></ol>
		</div>
		
		<h1 id="building-web-application">Building web application</h1>
<h2 id="-">用户故事</h2>
<p>You can move one more story from the ready phase to the
dev phase. A pair of developers looking for new work can select a card from the ready
phase and move that card to the dev phase. Once the development work is done, the
card moves to the test phase where, in this stage, a tester, business analyst, or other
members of the team will verify the work against the user story. When the story is
approved or verified, it’s moved to the deploy phase, which means it’s ready for pro-
duction deployment. This is how a card (work) flows through the system.</p>
<ul>
<li>As a customer, I want to create a new user story so I can add stories to the ready phase.</li>
<li>As a developer, I want to move cards (stories) from one phase to another so I can signal
progress.</li>
</ul>
<h2 id="sbt">sbt</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
</pre></td><td class="code"><pre>// The following expression will <span class="operator"><span class="keyword">create</span> a Setting[String] setting:
&gt; <span class="keyword">set</span> name := <span class="string">"Testing SBT"</span>
[info] Reapplying settings...
[info] <span class="keyword">Set</span> <span class="keyword">current</span> project <span class="keyword">to</span> Testing SBT
&gt; <span class="keyword">set</span> version := <span class="string">"1.0"</span>
[info] Reapplying settings...
[info] <span class="keyword">Set</span> <span class="keyword">current</span> project <span class="keyword">to</span> Testing SBT
&gt; <span class="keyword">session</span> save</span>
</pre></td></tr></table></figure>

<p>Settings are the way SBT stores the build definition. A build definition defines a list
of Setting[T] where Setting[T] is a transformation affecting SBT’s key value pair.
A Setting is created assigning value to SettingKey. There are three kinds of keys
in the SBT:</p>
<ul>
<li>SettingKey[T] is a key with a value computed only once. Examples are
name or scalaVersion.</li>
<li>TaskKey[T] is a key with a value that has to be recomputed each time.
TaskKey is used to create tasks. Examples are compile and package.</li>
<li>InputTask[T] is a task key which takes command-line arguments as input.</li>
</ul>
<p>All the available keys are defined in the sbt.Keys object, and it’s automatically
imported for you in the build.sbt file.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>scalacOptions ++= Se<span class="string">q("-unchecked", "-deprecation")</span>
</pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>$ mkdir -p src/<span class="list">{main,test}</span>/<span class="list">{scala,java,resources}</span> lib project
</pre></td></tr></table></figure>

<p>The third option is to use giter8 (<a href="https://github.com/n8han/giter8" target="_blank">https://github.com/n8han/giter8</a>). It’s a com-
mand-line tool to generate files and directories from templates published in Github.
This is slowly becoming a standard way of creating projects in Scala. Once giter8 is
installed, you can choose a template to generate the project structure.</p>
<p><img src="/img/sbt_struct.png" alt="sbt project struct"></p>
<p>SBT project structure is recursive. The project directory is another project inside your
project that knows how to build your project.</p>
<p>The following is how you define dependency in SBT :
<code>groupID % artifactID % version</code></p>
<p>If you use %% after groupID, SBT will add the Scala version of the proj-
ect to the artifact ID.</p>
<p>SBT can read the dependencies defined in the
POM file if you use the externalPom() method in your build file.</p>
<p>Alternatively, you can create a project definition file configured to use a local Maven
repository:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre>resolvers += <span class="string">"Local Maven Repository"</span> at
<span class="string">"file://"</span>+<span class="keyword">Path</span>.userHome+<span class="string">"/.m2/repository"</span>
</pre></td></tr></table></figure>

<p>Here’s how
the build.sbt looks after all the changes:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="code"><pre>scalaVersion := <span class="string">"2.10.0"</span>

<span class="property">name</span> := <span class="string">"Testing SBT"</span>

<span class="property">version</span> := <span class="string">"1.0"</span>

scalacOptions ++= Seq(<span class="string">"-unchecked"</span>, <span class="string">"-deprecation"</span>)

libraryDependencies ++= Seq(
  <span class="string">"org.eclipse.jetty"</span> % <span class="string">"jetty-server"</span> % <span class="string">"7.0.0.RC2"</span>,
  <span class="string">"org.scala-tools.testing"</span> % <span class="string">"specs"</span> % <span class="string">"1.6.2"</span> % <span class="string">"test"</span>)
</pre></td></tr></table></figure>

<p>Another common thing you can do with SBT is create custom tasks for the project. For
custom tasks, the .scala build definition file is used because the .sbt build file doesn’t
support it. To create custom tasks follow these steps:</p>
<ul>
<li>Create a TaskKey .</li>
<li>Provide a value for the TaskKey .</li>
<li>Put the task in the .scala build file under project.</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="code"><pre><span class="keyword">import</span> sbt._
<span class="keyword">import</span> Keys._

<span class="class"><span class="keyword">object</span> <span class="title">ExampleBuild</span> <span class="keyword">extends</span> <span class="title">Build</span> {</span>
  <span class="keyword">val</span> hello = TaskKey [Unit](<span class="string">"hello"</span>, <span class="string">"Prints 'Hello World'"</span>)
  <span class="keyword">val</span> helloTask: Setting[Task[Unit]] = hello := {
    println(<span class="string">"Hello World"</span>)
  }
  <span class="keyword">val</span> project = Project (
    <span class="string">"example"</span>,
    file (<span class="string">"."</span>)).settings(helloTask)
}
</pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
</pre></td><td class="code"><pre>// console-project
scala&gt; get(name)
<span class="label">res2:</span> String = Testing SBT
scala&gt; get(scalaVersion)
<span class="label">res3:</span> String = <span class="number">2.10</span><span class="number">.0</span>
scala&gt; runTask(hello, currentState)
Hello World
<span class="label">res11:</span> (sbt<span class="preprocessor">.State</span>, Unit) = (sbt<span class="preprocessor">.State</span><span class="localvars">@4</span>fae46d5,())
</pre></td></tr></table></figure>

<h2 id="seting-up">Seting up</h2>
<p>In <code>project/build.properties</code> sets <code>sbt.version=0.12.0</code></p>
<p><code>build.sbt</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre>name := <span class="string">"weKanban"</span>

organization := <span class="string">"scalainaction"</span>

version := <span class="string">"0.1"</span>

scalaVersion := <span class="string">"2.10.0"</span>

scalacOptions ++= Se<span class="string">q("-unchecked", "-deprecation")</span>
</pre></td></tr></table></figure>

<p>Remember to separate each setting expression with an empty new line so that SBT can
parse each expression .sbt file. </p>
<p><code>project/plugins.sbt</code>. This plug-in adds tasks to the SBT build to start and stop the
web server. </p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre>libraryDependencies &lt;+= sbtVersion {v =&gt;
  <span class="string">"com.github.siasia"</span> <span class="string">%% "xsbt-web-plugin" %</span> (v+<span class="string">"-0.2.11.1"</span>)
}
</pre></td></tr></table></figure>

<p>The <code>&lt;+=</code> method allows you to compute a new list element from other keys.</p>
<p>build.sbt:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre>libraryDependencies ++=
 Seq(
  <span class="string">"org.eclipse.jetty"</span> %
    <span class="string">"jetty-servlet"</span> % <span class="string">"7.3.0.v20110203"</span> % <span class="string">"container"</span>,
  <span class="string">"org.eclipse.jetty"</span> %
    <span class="string">"jetty-webapp"</span> % <span class="string">"7.3.0.v20110203"</span> % <span class="string">"test, container"</span>,
  <span class="string">"org.eclipse.jetty"</span> %
    <span class="string">"jetty-server"</span> % <span class="string">"7.3.0.v20110203"</span> % <span class="string">"container"</span>
)
</pre></td></tr></table></figure>

<p>Additionally, jetty-web is added into test scope.
The scope allows SBT keys to have values in more than one context.
This is useful for plug-ins because scoping allows plug-ins to
create tasks that don’t conflict with other task names. </p>
<p>To include all the tasks from the plug-in to your project,
you have to import the settings from the plug-in project into
your build.sbt file as follows:
<code>seq(com.github.siasia.WebPlugin.webSettings :_*)</code></p>
<p>To start the web server, run the container:<code>start task</code>,
and it will start the Jetty server at port number 8080</p>
<h2 id="introducing-scalaz-module">introducing scalaz module</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
</pre></td><td class="code"><pre>trait Application[IN[<span class="emphasis">_], OUT[_</span>]] {
  def apply(implicit req: Request[IN]): Response[OUT]
}

object Application {
  def application[<span class="link_label">IN[_</span>], OUT[<span class="link_label">_</span>]](f: Request[IN] =&gt; Response[OUT])
<span class="code">    = new Application[IN,OUT] {</span>
<span class="code">        def apply(implicit req: Request[IN]) = f(req)</span>
<span class="code">      }</span>
}
</pre></td></tr></table></figure>

<p><code>build.sbt</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
</pre></td><td class="code"><pre>libraryDependencies ++= <span class="constant">Seq</span>(
  <span class="string">"org.scalaz"</span> <span class="string">%% "scalaz-core" %</span> <span class="string">"6.0.3"</span>,
  <span class="string">"org.scalaz"</span> <span class="string">%% "scalaz-http" %</span> <span class="string">"6.0.3"</span>,
  <span class="string">"org.eclipse.jetty"</span> % <span class="string">"jetty-servlet"</span> % <span class="string">"7.3.0.v20110203"</span> % <span class="string">"container"</span>,
  <span class="string">"org.eclipse.jetty"</span> % <span class="string">"jetty-webapp"</span> % <span class="string">"7.3.0.v20110203"</span> % <span class="string">"test, container"</span>,
  <span class="string">"org.eclipse.jetty"</span> % <span class="string">"jetty-server"</span> % <span class="string">"7.3.0.v20110203"</span> % <span class="string">"container"</span>
)
</pre></td></tr></table></figure>

<p><code>web.xml</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="code"><pre><span class="tag">&lt;<span class="title">web-app</span>&gt;</span>
  <span class="tag">&lt;<span class="title">servlet</span>&gt;</span>
    <span class="tag">&lt;<span class="title">servlet-name</span>&gt;</span>Scalaz<span class="tag">&lt;/<span class="title">servlet-name</span>&gt;</span>
   <span class="comment">&lt;!-- This servlet will create both a request
        and response of type scala.collection.Stream --&gt;</span>
    <span class="tag">&lt;<span class="title">servlet-class</span>&gt;</span>
      scalaz.http.servlet.StreamStreamServlet
    <span class="tag">&lt;/<span class="title">servlet-class</span>&gt;</span>
    <span class="tag">&lt;<span class="title">init-param</span>&gt;</span>
      <span class="tag">&lt;<span class="title">param-name</span>&gt;</span>application<span class="tag">&lt;/<span class="title">param-name</span>&gt;</span>
      <span class="tag">&lt;<span class="title">param-value</span>&gt;</span>
        com.kanban.application.WeKanbanApplication
       <span class="tag">&lt;/<span class="title">param-value</span>&gt;</span>
      <span class="tag">&lt;/<span class="title">init-param</span>&gt;</span>
  <span class="tag">&lt;/<span class="title">servlet</span>&gt;</span>
  <span class="tag">&lt;<span class="title">servlet-mapping</span>&gt;</span>
    <span class="tag">&lt;<span class="title">servlet-name</span>&gt;</span>Scalaz<span class="tag">&lt;/<span class="title">servlet-name</span>&gt;</span>
    <span class="tag">&lt;<span class="title">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="title">url-pattern</span>&gt;</span>
  <span class="tag">&lt;/<span class="title">servlet-mapping</span>&gt;</span>
<span class="tag">&lt;/<span class="title">web-app</span>&gt;</span>
</pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="code"><pre><span class="comment">// StreamStreamServletApplication to create your application</span>
<span class="comment">// class because it’s enforced by the</span>
<span class="comment">// Scalaz servlet you’re using to handle all the HTTP request and response. </span>
<span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">WeKanbanApplication</span> <span class="keyword">extends</span> <span class="title">StreamStreamServletApplication</span> {</span>

  <span class="keyword">val</span> application = <span class="keyword">new</span> ServletApplication[Stream, Stream] {
  <span class="keyword">def</span> application(implicit servlet: HttpServlet,
    servletRequest: HttpServletRequest,
    request: Request[Stream]) = {
      <span class="keyword">def</span> found(x: Iterator[Byte]) : Response[Stream] = OK &lt;&lt; x.toStream
      HttpServlet.resource(found, NotFound.xhtml)
    }
  }
}
</pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre><span class="tag">&lt;<span class="title">html</span>&gt;</span>
  <span class="tag">&lt;<span class="title">body</span>&gt;</span>
    <span class="tag">&lt;<span class="title">h1</span>&gt;</span>weKanban board will come shortly<span class="tag">&lt;/<span class="title">h1</span>&gt;</span>
  <span class="tag">&lt;/<span class="title">body</span>&gt;</span>
<span class="tag">&lt;/<span class="title">html</span>&gt;</span>
</pre></td></tr></table></figure>

<h2 id="database">database</h2>
<p>add dependencies</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre><span class="string">"com.h2database"</span> % <span class="string">"h2"</span> % <span class="string">"1.2.137"</span>,
<span class="string">"org.squeryl"</span> % <span class="string">"squeryl_2.10"</span> % <span class="string">"0.9.5-6"</span>
</pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre><span class="class"><span class="keyword">class</span> <span class="title">Story</span><span class="params">(val number: String, val title: String, val phase: String)</span></span>

<span class="keyword">package</span> com.kanban.models
<span class="keyword">import</span> org.squeryl._
<span class="comment">//  defines the schema with a table</span>
<span class="comment">// called “STORIES” for your Story class</span>
<span class="class"><span class="keyword">object</span> <span class="title">KanbanSchema</span> <span class="keyword">extends</span> <span class="title">Schema</span> {</span>
  <span class="keyword">val</span> stories = table[Story](<span class="string">"STORIES"</span>)
}
</pre></td></tr></table></figure>

<p>run h2base by hand</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>java -<span class="keyword">cp</span> ~/<span class="preprocessor">.ivy</span>2/cache/<span class="keyword">com</span><span class="preprocessor">.h</span>2database/h2/jars/h2*<span class="preprocessor">.jar</span> org<span class="preprocessor">.h</span>2<span class="preprocessor">.tools</span><span class="preprocessor">.Server</span>
</pre></td></tr></table></figure>

<p>or write task in <code>build.scala</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
</pre></td><td class="code"><pre><span class="keyword">import</span> sbt._
<span class="keyword">import</span> Keys._
<span class="class"><span class="keyword">object</span> <span class="title">H2TaskManager</span> {</span>
  <span class="keyword">var</span> process: Option[Process] = None
  <span class="comment">// creates a new config name “h2” and extends the Compile config</span>
  <span class="comment">// The Compile config will provide the necessary</span>
  <span class="comment">// classpath setting you need to run the tasks.</span>
  <span class="keyword">lazy</span> <span class="keyword">val</span> H2 = config(<span class="string">"h2"</span>) extend(Compile)
  <span class="keyword">val</span> startH2 = TaskKey[Unit](<span class="string">"start"</span>, <span class="string">"Starts H2 database"</span>)
  <span class="comment">// &lt;&lt;= method in SBT helps to create a</span>
  <span class="comment">//  new setting that depends on other settings.</span>
  <span class="keyword">val</span> startH2Task = startH2 in H2 &lt;&lt;= (fullClasspath in Compile) map {
    cp =&gt;
      startDatabase {
        cp.map(_.data)
        .map(_.getAbsolutePath())
        .filter(_.contains(<span class="string">"h2database"</span>))
      }
  }
  
  <span class="keyword">def</span> startDatabase(paths: Seq[String]) = {
    process <span class="keyword">match</span> {
      <span class="keyword">case</span> None =&gt;
        <span class="keyword">val</span> cp = paths.mkString(System.getProperty(<span class="string">"path.separator"</span>))
        <span class="keyword">val</span> command = <span class="string">"java -cp "</span> + cp + <span class="string">" org.h2.tools.Server"</span>
        println(<span class="string">"Starting Database with command: "</span> + command)
        process = Some(Process(command).run())
        println(<span class="string">"Database started ! "</span>)
      <span class="keyword">case</span> Some(_) =&gt;
        println(<span class="string">"H2 Database already started"</span>)
    }
  }
  <span class="keyword">val</span> stopH2 = TaskKey[Unit](<span class="string">"stop"</span>, <span class="string">"Stops H2 database"</span>)
  <span class="keyword">val</span> stopH2Task = stopH2 in H2 :={
    process <span class="keyword">match</span> {
      <span class="keyword">case</span> None =&gt; println(<span class="string">"Database already stopped"</span>)
      <span class="keyword">case</span> Some(_) =&gt;
        println(<span class="string">"Stopping database..."</span>)
        process.foreach{_.destroy()}
        process = None
        println(<span class="string">"Database stopped..."</span>)
    }
  }
}
<span class="class"><span class="keyword">object</span> <span class="title">MainBuild</span> <span class="keyword">extends</span> <span class="title">Build</span> {</span>
  <span class="keyword">import</span> H2TaskManager._
  <span class="keyword">lazy</span> <span class="keyword">val</span> scalazVersion = <span class="string">"6.0.3"</span>
  <span class="keyword">lazy</span> <span class="keyword">val</span> jettyVersion = <span class="string">"7.3.0.v20110203"</span>
  
  <span class="keyword">lazy</span> <span class="keyword">val</span> wekanban = Project( <span class="string">"wekanban"</span>,
      file(<span class="string">"."</span>)).settings(startH2Task, stopH2Task)
}
</pre></td></tr></table></figure>

<p>Change to this</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre>libraryDependencies ++= <span class="constant">Seq</span>(
  <span class="string">"org.scalaz"</span> <span class="string">%% "scalaz-core" %</span> scalazVersion,
  <span class="string">"org.scalaz"</span> <span class="string">%% "scalaz-http" %</span> scalazVersion,
  <span class="string">"org.eclipse.jetty"</span> % <span class="string">"jetty-servlet"</span> % jettyVersion % <span class="string">"container"</span>,
  <span class="string">"org.eclipse.jetty"</span> % <span class="string">"jetty-webapp"</span> % jettyVersion % <span class="string">"test, container"</span>,
  <span class="string">"org.eclipse.jetty"</span> % <span class="string">"jetty-server"</span> % jettyVersion % <span class="string">"container"</span>,
  <span class="string">"com.h2database"</span> % <span class="string">"h2"</span> % <span class="string">"1.2.137"</span>,
  <span class="string">"org.squeryl"</span> % <span class="string">"squeryl_2.10"</span> % <span class="string">"0.9.5-6"</span>
)
</pre></td></tr></table></figure>

<p>browser <code>http://localhost:8082</code> to set h2base
    JDBC Driver class: org.h2.Driver
     Database URL: jdbc:h2:tcp://localhost/~/test
     User name: sa</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre></td><td class="code"><pre><span class="keyword">package</span> com.kanban.models
<span class="keyword">import</span> org.squeryl._
<span class="keyword">import</span> org.squeryl.adapters._
<span class="keyword">import</span> org.squeryl.PrimitiveTypeMode._
<span class="keyword">import</span> java.sql.DriverManager
<span class="class"><span class="keyword">object</span> <span class="title">KanbanSchema</span> <span class="keyword">extends</span> <span class="title">Schema</span> {</span>
  <span class="keyword">val</span> stories = table[Story](<span class="string">"STORIES"</span>)
  <span class="keyword">def</span> init = {
    <span class="keyword">import</span> org.squeryl.SessionFactory
    Class.forName(<span class="string">"org.h2.Driver"</span>)
<span class="comment">// The Squeryl Session instance provides additional methods</span>
<span class="comment">// like log and methods for binding/unbinding the session to the current thread. </span>
    <span class="keyword">if</span>(SessionFactory.concreteFactory.isEmpty) {
      SessionFactory.concreteFactory = Some(()=&gt;
        Session.create(
          DriverManager.getConnection(<span class="string">"jdbc:h2:tcp://localhost/~/test"</span>,
          <span class="string">"sa"</span>, <span class="string">""</span>), <span class="keyword">new</span> H2Adapter))
    }
  }
  <span class="keyword">def</span> tx[A](a: =&gt;A): A = {
    init
    inTransaction(a)
  }
}

<span class="keyword">def</span> main(args: Array[String]) {
  println(<span class="string">"initializing the weKanban schema"</span>)
  init
  inTransaction { drop ; create }
}
</pre></td></tr></table></figure>

<p>加入检查, 和保存操作</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre></td><td class="code"><pre><span class="keyword">package</span> com.kanban.models
<span class="keyword">import</span> org.squeryl._
<span class="keyword">import</span> org.squeryl.PrimitiveTypeMode._
<span class="keyword">import</span> org.squeryl.annotations._
<span class="keyword">import</span> KanbanSchema._
<span class="class"><span class="keyword">class</span> <span class="title">Story</span><span class="params">(val number: String, val title: String, val phase: String)</span>{</span>
  <span class="keyword">private</span>[<span class="keyword">this</span>] <span class="keyword">def</span> validate = {
    <span class="keyword">if</span>(number.isEmpty || title.isEmpty) {
      <span class="keyword">throw</span> <span class="keyword">new</span> ValidationException (<span class="string">"Both number and title are required"</span>)
    }
    <span class="keyword">if</span>(!stories.where(a =&gt; a.number === number).isEmpty) {
      <span class="keyword">throw</span> <span class="keyword">new</span> ValidationException (<span class="string">"The story number is not unique"</span>)
    }
  }
  <span class="keyword">def</span> save(): Either[Throwable, String] = {
    tx {
      <span class="keyword">try</span> {
        validate
        stories.insert(<span class="keyword">this</span>)
        Right(<span class="string">"Story is created successfully"</span>)
      } <span class="keyword">catch</span> {
        <span class="keyword">case</span> exception: Throwable =&gt; Left(exception)
      }
    }
  }
}
<span class="class"><span class="keyword">object</span> <span class="title">Story</span> {</span>
  <span class="keyword">def</span> apply(number: String, title: String) =
  <span class="keyword">new</span> Story(number, title, <span class="string">"ready"</span>)
}
<span class="class"><span class="keyword">class</span> <span class="title">ValidationException</span><span class="params">(message: String)</span> <span class="keyword">extends</span></span>
    RuntimeException(message)
</pre></td></tr></table></figure>

<h2 id="web-page">web page</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
</pre></td><td class="code"><pre><span class="keyword">package</span> com.kanban.views
<span class="class"><span class="keyword">object</span> <span class="title">CreateStory</span> {</span>
  <span class="keyword">def</span> apply(message: String = <span class="string">""</span>) =
    &lt;html&gt; TODO <span class="number">7.1</span><span class="number">.2</span>
    &lt;/html&gt;
}
</pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
</pre></td><td class="code"><pre><span class="keyword">import</span>
<span class="keyword">import</span> scalaz._
<span class="keyword">import</span> Scalaz._
<span class="keyword">import</span> scalaz.http._
<span class="keyword">import</span> response._
<span class="keyword">import</span> request._
<span class="keyword">import</span> servlet._
<span class="keyword">import</span> HttpServlet._
<span class="keyword">import</span> Slinky._
<span class="keyword">import</span> com.kanban.views._
<span class="keyword">import</span> com.kanban.models._
<span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">WeKanbanApplication</span> <span class="keyword">extends</span> <span class="title">StreamStreamServletApplication</span> {</span>
  <span class="keyword">import</span> Request._
  <span class="keyword">import</span> Response._
  implicit <span class="keyword">val</span> charset = UTF8

  <span class="comment">// To read POST parameters from the request</span>
  <span class="comment">// use ! POST generally means a side-effect</span>
  <span class="keyword">def</span> param_!(name: String)(implicit request: Request[Stream]) =
    (request | name).getOrElse(List[Char]()).mkString(<span class="string">""</span>)

  <span class="comment">// return parameter value as string</span>
  <span class="keyword">def</span> param(name: String)(implicit request: Request[Stream]) =
    (request ! name).getOrElse(List[Char]()).mkString(<span class="string">""</span>)

  <span class="keyword">def</span> handle(implicit request: Request[Stream],
     servletRequest: HttpServletRequest): Option[Response[Stream]] = {
    request <span class="keyword">match</span> {
      <span class="keyword">case</span> MethodParts(GET, <span class="string">"card"</span> :: <span class="string">"create"</span> :: Nil) =&gt;
        Some(OK(ContentType, <span class="string">"text/html"</span>) &lt;&lt; strict &lt;&lt;
        CreateStory(param(<span class="string">"message"</span>)))
      <span class="keyword">case</span> MethodParts(POST, <span class="string">"card"</span> :: <span class="string">"save"</span> :: Nil) =&gt;
        Some(saveStory)
      <span class="keyword">case</span> MethodParts(GET, <span class="string">"kanban"</span> :: <span class="string">"board"</span> :: Nil) =&gt;
        Some(OK(ContentType, <span class="string">"text/html"</span>) &lt;&lt; transitional &lt;&lt; KanbanBoard())
      <span class="keyword">case</span> _ =&gt; None
    }
  }

  <span class="keyword">private</span> <span class="keyword">def</span> saveStory(implicit request: Request[Stream],
        servletRequest: HttpServletRequest) = {
    <span class="keyword">val</span> title = param_!(<span class="string">"title"</span>)
    <span class="keyword">val</span> number = param_!(<span class="string">"storyNumber"</span>)
    Story(number, title).save <span class="keyword">match</span> {
      <span class="keyword">case</span> Right(message) =&gt;
        redirects[Stream, Stream](<span class="string">"/card/create"</span>, (<span class="string">"message"</span>, message))
      <span class="keyword">case</span> Left(error) =&gt; OK(ContentType, <span class="string">"text/html"</span>) &lt;&lt; strict &lt;&lt;
        CreateStory(error.toString)
    }
}

  <span class="comment">// The Scalaz core provides a method called | for the Option class and</span>
  <span class="comment">// using it you can combine both handle and resource methods so that when the han-</span>
  <span class="comment">// dle method returns None you can invoke the resource method as a fallback to load</span>
  <span class="comment">// resources. </span>
  <span class="keyword">val</span> application = <span class="keyword">new</span> ServletApplication[Stream, Stream] {
    <span class="keyword">def</span> application(implicit servlet: HttpServlet,
        servletRequest: HttpServletRequest, request: Request[Stream]) = {
      <span class="keyword">def</span> found(x: Iterator[Byte]) : Response[Stream] = OK &lt;&lt; x.toStream
      handle | resource(found, NotFound.xhtml)
    }

  }
}
</pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre></td><td class="code"><pre><span class="comment">// Implementing drag-and-drop for the weKanban board in the main.js file</span>
  
<span class="function"><span class="keyword">function</span> <span class="title">moveCard</span><span class="params">(storyNumber, phase)</span> {</span>
  $.post(<span class="string">"/card/move"</span>,{storyNumber: storyNumber, phase: phase},
    <span class="function"><span class="keyword">function</span><span class="params">(message)</span> {</span>
      $(<span class="string">'#message'</span>).html(message)
    });
  }
  <span class="function"><span class="keyword">function</span> <span class="title">init</span><span class="params">()</span> {</span>
    $(<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
      $(<span class="string">".story"</span>).each(<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
        $(<span class="keyword">this</span>).draggable();
      });
    $(<span class="string">"#readyPhase"</span>).droppable({
      drop: <span class="function"><span class="keyword">function</span><span class="params">(event, ui)</span> {</span>
        moveCard(ui.draggable.attr(<span class="string">"id"</span>), <span class="string">"ready"</span>) }
    });
    $(<span class="string">"#devPhase"</span>).droppable({
      drop: <span class="function"><span class="keyword">function</span><span class="params">(event, ui)</span> {</span>
      moveCard(ui.draggable.attr(<span class="string">"id"</span>), <span class="string">"dev"</span>) }
    });
    $(<span class="string">"#testPhase"</span>).droppable({
      drop: <span class="function"><span class="keyword">function</span><span class="params">(event, ui)</span> {</span>
        moveCard(ui.draggable.attr(<span class="string">"id"</span>),
          <span class="string">"test"</span>) }
    });
    $(<span class="string">"#deployPhase"</span>).droppable({
      drop: <span class="function"><span class="keyword">function</span><span class="params">(event, ui)</span> {</span>
        moveCard(ui.draggable.attr(<span class="string">"id"</span>),
          <span class="string">"deploy"</span>) }
    });
  });
}
</pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
</pre></td><td class="code"><pre><span class="regexp">//</span> story model
<span class="regexp">//</span> At <span class="keyword">this</span> point Squeryl has only created the query—it hasn’t executed it <span class="keyword">in</span> the database. It will execute the query the
<span class="regexp">//</span> moment you <span class="keyword">try</span> to access the first element <span class="keyword">in</span> the collection.
<span class="regexp">//</span>  <span class="keyword">by</span> invoking the map method, so that you access these instances <span class="keyword">of</span> Story objects outside the transaction
def findAllByPhase(<span class="attribute">phase</span>: String) = tx {
  from(stories)(s<span class="function"> =&gt;</span> where(s.phase === phase) select(s)) map(s<span class="function"> =&gt;</span> s)
}
</pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre></td><td class="code"><pre>package com.kanban.views
import com.kanban.models._
<span class="comment">// To create the view for the Kanban board</span>
object KanbanBoard {
    <span class="keyword">private</span> def header =
      &lt;head&gt;
        &lt;meta charset=<span class="string">"UTF-8"</span> /&gt;
        &lt;title&gt;weKanban: A simple Kanban board&lt;/title&gt;
        &lt;script <span class="class"><span class="keyword">type</span>=</span><span class="string">"text/javascript"</span> src=<span class="string">"/js/jquery-1.4.2.js"</span>/&gt;
        &lt;script <span class="class"><span class="keyword">type</span>=</span><span class="string">"text/javascript"</span> src=<span class="string">"/js/jquery.ui.core.js"</span>/&gt;
        &lt;script <span class="class"><span class="keyword">type</span>=</span><span class="string">"text/javascript"</span> src=<span class="string">"/js/jquery.ui.widget.js"</span>/&gt;
        &lt;script <span class="class"><span class="keyword">type</span>=</span><span class="string">"text/javascript"</span> src=<span class="string">"/js/jquery.ui.mouse.js"</span>/&gt;
        &lt;script <span class="class"><span class="keyword">type</span>=</span><span class="string">"text/javascript"</span> src=<span class="string">"/js/jquery.ui.draggable.js"</span>/&gt;
        &lt;script <span class="class"><span class="keyword">type</span>=</span><span class="string">"text/javascript"</span> src=<span class="string">"/js/jquery.ui.droppable.js"</span>/&gt;
        &lt;script <span class="class"><span class="keyword">type</span>=</span><span class="string">"text/javascript"</span> src=<span class="string">"/js/main.js"</span>/&gt;
        &lt;link <span class="class"><span class="keyword">type</span>=</span><span class="string">"text/css"</span> href=<span class="string">"/css/main.css"</span> rel=<span class="string">"stylesheet"</span> /&gt;
        &lt;script <span class="class"><span class="keyword">type</span>=</span><span class="string">"text/javascript"</span>&gt;
          init()
        &lt;/script&gt;
      &lt;/head&gt;
    <span class="comment">// 7.10, P216</span>
    def apply() =
      &lt;html&gt;
        &lt;head&gt; {header}&lt;/head&gt;
      &lt;/html&gt;
    <span class="keyword">private</span> def stories(phase: String) =
      <span class="keyword">for</span>(story &lt;- Story.findAllByPhase(phase)) <span class="keyword">yield</span>
        &lt;div id={story.number} <span class="keyword">class</span>=<span class="string">"story"</span>&gt;
          &lt;fieldset&gt;
          &lt;legend&gt;{story.number}&lt;/legend&gt;
            &lt;div <span class="keyword">class</span>=<span class="string">"section"</span>&gt;
              &lt;label&gt;{story.title}&lt;/label&gt;
            &lt;/div&gt;
          &lt;/fieldset&gt;
        &lt;/div&gt;
}
</pre></td></tr></table></figure>

<h2 id="moving-cards-in-the-kanban-board">Moving cards in the Kanban board</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre></td><td class="code"><pre><span class="regexp">//</span> <span class="keyword">in</span> Story Class
private def phaseLimits = Map(<span class="string">"ready"</span><span class="function"> -&gt;</span> Some(<span class="number">3</span>),
  <span class="string">"dev"</span><span class="function"> -&gt;</span> Some(<span class="number">2</span>), <span class="string">"test"</span><span class="function"> -&gt;</span> Some(<span class="number">2</span>), <span class="string">"deploy"</span><span class="function"> -&gt;</span> None)

private[<span class="keyword">this</span>] def validateLimit(<span class="attribute">phase</span>: String) = {
  val <span class="attribute">currentSize</span>:Long =
    from(stories)(s<span class="function"> =&gt;</span> where(s.phase === phase) compute(count))
  <span class="keyword">if</span>(currentSize == phaseLimits(phase).getOrElse(-<span class="number">1</span>)) {
    <span class="keyword">throw</span> <span class="keyword">new</span> ValidationException(<span class="string">"You cannot exceed the limit set for
      the phase."</span>)
  }
}

def findByNumber(<span class="attribute">number</span>: String) =
  tx { stories.where(s<span class="function"> =&gt;</span> s.number === number).single }
  
def moveTo(<span class="attribute">phase</span>: String): Either[Throwable, String] = {
  tx {
    <span class="keyword">try</span> {
      validateLimit(phase)
      update(stories)(s<span class="function"> =&gt;</span>
        where(s.number === <span class="keyword">this</span>.number)
        set(s.phase := phase)
      )
      Right(<span class="string">"Card "</span> + <span class="keyword">this</span>.number + <span class="string">" is moved to "</span> + phase
           + <span class="string">" phase
           successfully."</span>)
    } <span class="keyword">catch</span> {
      <span class="reserved">case</span> <span class="attribute">exception</span>: Throwable<span class="function"> =&gt;</span> Left(exception)
    }
  }
}
</pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
</pre></td><td class="code"><pre><span class="comment">// main.js</span>
<span class="function"><span class="keyword">function</span> <span class="title">moveCard</span><span class="params">(storyNumber, phase)</span> {</span>
  $.post(<span class="string">"/card/move"</span>, {storyNumber: storyNumber, phase: phase},
    <span class="function"><span class="keyword">function</span><span class="params">(message)</span> {</span>
      $(<span class="string">'#message'</span>).html(message)
    }
  );
}
</pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="code"><pre><span class="regexp">//</span> application
private def moveCard(implicit <span class="attribute">request</span>: Request[Stream],
    <span class="attribute">servletRequest</span>: HttpServletRequest) = {
  val number = param_!(<span class="string">"storyNumber"</span>)
  val toPhase = param_!(<span class="string">"phase"</span>)
  val story = Story.findByNumber(number)
  story.moveTo(toPhase) match {
    <span class="reserved">case</span> Right<span class="function"><span class="params">(message)</span> =&gt;</span> OK(ContentType, <span class="string">"text/html"</span>) &lt;&lt;
      strict &lt;&lt; message
    <span class="reserved">case</span> Left<span class="function"><span class="params">(error)</span> =&gt;</span> OK(ContentType, <span class="string">"text/html"</span>) &lt;&lt;
      strict &lt;&lt; error.getMessage
  }
}
<span class="regexp">//</span> <span class="reserved">case</span> MethodParts<span class="function"><span class="params">(POST, <span class="string">"card"</span> :: <span class="string">"move"</span> :: Nil)</span> =&gt;</span>
<span class="regexp">//</span>   Some(moveCard)
</pre></td></tr></table></figure>

  
	</div>
		<footer class="article-footer clearfix">

  <div class="article-tags">
  
  <span></span> <a href="/tags/scala/">scala</a>
  </div>




<div class="article-share" id="share">

  <div data-url="http://zhpooer.github.io/2014/07/17/scala-in-action-working-with-scala/" data-title="Scala in Action-working with scala | Poe&#39;s World" data-tsina="null" class="share clearfix">
  </div>

</div>
</footer>   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2014/07/18/传智播客day59-Webservice/" title="传智播客day59-Webservice">
  <strong>PREVIOUS:</strong><br/>
  <span>
  传智播客day59-Webservice</span>
</a>
</div>


<div class="next">
<a href="/2014/07/16/传智播客day58-mybatis提高/"  title="传智播客day58-Mybatis提高">
 <strong>NEXT:</strong><br/> 
 <span>传智播客day58-Mybatis提高
</span>
</a>
</div>

</nav>

	
<section class="comment">
	<div class="ds-thread"></div>
</section>

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
  <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#building-web-application"><span class="toc-number">1.</span> <span class="toc-text">Building web application</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#-"><span class="toc-number">1.1.</span> <span class="toc-text">用户故事</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sbt"><span class="toc-number">1.2.</span> <span class="toc-text">sbt</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#seting-up"><span class="toc-number">1.3.</span> <span class="toc-text">Seting up</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#introducing-scalaz-module"><span class="toc-number">1.4.</span> <span class="toc-text">introducing scalaz module</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#database"><span class="toc-number">1.5.</span> <span class="toc-text">database</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-page"><span class="toc-number">1.6.</span> <span class="toc-text">web page</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#moving-cards-in-the-kanban-board"><span class="toc-number">1.7.</span> <span class="toc-text">Moving cards in the Kanban board</span></a></li></ol>
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  

  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			<li><a href="/tags/AJAX/" title="AJAX">AJAX<sup>1</sup></a></li>
		
			<li><a href="/tags/Akka/" title="Akka">Akka<sup>1</sup></a></li>
		
			<li><a href="/tags/Android/" title="Android">Android<sup>1</sup></a></li>
		
			<li><a href="/tags/DOM/" title="DOM">DOM<sup>2</sup></a></li>
		
			<li><a href="/tags/EL表达式/" title="EL表达式">EL表达式<sup>1</sup></a></li>
		
			<li><a href="/tags/HBase/" title="HBase">HBase<sup>1</sup></a></li>
		
			<li><a href="/tags/Hadoop/" title="Hadoop">Hadoop<sup>1</sup></a></li>
		
			<li><a href="/tags/Hibernate/" title="Hibernate">Hibernate<sup>2</sup></a></li>
		
			<li><a href="/tags/HttpSession/" title="HttpSession">HttpSession<sup>1</sup></a></li>
		
			<li><a href="/tags/IO/" title="IO">IO<sup>1</sup></a></li>
		
			<li><a href="/tags/Illustrator/" title="Illustrator">Illustrator<sup>3</sup></a></li>
		
			<li><a href="/tags/JSP/" title="JSP">JSP<sup>1</sup></a></li>
		
			<li><a href="/tags/JavaBean/" title="JavaBean">JavaBean<sup>1</sup></a></li>
		
			<li><a href="/tags/JavaScript/" title="JavaScript">JavaScript<sup>1</sup></a></li>
		
			<li><a href="/tags/Mybatis/" title="Mybatis">Mybatis<sup>1</sup></a></li>
		
			<li><a href="/tags/NoSql/" title="NoSql">NoSql<sup>1</sup></a></li>
		
			<li><a href="/tags/SASS/" title="SASS">SASS<sup>1</sup></a></li>
		
			<li><a href="/tags/SAX/" title="SAX">SAX<sup>1</sup></a></li>
		
			<li><a href="/tags/ServletRequest/" title="ServletRequest">ServletRequest<sup>1</sup></a></li>
		
			<li><a href="/tags/ServletResponse/" title="ServletResponse">ServletResponse<sup>1</sup></a></li>
		
		</ul>
</div>


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<div class="social-font" class="clearfix">
		
		
		
		
	</div>
		<p class="copyright">Powered by <a href="http://zespia.tw/hexo/" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/A-limon/pacman" target="_blank" title="Pacman">Pacman</a> © 2015 
		
		<a href="http://zhpooer.github.io" target="_blank" title="zhpooer">zhpooer</a>
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top",Math.max(140,320-$(this).scrollTop()));
    });
  };
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});     
</script>


<script type="text/javascript">
  var duoshuoQuery = {short_name:"zhpoooer"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 





  </body>
</html>
